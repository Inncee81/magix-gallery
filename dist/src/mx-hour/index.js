define("mx-hour/index",["magix","$","../mx-util/view"],(e,l,r)=>{"use strict";l.__esModule=!0;var s=e("magix"),a=e("$"),t=e("../mx-util/view");s.default.applyStyle("_zs_galleryab",'._zs_galleryhp ._zs_galleryhq{padding-top:40px;padding-bottom:10px;border-bottom:1px solid var(--color-border)}._zs_galleryhp ._zs_galleryhq ._zs_galleryhr,._zs_galleryhp ._zs_galleryhq ._zs_galleryhs{float:left;height:36px;text-align:center;vertical-align:middle;cursor:pointer}._zs_galleryhp ._zs_galleryhq ._zs_galleryhr{position:relative;width:10%;margin-right:1.8%;border-radius:var(--border-radius);color:#333;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}._zs_galleryhp ._zs_galleryhq ._zs_galleryhr ._zs_galleryht{position:absolute;top:-18px;width:100%;height:18px;line-height:18px;right:0;text-align:center;color:#999}._zs_galleryhp ._zs_galleryhq ._zs_galleryhr ._zs_galleryhu{width:100%;margin-top:8px;padding:0;font-size:12px}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs{position:relative;width:3.6%;color:#999;line-height:20px;font-weight:700;font-family:Tahoma}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs._zs_galleryhv{width:1.8%}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhw{position:relative;height:36px}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhw:before{content:"";position:absolute;top:-16px;left:0;width:100%;height:16px;background-color:transparent}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhx{position:absolute;top:13px;left:0;width:0;height:10px;border-left:1px solid var(--color-border)}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhx ._zs_galleryhy{position:absolute;top:-31px;left:50%;width:40px;margin-left:-20px;color:#ccc;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs._zs_galleryhz ._zs_galleryhx{height:16px}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs._zs_galleryhA ._zs_galleryhw{background-color:var(--color-brand-opacity)}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs._zs_galleryhA ._zs_galleryhw:before{background-color:var(--color-brand)}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs._zs_galleryhA ._zs_galleryhx ._zs_galleryhy{color:#fff}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhB,._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhC{position:absolute;top:0;width:0;height:36px;border-left:1px solid var(--color-brand)}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhB:before,._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhC:before{content:"";position:absolute;top:0;right:-3px;width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-top:4px solid var(--color-brand)}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhB ._zs_galleryhD,._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhC ._zs_galleryhD{position:absolute;top:-16px;left:-10px;width:20px;height:16px;background-color:var(--color-brand);color:#fff;text-align:center;line-height:16px;border-radius:2px}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhC{left:0}._zs_galleryhp ._zs_galleryhq ._zs_galleryhs ._zs_galleryhB{right:-1px}._zs_galleryhE{padding:10px 0;color:#999}._zs_galleryhE ._zs_galleryhF{font-size:12px;width:10%}._zs_galleryhE ._zs_galleryhG{line-height:var(--input-small-height);margin-right:1.8%}');var _={1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"};l.default=t.extend({tmpl:function(e,l,r,s,a,t,_,i){if(r||(r=e),!a){var n={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},h=/[&<>"'`]/g,o=function(e){return"&"+n[e]+";"};a=function(e){return""+(null==e?"":e)},s=function(e){return a(e).replace(h,o)}}if(!t){var g={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},c=function(e){return g[e]},p=/[!')(*]/g;t=function(e){return encodeURIComponent(a(e)).replace(p,c)}}if(!i){var d=/[\\'"]/g;i=function(e){return a(e).replace(d,"\\$&")}}var y="",z=e.periods,u=e.types,f=e.viewId,x=e.type,v=e.tip;if(y+='<div mxv mxa="_zs_galleryc*:_" class="_zs_galleryhp">',7==z.length){y+='<div mxv><span mxs="_zs_galleryc*:_" class="color-9 mr10">快捷操作：</span>';for(var m=0,b=u.length;m<b;m++){var w=u[m];y+='<label mxv mxa="_zs_galleryc*:a" class="mr40"><input type="radio" name="'+s(f)+'_opers" value="'+s(w.value)+'" mx-change="'+l+"changeType({value:'"+s(i(w.value))+"'})\" ",w.value==x&&(y+=' checked="true" '),y+="/>"+s(w.text)+"</label>"}y+="</div>"}y+=" ";for(var q=0,k=z.length;q<k;q++){var E=z[q];y+='<ul mxa="_zs_galleryc*:b" class="_zs_galleryhq clearfix"><li mxa="_zs_galleryc*:c" class="_zs_galleryhr"><span mxs="_zs_galleryc*:a" class="_zs_galleryht">时间段</span><a href="javascript:;" class="btn btn-small _zs_galleryhu ',E.selected&&(y+=" btn-brand "),y+='" mx-click="'+l+"toggleAll({pIndex:"+s(q)+'})">'+s(E.name)+"</a></li>";for(var A=0,I=E.hours,S=I.length;A<S;A++){var C=I[A];y+='<li mx-mousedown="'+l+'drag()" class="_zs_galleryhs ',C.milestone&&(y+=" _zs_galleryhz "),y+=" ",C.selected&&(y+=" _zs_galleryhA "),y+='" data-period="'+s(q)+'" data-hour="'+s(C.index)+'"><div mxs="_zs_galleryc*:b" class="_zs_galleryhw"></div><div class="_zs_galleryhC ',C.firstSelected||(y+=" hide "),y+='" style="z-index: '+s(C.zIndex)+';"><span mxa="_zs_galleryc*:d" class="_zs_galleryhD">'+s(C.index)+'</span></div><div class="_zs_galleryhB ',C.endSelected||(y+=" hide "),y+='" style="z-index: '+s(C.zIndex)+'"><span mxa="_zs_galleryc*:e" class="_zs_galleryhD">'+s(C.indexNext)+'</span></div><div mxa="_zs_galleryc*:f" class="_zs_galleryhx"><span mxa="_zs_galleryc*:g" class="_zs_galleryhy">'+s(C.index)+"</span></div></li>"}y+='<li mxs="_zs_galleryc*:c" class="_zs_galleryhs _zs_galleryhz _zs_galleryhv"><span class="_zs_galleryhx"><span class="_zs_galleryhy">24</span></span></li></ul>'}return y+='</div><div mxa="_zs_galleryc*:h" class="clearfix _zs_galleryhE"><a mxs="_zs_galleryc*:d" mx-click="'+l+'clearAll()" href="javascript:;" class="btn btn-small _zs_galleryhF"><i class="mc-iconfont displacement-2 mr5 color-9">&#xe72e;</i>清空</a><span mxa="_zs_galleryc*:i" class="fr _zs_galleryhG">'+s(v)+"</span></div>"},init:function(e){this.updater.snapshot(),this.assign(e)},assign:function(e){var l=this.updater.altered(),r=e.tip||"",s=e.selected||[],a=e.simple+""!="false",t=e.groups;t&&t.length||(t=a?[12345,67]:[1,2,3,4,5,6,7]);var i={};s.forEach(function(e){(e.week+"").split("").forEach(function(l){i[l]=(e.times||[]).map(function(e){return e+""})})});for(var n=t.map(function(e,l){e=(e+"").split("");var r=i[e[0]]||[],s=function(){for(var e=[],l=0;l<24;l++)e.push({index:l,indexNext:l+1,milestone:l%6==0,zIndex:l+10});return e}();return s.forEach(function(e){e.selected=r.indexOf(e.index+"")>-1}),{name:e.length>1?_[e[0]]+"至"+_[e[e.length-1]]:_[e[0]],hours:s,weeks:e}}),h=[{text:"全日程",value:"1234567"},{text:"工作日",value:"12345"},{text:"双休日",value:"67"}],o="",g=function(e){var l=(h[e].value+"").split(""),r=!0;if(l.forEach(function(e){r=r&&24==(i[e]||[]).length}),r)return o=h[e].value,"break"},c=0;c<h.length;c++){if("break"===g(c))break}return this.updater.set({tip:r,periods:this.sync(n),type:o,types:h}),l||(l=this.updater.altered()),!!l&&(this.updater.snapshot(),!0)},render:function(){this.updater.digest()},sync:function(e){return e.forEach(function(e){for(var l=e.hours,r=!0,s=0;s<l.length;s++){var a=l[s],t=l[s-1],_=l[s+1];a.firstSelected=!1,a.endSelected=!1,a.selected&&((t&&!t.selected||!t)&&(a.firstSelected=!0),(_&&!_.selected||!_)&&(a.endSelected=!0)),r=r&&a.selected}e.selected=r}),e},"clearAll<click>":function(e){var l=this.updater.get("periods");l.forEach(function(e){e.hours.forEach(function(e){e.selected=!1})}),this.updater.digest({periods:this.sync(l)})},"toggleAll<click>":function(e){var l=this.updater.get("periods"),r=l[e.params.pIndex],s=!r.selected;r.hours.forEach(function(e){e.selected=s}),this.updater.digest({periods:this.sync(l)})},"drag<mousedown>":function(e){var l=this,r=l.updater.get("periods"),s=a(e.eventTarget),t=s.data("period"),_=s.data("hour"),i=!r[t].hours[_].selected;l.toggle(t,_,i);var n=s.parent("._zs_galleryhq").find("[data-hour]");return n.on("mouseenter.drag",function(e){e.preventDefault();var r=a(this);l.toggle(r.data("period"),r.data("hour"),i)}),a(document.body).off("mouseup.drag").on("mouseup.drag",function(e){n.off("mouseenter.drag")}),e.preventDefault(),!1},toggle:function(e,l,r){var s=this.updater.get("periods");s[e].hours[l].selected=r,this.updater.digest({periods:this.sync(s)})},"changeType<change>":function(e){var l=e.params.value,r=this.updater.get("periods"),s=(l+"").split("");r.forEach(function(e){e.hours.forEach(function(l){l.selected=s.indexOf(e.weeks+"")>-1})}),this.updater.digest({type:l,periods:this.sync(r)})},val:function(){var e=this.updater.get("periods"),l=[];return e.forEach(function(e){var r=[];e.hours.forEach(function(e){e.selected&&r.push(e.index)}),e.weeks.forEach(function(e){l.push({week:e,name:_[e],times:r})})}),l}})});