define("mx-tree/index",["magix","mx-tree/util","../mx-medusa/util","./branch"],(e,t,r)=>{e("./branch");var n=e("magix"),a=n.Vframe,l=e("mx-tree/util"),i=e("../mx-medusa/util");n.applyStyle("_zs_galleryaF",':root{--mx-tree-oper-size:calc(var(--font-size) + 2px)}._zs_gallerykH{position:relative;height:32px;line-height:20px;padding-bottom:12px;background-color:#fff;overflow:hidden;transition:height .2s}._zs_gallerykH ._zs_gallerykI{float:left;width:var(--mx-tree-oper-size);height:var(--mx-tree-oper-size);margin-right:5px;line-height:var(--mx-tree-oper-size);font-size:var(--mx-tree-oper-size);color:#ccc;transition:color var(--duration);-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none}._zs_gallerykH ._zs_gallerykJ{cursor:pointer}._zs_gallerykH ._zs_gallerykJ:hover{color:#666}._zs_gallerykK ._zs_gallerykH{height:0;padding-bottom:0}._zs_gallerykL{position:relative}._zs_gallerykM{padding-left:calc(var(--mx-tree-oper-size) + 5px)}._zs_gallerykN,._zs_gallerykN ._zs_gallerykL{position:relative}._zs_gallerykN ._zs_gallerykL:after{content:"";position:absolute;top:22px;left:calc(var(--mx-tree-oper-size)/2);bottom:2px;width:1px;background-color:var(--color-border)}._zs_gallerykN ._zs_gallerykL:last-child:after{content:none}'),r.exports=n.View.extend({tmpl:function(e,t,r,n,a,l,i,o){if(r||(r=e),!a){var s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},c=/[&<>"'`]/g,u=function(e){return"&"+s[e]+";"};a=function(e){return""+(null==e?"":e)},n=function(e){return a(e).replace(c,u)}}if(!l){var _={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},d=function(e){return _[e]},f=/[!')(*]/g;l=function(e){return encodeURIComponent(a(e)).replace(f,d)}}if(!o){var g=/[\\'"]/g;o=function(e){return a(e).replace(g,"\\$&")}}i||(i=function(e,t,r,n){for(n=e[p];--n;)if(e[r=p+n]===t)return r;return e[r=p+e[p]++]=t,r});var p="",h="",v=e.hasLine,m=e.viewId,x=e.readOnly,y=e.needExpand,z=e.textKey,k=e.valueKey,b=e.closeMap,V=e.list;return h+='<div mxv="readOnly,needExpand,closeMap,list" class="',v&&(h+=" _zs_gallerykN "),h+='" id="tree_'+n(m)+'" mx-change="'+t+'__ag()" mx-view="mx-tree/branch?readOnly='+i(r,x)+"&needExpand="+i(r,y)+"&textKey="+l(z)+"&valueKey="+l(k)+"&closeMap="+i(r,b)+"&list="+i(r,V)+'"></div>'},init:function(e){var t=this;t.__fq={},t.__fr=[],t.__a=$("#"+t.id),t.updater.snapshot(),t.assign(e)},assign:function(e){var t,r=this,a=r.updater.altered(),o=e.readOnly+""=="true",s=e.hasLine+""=="true",c=e.valueKey||"value",u=e.textKey||"text",_=e.parentKey||"pValue",d=e.needAll+""=="true",f=e.needExpand+""=="true",g=l.listToTree(e.list,c,_);if(d){var p={};p[c]=r.id+"_all",p[u]=i["select.all"],p.isAll=!0,p.children=g.list,t=[p]}else t=g.list;var h=e.close+""=="true",v={},m=function(e){e.forEach(function(e){v[e[c]]=h,e.children&&e.children.length>0&&m(e.children)})};m(t),r.__fq=n.mix(v,r.__fq);var x=function(e){e.forEach(function(e){e.close=r.__fq[e[c]],e.children&&e.children.length>0&&x(e.children)})};return x(t),r.__fr=r.__fr.map(function(e){return e+""}),(e.bottomValues||[]).forEach(function(e){e+="",r.__fr.indexOf(e)<0&&r.__fr.push(e)}),r.updater.set({viewId:r.id,valueKey:c,textKey:u,list:t,readOnly:o,hasLine:s,needExpand:f,closeMap:r.__fq,bottomValues:r.__fr}),r.__a.val(r.__fr),a||(a=r.updater.altered()),!!a&&(r.updater.snapshot(),!0)},render:function(){this.updater.digest();var e=this.updater.get("bottomValues");e.length>0&&this.setBottomValues(e)},"__ag<change>":function(e){e.stopPropagation();var t=this.getBottomValues();this.__a.val(this.__fr=t).trigger($.Event("change",{bottomValues:t}))},setBottomValues:function(e){this.loop(function(t){t.invoke("setValues",[e])})},getBottomValues:function(){var e=[];return this.loop(function(t){var r=t.invoke("getValues");e=e.concat(r)}),e},getBottomItems:function(){var e=[];return this.loop(function(t){var r=t.invoke("getItems");e=e.concat(r)}),e},loop:function(e){var t=this.owner.children(),r=function(t){for(var n=0,l=t;n<l.length;n++){var i=l[n],o=a.get(i);e(o);var s=o.children();s&&s.length>0&&r(s)}};r(t)}})});