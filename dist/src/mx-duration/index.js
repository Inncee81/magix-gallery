define("mx-duration/index",["magix","mx-form/index","mx-form/validator","mx-duration/data"],(e,t,r)=>{var o=e("magix"),a=e("mx-form/index"),s=e("mx-form/validator"),l=e("mx-duration/data");o.applyStyle("_zs_galleryI","._zs_galleryek{display:inline-block;width:10px;height:10px;margin-right:3px;border-radius:50%}._zs_galleryel{box-sizing:border-box;border-radius:var(--border-radius);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;background-color:var(--color-bg)}._zs_galleryel ._zs_galleryem{border-top:1px solid var(--color-border);border-right:1px solid var(--color-border);border-left:1px solid var(--color-border);border-top-left-radius:var(--border-radius);border-bottom-left-radius:var(--border-radius)}._zs_galleryel ._zs_galleryem ._zs_galleryen{font-size:12px;color:#999;text-align:center;border-bottom:1px solid var(--color-border)}._zs_galleryel ._zs_galleryem ._zs_galleryen:first-child{border-top-left-radius:var(--border-radius)}._zs_galleryel ._zs_galleryem ._zs_galleryen:last-child{border-bottom-left-radius:var(--border-radius)}._zs_galleryel ._zs_galleryeo ._zs_galleryep{background-color:var(--color-bg);border-top:1px solid var(--color-border);border-bottom:1px solid var(--color-border);border-top-right-radius:var(--border-radius);text-align:center;color:#999}._zs_galleryel ._zs_galleryeo ._zs_galleryep ._zs_galleryeq{float:left;font-size:12px;border-right:1px solid var(--color-border)}._zs_galleryel ._zs_galleryeo ._zs_galleryep ._zs_galleryeq:last-child{border-top-right-radius:var(--border-radius)}._zs_galleryel ._zs_galleryeo ._zs_galleryer{background-color:var(--color-bg);text-align:center;color:#999}._zs_galleryel ._zs_galleryeo ._zs_galleryer ._zs_galleryes{float:left;font-size:12px}._zs_galleryel ._zs_galleryeo ._zs_galleryet ._zs_galleryeu,._zs_galleryel ._zs_galleryeo ._zs_galleryer ._zs_galleryes{border-right:1px solid var(--color-border);border-bottom:1px solid var(--color-border)}._zs_galleryel ._zs_galleryeo ._zs_galleryet ._zs_galleryeu{background:#fff}._zs_galleryel ._zs_galleryeo ._zs_galleryet ._zs_galleryeu:last-child{border-bottom-right-radius:var(--border-radius)}._zs_galleryev{position:relative}._zs_galleryev ._zs_galleryew{position:absolute;z-index:100;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;border:1px solid var(--color-brand);background:rgba(75,138,251,.2)}._zs_galleryev ._zs_galleryex{width:140px;padding:20px;filter:alpha(opacity=80);opacity:.8}._zs_galleryev ._zs_galleryex,._zs_galleryev ._zs_galleryey{position:absolute;z-index:100;border-radius:var(--border-radius);background:#fff}._zs_galleryev ._zs_galleryey{width:calc(var(--font-size)*16 + 40px)}._zs_galleryev ._zs_galleryey ._zs_galleryez{padding:10px 10px 0;border-bottom:1px solid var(--color-border)}._zs_galleryev ._zs_galleryey ._zs_galleryeA{padding:10px}"),r.exports=o.View.extend({tmpl:function(e,t,r,o,a,s,l,i){if(r||(r=e),!a){var n={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},d=/[&<>"'`]/g,g=function(e){return"&"+n[e]+";"};a=function(e){return""+(null==e?"":e)},o=function(e){return a(e).replace(d,g)}}if(!s){var u={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},c=function(e){return u[e]},p=/[!')(*]/g;s=function(e){return encodeURIComponent(a(e)).replace(p,c)}}if(!i){var h=/[\\'"]/g;i=function(e){return a(e).replace(h,"\\$&")}}var m="",f=e.maxWidth,_=e.hoverInfo,b=e.maskInfo,v=e.settingInfo,x=e.viewId,y=e.boxWidth,z=e.multiple,w=e.headerHeight,k=e.weeks,I=e.boxHeight,T=e.rowNum,D=e.ranges,M=e.boxZones;m+='<div mxv style="width: '+o(f)+'px;" class="_zs_galleryev">',_.show&&(m+='<div style="top: '+o(_.top)+"px; left: "+o(_.left)+'px;" class="_zs_galleryex mx-shadow"><div mxa="_zs_gallerybo:_" class="mb5">'+o(_.week)+'</div><div mxa="_zs_gallerybo:a" class="mb5"><strong>'+o(_.time)+"</strong></div><div><strong>"+o(_.discount)+"</strong>%折扣</div></div>"),m+=" ",b.show&&(m+='<div style="top: '+o(b.top)+"px; left: "+o(b.left)+"px; height: "+o(b.height)+"px; width: "+o(b.width)+'px;" class="_zs_galleryew"></div>'),m+=" ",v.show&&(m+='<div mxv style="top: '+o(v.top)+"px; left: "+o(v.left)+'px;" class="_zs_galleryey mx-shadow"><div mxv mxa="_zs_gallerybo:b" class="_zs_galleryez"><div mxa="_zs_gallerybo:c" class="mb10"><span>'+o(v.week)+'</span>：<strong mxa="_zs_gallerybo:d" class="ml5">'+o(v.time)+'</strong></div><div mxv mxa="_zs_gallerybo:e" class="mb5"><label mxv><input type="radio" class="radio" name="settingType" value="1" mx-change="'+t+'changeSettingType({type:1})" ',1==v.type&&(m+=' checked="true" '),m+="/>自定义：</label>",1==v.type?m+='<input mxe="'+t+"_0\" mxc=\"[{p:'settingInfo.discount',f:{required:true,posint:[true,'范围:30-250的整数'],min:[30,'范围:30-250的整数'],max:[250,'范围:30-250的整数']}}]\" class=\"input w100\" value=\""+o(v.discount)+'"/>':m+='<input class="input w100" disabled="true" value="'+o(v.discount)+'"/>',m+='<span mxs="_zs_gallerybo:_" class="ml5">%</span></div><div mxv mxa="_zs_gallerybo:f" class="mb10"><label mxv><input type="radio" name="settingType" class="radio" value="2" mx-change="'+t+'changeSettingType({type:2})" ',2==v.type&&(m+=' checked="true" '),m+='/>无折扣</label></div><div mxv mxa="_zs_gallerybo:g" class="mb10"><label mxv><input type="radio" name="settingType" class="radio" value="3" mx-change="'+t+'changeSettingType({type:3})" ',3==v.type&&(m+=' checked="true" '),m+='/>不投放</label></div></div><div mxs="_zs_gallerybo:a" class="_zs_galleryeA"><a class="btn btn-small btn-brand mr10 w60" href="javascript:;" mx-click="'+t+'submitSetting()">确定</a><a class="btn btn-small w60" href="javascript:;" mx-click="'+t+'cancelSetting()">取消</a></div></div>'),m+='<div class="_zs_galleryel clearfix" id="'+o(x)+'_duration" style="width: '+o(f)+'px;"><ul class="_zs_galleryem fl" style="width: '+o(y*z)+'px;"><li class="_zs_galleryen" style="height: '+o(w+1)+"px; line-height: "+o(w)+'px;">星期</li>';for(var N=0,Z=k.length;N<Z;N++){var S=k[N];m+='<li class="_zs_galleryen" style="height: '+o(I)+"px; line-height: "+o(I)+'px;">'+o(S)+"</li>"}m+='</ul><div class="_zs_galleryeo fl" style="width: '+o(y*T)+'px;"><ul mxa="_zs_gallerybo:h" class="_zs_galleryep clearfix">';for(var $=0,C=D.length;$<C;$++){var H=D[$];m+='<li class="_zs_galleryeq" style="width: '+o(y*(T/4))+"px; height: "+o(w/2)+"px; line-height: "+o(w/2)+'px;">'+o(H)+"</li>"}m+='</ul><ul mxa="_zs_gallerybo:i" class="_zs_galleryer clearfix">';for(var R=0;R<24;R+=1)m+='<li class="_zs_galleryes" style="width: '+o(y*z)+"px; height: "+o(w/2)+"px; line-height: "+o(w/2)+'px;">'+o(R)+"</li>";m+='</ul><ul mxa="_zs_gallerybo:j" class="_zs_galleryet clearfix">';for(var W=0,B=M.length;W<B;W++){var j=M[W];m+='<li class="_zs_galleryeu fl" style="width: '+o(y)+"px; height: "+o(I)+"px; background-color: "+o(j.bg)+'" mx-click="'+t+"clickOutside({index:"+o(j.index)+'})" mx-mousedown="'+t+'select()" mx-mouseover="'+t+"showTip({index:"+o(j.index)+'})" mx-mouseout="'+t+"hideTip({index:"+o(j.index)+'})"></li>'}return m+='</ul></div></div><div mxs="_zs_gallerybo:b" class="pt10 pb10 clearfix"><a class="btn btn-small mr10 fl" href="javascript:;" mx-click="'+t+'clear()">清空</a><a class="btn btn-small mr10 fl" href="javascript:;" mx-click="'+t+'reset()">重置</a><span class="fr lh28 color-c"><span class="_zs_galleryek" style="background-color: rgba(97,199,242,0.7)"></span><span class="font-tahoma bold color-c mr15">30-100%</span><span class="_zs_galleryek" style="background-color: rgba(77,166,255,0.7)"></span><span class="font-tahoma bold color-c mr15">100-200%</span><span class="_zs_galleryek" style="background-color: rgba(134,115,230,0.7)"></span><span class="font-tahoma bold color-c mr15">200-250%</span><i class="mc-iconfont displacement-2">&#xe705;</i><span class="mr10">可以拖拽鼠标选择投放时段</span></span></div></div>'},mixins:[a,s],init:function(e){var t=this,r=/^true$/i.test(e.half),o=e.width||780,a=e.selected||l.none,s=r?2:1;o&&+o<780&&(o=780);var i=24*s,n=o/(25*s),d=7*i;t.updater.set({viewId:t.id,timeDiscount:a,weeks:["一","二","三","四","五","六","日"],ranges:["00:00 - 06:00","06:00 - 12:00","12:00 - 18:00","18:00 - 24:00"],multiple:s,maxWidth:o,rowNum:i,columnNum:7,headerHeight:60,boxWidth:n,boxHeight:40,boxLength:d,boxZones:t.getBoxzone(d),valid:"",maskInfo:{show:!1,left:0,top:0,width:0,height:0,startRow:0,endRow:0,startColumn:0,endColumn:0,selectedZones:[]},settingInfo:{show:!1,week:"",time:"",discount:"",type:1},hoverInfo:{show:!1,left:0,top:0,week:"",time:"",discount:""}}),t.discountColorMap=t.getColorMap(),t.on("destroy",function(){$(document.body).off("mousemove.duration"),$(document.body).off("mouseup.duration"),clearTimeout(t.hoverTimeout),clearTimeout(t.hideTimeout)})},render:function(){for(var e=this.updater,t=e.get("timeDiscount"),r=e.get("boxLength"),o=this.report2Array(t),a=0;a<r;a++)this.setBoxDiscount(a,o[a]);this.updater.digest(),this.wrapper=$("#"+this.id+"_duration")},report2Array:function(e){for(var t=[],r=this.updater,o=r.get("rowNum"),a=r.get("multiple"),s=e.split(";"),l=0,i=s.length;l<i;l++)for(var n=s[l].split(","),d=0,g=n.length;d<g;d++)if("0"!=n[d]){var u=n[d].match(/(\d{2}):(\d{2})-(\d{2}):(\d{2}):(\d+)/),c=parseInt(u[1])*a+o*l;"30"==u[2]&&c++;var p=parseInt(u[3])*a+o*l;"30"==u[4]&&p++;for(var h=parseInt(u[5]),m=c;m<=p-1;m++)t[m]=h}return t},setBoxDiscount:function(e,t){t=parseInt(t)||0;var r=this.discountColorMap[t],o=this.updater.get("boxZones");o[e].bg=r,o[e].discount=t,this.updater.set({boxZones:o})},"select<mousedown>":function(e){e.preventDefault();var t=this,r=t.updater,o=r.get("hoverInfo"),a=r.get("settingInfo"),s=r.get("maskInfo"),l=r.get("boxWidth"),i=r.get("multiple"),n=r.get("headerHeight");o.show=!1,a.show=!1;var d=t.wrapper,g=d.offset().left,u=d.offset().top,c=e.pageX-g,p=e.pageY-u;$(document.body).off("mousemove.duration").on("mousemove.duration",function(e){e.preventDefault();var r=e.pageX-g,h=e.pageY-u,m=Math.min(r,d.outerWidth()),f=Math.min(h,d.outerHeight()),_=Math.max(l*i,Math.min(c,m)),b=Math.max(n,Math.min(p,f));s.left=_,s.top=b+1,s.width=Math.max(c,m)-_,s.height=Math.max(p,f)-b,s.show=!0,t.updater.digest({hoverInfo:o,settingInfo:a,maskInfo:s})}),$(document.body).off("mouseup.duration").on("mouseup.duration",function(e){s.show&&(e.preventDefault(),$(document.body).off("mousemove.duration"),t.selectEnd(),$(document.body).off("mouseup.duration"))})},selectEnd:function(e){for(var t=this.updater,r=t.get("maskInfo"),o=t.get("headerHeight"),a=t.get("boxHeight"),s=t.get("boxWidth"),l=t.get("multiple"),i=t.get("columnNum"),n=t.get("rowNum"),d=parseInt((r.top-o)/a),g=parseInt((r.height+r.top-o)/a),u=parseInt((r.left-s*l)/s),c=parseInt((r.width+r.left-s*l)/s),p=Math.max(0,d),h=Math.min(i-1,g),m=Math.max(0,u),f=Math.min(n-1,c),_=[],b=p;b<=h;b++)for(var v=m;v<=f;v++)_.push(b*n+v);r.selectedZones=_,r.startRow=p,r.endRow=h,r.startColumn=m,r.endColumn=f,r.left=s*l+m*s,r.top=o+p*a+1,r.width=(f-m+1)*s,r.height=(h-p+1)*a,r.show=!0,this.showSetting()},"clickOutside<click>":function(e){var t=+e.params.index,r=this.updater.get("maskInfo");!r.show||r.show&&r.selectedZones.indexOf(t)>-1||(e.preventDefault(),$(document.body).off("mousemove.duration"),$(document.body).off("mouseup.duration"),$(document.body).off("click.duration"),this["cancelSetting<click>"]())},"changeSettingType<change>":function(e){var t=this.updater,r=t.get("settingInfo");r.type=e.params.type,t.digest({settingInfo:r})},"submitSetting<click>":function(){var e=this.updater.get(),t=e.settingInfo,r=e.maskInfo,o=0,a=!0;switch(+t.type){case 1:a=this.isValid(),o=this.fromKeys(e,"settingInfo").settingInfo.discount;break;case 2:o=100;break;case 3:o=0}if(a){t.show=!1,t.type=1,r.show=!1;for(var s=0;s<r.selectedZones.length;s++)this.setBoxDiscount(r.selectedZones[s],o);this.updater.digest({settingInfo:t,maskInfo:r})}},"cancelSetting<click>":function(){var e=this.updater,t=e.get("settingInfo"),r=e.get("maskInfo");r.show=!1,t.show=!1,t.type=1,this.updater.digest({settingInfo:t,maskInfo:r})},showSetting:function(){var e,t=this.updater,r=t.get("settingInfo"),o=t.get("maskInfo"),a=t.get("boxZones"),s=o.startRow+1,l=o.endRow+1;e=s!=l?this.formatweek(s)+" - "+this.formatweek(l):this.formatweek(s),r.week=e,r.time=this.getDuration(o.startColumn,o.endColumn+1,"%s - %s");for(var i,n=o.selectedZones,d=!0,g=0;g<n.length;g++){var u=a[n[g]].discount;if(!u||i&&u!=i){d=!1;break}i=u}r.discount=d?i:"";var c=this.wrapper.outerWidth(),p=this.wrapper.outerHeight(),h=o.left+o.width/2;h+260>c&&(h-=260);var m=o.top+o.height/2;m+238>p+100&&(m-=238),r.left=h,r.top=m,r.show=!0,this.updater.digest({boxZones:a,settingInfo:r,maskInfo:o})},"showTip<mouseover>":function(e){if(!o.inside(e.relatedTarget,e.eventTarget)){var t=this;clearTimeout(t.hoverTimeout),clearTimeout(t.hideTimeout);var r=t.updater,a=r.get("settingInfo");if(!r.get("maskInfo").show&&!a.show){var s=r.get("boxWidth"),l=r.get("boxHeight"),i=r.get("headerHeight"),n=r.get("rowNum"),d=r.get("hoverInfo"),g=r.get("boxZones");t.hoverTimeout=setTimeout(function(){var o=parseInt(e.params.index),a=s+(o%n+1)*s,u=i+(parseInt(o/n)+1)*l,c=t.formatweek(parseInt(o/n)+1),p=t.getDuration(o,o+1,"%s - %s"),h=g[o].discount;d.left=a,d.top=u,d.week=c,d.time=p,d.discount=h,d.show=!0,r.digest({hoverInfo:d})},200)}}},"hideTip<mouseout>":function(e){if(!o.inside(e.relatedTarget,e.eventTarget)){var t=this;clearTimeout(t.hoverTimeout),clearTimeout(t.hideTimeout);var r=t.updater;t.hideTimeout=setTimeout(function(){var e=r.get("hoverInfo");e.show=!1,t.updater.digest({hoverInfo:e})},200)}},"reset<click>":function(e){for(var t=this.updater.get("boxLength"),r=0;r<t;r++)this.setBoxDiscount(r,100);this.updater.digest()},"clear<click>":function(e){for(var t=this.updater.get("boxLength"),r=0;r<t;r++)this.setBoxDiscount(r,0);this.updater.digest()},array2Report:function(e){for(var t=this,r=t.updater,o=r.get("columnNum"),a=r.get("rowNum"),s=(r.get("multiple"),[]),l=0;l<o;l++){s[l]=0;for(var i=[],n=0;n<a;n++){var d=e[l*a+n];if(d){var g=i[i.length-1];g&&g.discount==d&&g.end==n?g.end=n+1:i.push({start:n,end:n+1,discount:d})}}var u=i.map(function(e){return t.getDuration(e.start,e.end)+":"+e.discount});u&&u.length>0&&(s[l]=u.join(","))}return s.join(";")},submit:function(){var e=this.updater.get("boxZones").map(function(e){return e.discount}),t=this.array2Report(e);return t==l.none?{ok:!1}:{ok:!0,val:t}},update:function(e){for(var t=this.updater.get(),r=(e=t.timeDiscount,t.boxLength),o=this.report2Array(e),a=0;a<r;a++)this.setBoxDiscount(a,o[a])},formatweek:function(e){return"星期"+["日","一","二","三","四","五","六"][e%7]},getDuration:function(e,t,r){var o=this.updater.get("rowNum"),a=this.getTimeFromNum(e),s="",l=a+"-"+(s=t%o==0?"24:00":this.getTimeFromNum(t));return r&&(l=r.replace("%s",a).replace("%s",s)),l},getTimeFromNum:function(e){var t=this.updater.get(),r=t.rowNum,o=t.multiple,a=Math.floor(e%r/o);return 1==(a+"").length&&(a="0"+a),a+":"+(e%r%o==1?"30":"00")},getBoxzone:function(e){for(var t=[],r=0;r<e;r++)t.push({index:r,bg:"#ffffff",discount:0});return t},getColorMap:function(e){for(var t={"[0,1)":"#ffffff","[30,40)":"rgba(97,199,242,0.05)","[40,50)":"rgba(97,199,242,0.1)","[50,60)":"rgba(97,199,242,0.15)","[60,70)":"rgba(97,199,242,0.2)","[70,80)":"rgba(97,199,242,0.25)","[80,90)":"rgba(97,199,242,0.3)","[90,100)":"rgba(97,199,242,0.35)","[100,101)":"rgba(97,199,242,0.4)","[101,110)":"rgba(77,166,255,0.15)","[110,120)":"rgba(77,166,255,0.2)","[120,130)":"rgba(77,166,255,0.25)","[130,140)":"rgba(77,166,255,0.3)","[140,150)":"rgba(77,166,255,0.35)","[150,160)":"rgba(77,166,255,0.4)","[160,170)":"rgba(77,166,255,0.45)","[170,180)":"rgba(77,166,255,0.5)","[180,190)":"rgba(77,166,255,0.55)","[190,200)":"rgba(77,166,255,0.6)","[200,210)":"rgba(134,115,230,0.3)","[210,220)":"rgba(134,115,230,0.35)","[220,230)":"rgba(134,115,230,0.4)","[230,240)":"rgba(134,115,230,0.45)","[240,250)":"rgba(134,115,230,0.5)","[250,251)":"rgba(134,115,230,0.55)"},r={},o=0;o<=250;o++)for(var a in r[o]="#ffffff",t){var s=a.substring(1,a.length-1).split(","),l=s[0],i=s[1];if(o>=l&&o<i){r[o]=t[a];break}}return r}})});