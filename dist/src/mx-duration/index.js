define("mx-duration/index",["magix","$","../mx-util/view","../mx-form/index","../mx-form/validator"],(e,t,r)=>{"use strict";t.__esModule=!0;var a=e("magix"),o=e("$"),s=e("../mx-util/view"),l=e("../mx-form/index"),i=e("../mx-form/validator"),n="0;0;0;0;0;0;0";a.default.applyStyle("_zs_galleryJ","._zs_galleryeF{display:inline-block;width:10px;height:10px;margin-right:3px;border-radius:50%}._zs_galleryeG{box-sizing:border-box;border-radius:var(--border-radius);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;background-color:var(--color-bg)}._zs_galleryeG ._zs_galleryeH{border-top:1px solid var(--color-border);border-right:1px solid var(--color-border);border-left:1px solid var(--color-border);border-top-left-radius:var(--border-radius);border-bottom-left-radius:var(--border-radius)}._zs_galleryeG ._zs_galleryeH ._zs_galleryeI{font-size:12px;color:#999;text-align:center;border-bottom:1px solid var(--color-border)}._zs_galleryeG ._zs_galleryeH ._zs_galleryeI:first-child{border-top-left-radius:var(--border-radius)}._zs_galleryeG ._zs_galleryeH ._zs_galleryeI:last-child{border-bottom-left-radius:var(--border-radius)}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeK{background-color:var(--color-bg);border-top:1px solid var(--color-border);border-bottom:1px solid var(--color-border);border-top-right-radius:var(--border-radius);text-align:center;color:#999}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeK ._zs_galleryeL{float:left;font-size:12px;border-right:1px solid var(--color-border)}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeK ._zs_galleryeL:last-child{border-top-right-radius:var(--border-radius)}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeM{background-color:var(--color-bg);text-align:center;color:#999}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeM ._zs_galleryeN{float:left;font-size:12px}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeO ._zs_galleryeP,._zs_galleryeG ._zs_galleryeJ ._zs_galleryeM ._zs_galleryeN{border-right:1px solid var(--color-border);border-bottom:1px solid var(--color-border)}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeO ._zs_galleryeP{background:#fff}._zs_galleryeG ._zs_galleryeJ ._zs_galleryeO ._zs_galleryeP:last-child{border-bottom-right-radius:var(--border-radius)}._zs_galleryeQ{position:relative}._zs_galleryeQ ._zs_galleryeR{position:absolute;z-index:100;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;border:1px solid var(--color-brand);background:rgba(75,138,251,.2)}._zs_galleryeQ ._zs_galleryeS{width:120px;padding:10px;line-height:22px;filter:alpha(opacity=80);opacity:.8}._zs_galleryeQ ._zs_galleryeS,._zs_galleryeQ ._zs_galleryeT{position:absolute;z-index:100;border-radius:var(--border-radius);background:#fff}._zs_galleryeQ ._zs_galleryeT{width:calc(var(--font-size)*16 + 40px)}._zs_galleryeQ ._zs_galleryeT ._zs_galleryeU{padding:10px 10px 0;border-bottom:1px solid var(--color-border)}._zs_galleryeQ ._zs_galleryeT ._zs_galleryeV{padding:10px}"),t.default=s.extend({tmpl:function(e,t,r,a,o,s,l,i){if(r||(r=e),!o){var n={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},d=/[&<>"'`]/g,u=function(e){return"&"+n[e]+";"};o=function(e){return""+(null==e?"":e)},a=function(e){return o(e).replace(d,u)}}if(!s){var g={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},c=function(e){return g[e]},h=/[!')(*]/g;s=function(e){return encodeURIComponent(o(e)).replace(h,c)}}if(!i){var p=/[\\'"]/g;i=function(e){return o(e).replace(p,"\\$&")}}var f="",m=e.maxWidth,_=e.hoverInfo,b=e.maskInfo,v=e.settingInfo,x=e.viewId,y=e.boxWidth,z=e.multiple,w=e.headerHeight,k=e.weeks,I=e.boxHeight,T=e.rowNum,C=e.ranges,M=e.boxZones;f+='<div mxv style="width: '+a(m)+'px;" class="_zs_galleryeQ">',_.show&&(f+='<div style="top: '+a(_.top)+"px; left: "+a(_.left)+'px;" class="_zs_galleryeS mx-shadow"><div>'+a(_.week)+"</div><div><strong>"+a(_.time)+"</strong></div><div><strong>"+a(_.discount)+"</strong>%折扣</div></div>"),f+=" ",b.show&&(f+='<div style="top: '+a(b.top)+"px; left: "+a(b.left)+"px; height: "+a(b.height)+"px; width: "+a(b.width)+'px;" class="_zs_galleryeR"></div>'),f+=" ",v.show&&(f+='<div mxv style="top: '+a(v.top)+"px; left: "+a(v.left)+'px;" class="_zs_galleryeT mx-shadow"><div mxv mxa="_zs_gallerybC:_" class="_zs_galleryeU"><div mxa="_zs_gallerybC:a" class="mb10"><span>'+a(v.week)+'</span>：<strong mxa="_zs_gallerybC:b" class="ml5">'+a(v.time)+'</strong></div><div mxv mxa="_zs_gallerybC:c" class="mb5"><label mxv><input type="radio" class="radio" name="settingType" value="1" mx-change="'+t+'changeSettingType({type:1})" ',1==v.type&&(f+=' checked="true" '),f+="/>自定义：</label>",1==v.type?f+='<input mxe="'+t+"_0\" mxc=\"[{p:'settingInfo.discount',f:{required:true,posint:[true,'范围:30-250的整数'],min:[30,'范围:30-250的整数'],max:[250,'范围:30-250的整数']}}]\" class=\"input w100\" value=\""+a(v.discount)+'"/>':f+='<input class="input w100" disabled="true" value="'+a(v.discount)+'"/>',f+='<span mxs="_zs_gallerybC:_" class="ml5">%</span></div><div mxv mxa="_zs_gallerybC:d" class="mb10"><label mxv><input type="radio" name="settingType" class="radio" value="2" mx-change="'+t+'changeSettingType({type:2})" ',2==v.type&&(f+=' checked="true" '),f+='/>无折扣</label></div><div mxv mxa="_zs_gallerybC:e" class="mb10"><label mxv><input type="radio" name="settingType" class="radio" value="3" mx-change="'+t+'changeSettingType({type:3})" ',3==v.type&&(f+=' checked="true" '),f+='/>不投放</label></div></div><div mxs="_zs_gallerybC:a" class="_zs_galleryeV"><a class="btn btn-small btn-brand mr10 w60" href="javascript:;" mx-click="'+t+'submitSetting()">确定</a><a class="btn btn-small w60" href="javascript:;" mx-click="'+t+'cancelSetting()">取消</a></div></div>'),f+='<div class="_zs_galleryeG clearfix" id="'+a(x)+'_duration" style="width: '+a(m)+'px;"><ul class="_zs_galleryeH fl" style="width: '+a(y*z)+'px;"><li class="_zs_galleryeI" style="height: '+a(w+1)+"px; line-height: "+a(w)+'px;">星期</li>';for(var D=0,N=k.length;D<N;D++){var H=k[D];f+='<li class="_zs_galleryeI" style="height: '+a(I)+"px; line-height: "+a(I)+'px;">'+a(H)+"</li>"}f+='</ul><div class="_zs_galleryeJ fl" style="width: '+a(y*T)+'px;"><ul mxa="_zs_gallerybC:f" class="_zs_galleryeK clearfix">';for(var G=0,S=C.length;G<S;G++){var Z=C[G];f+='<li class="_zs_galleryeL" style="width: '+a(y*(T/4))+"px; height: "+a(w/2)+"px; line-height: "+a(w/2)+'px;">'+a(Z)+"</li>"}f+='</ul><ul mxa="_zs_gallerybC:g" class="_zs_galleryeM clearfix">';for(var J=0;J<24;J+=1)f+='<li class="_zs_galleryeN" style="width: '+a(y*z)+"px; height: "+a(w/2)+"px; line-height: "+a(w/2)+'px;">'+a(J)+"</li>";f+='</ul><ul mxa="_zs_gallerybC:h" class="_zs_galleryeO clearfix">';for(var R=0,W=M.length;R<W;R++){var Q=M[R];f+='<li class="_zs_galleryeP fl" style="width: '+a(y)+"px; height: "+a(I)+"px; background-color: "+a(Q.bg)+'" mx-click="'+t+"clickOutside({index:"+a(Q.index)+'})" mx-mousedown="'+t+'select()" mx-mouseover="'+t+"showTip({index:"+a(Q.index)+'})" mx-mouseout="'+t+"hideTip({index:"+a(Q.index)+'})"></li>'}return f+='</ul></div></div><div mxs="_zs_gallerybC:b" class="pt10 pb10 clearfix"><a class="btn btn-small mr10 fl" href="javascript:;" mx-click="'+t+'clear()">清空</a><a class="btn btn-small mr10 fl" href="javascript:;" mx-click="'+t+'reset()">重置</a><span class="fr lh28 color-c"><span class="_zs_galleryeF" style="background-color: rgba(97,199,242,0.7)"></span><span class="font-tahoma bold color-c mr15">30-100%</span><span class="_zs_galleryeF" style="background-color: rgba(77,166,255,0.7)"></span><span class="font-tahoma bold color-c mr15">100-200%</span><span class="_zs_galleryeF" style="background-color: rgba(134,115,230,0.7)"></span><span class="font-tahoma bold color-c mr15">200-250%</span><i class="mc-iconfont displacement-2">&#xe705;</i><span class="mr10">可以拖拽鼠标选择投放时段</span></span></div></div>'},mixins:[l,i],init:function(e){var t=this;t.updater.snapshot(),t.assign(e),t.on("destroy",function(){o(document.body).off("mousemove.duration"),o(document.body).off("mouseup.duration"),clearTimeout(t.hoverTimeout),clearTimeout(t.hideTimeout)})},assign:function(e){var t=this.updater.altered(),r=/^true$/i.test(e.half),a=e.selected||n,o=r?2:1,s=+e.boxWidth;s||(s=r?18:32);var l=s*(25*o),i=24*o,d=7*i;return this.updater.set({timeDiscount:a,weeks:["一","二","三","四","五","六","日"],ranges:["00:00 - 06:00","06:00 - 12:00","12:00 - 18:00","18:00 - 24:00"],multiple:o,maxWidth:l,rowNum:i,columnNum:7,headerHeight:60,boxWidth:s,boxHeight:40,boxLength:d,boxZones:this.getBoxzone(d),valid:"",maskInfo:{show:!1,left:0,top:0,width:0,height:0,startRow:0,endRow:0,startColumn:0,endColumn:0,selectedZones:[]},settingInfo:{show:!1,week:"",time:"",discount:"",type:1},hoverInfo:{show:!1,left:0,top:0,week:"",time:"",discount:""}}),this.discountColorMap=this.getColorMap(),t||(t=this.updater.altered()),!!t&&(this.updater.snapshot(),!0)},render:function(){for(var e=this.updater.get(),t=e.timeDiscount,r=e.boxLength,a=this.report2Array(t),s=0;s<r;s++)this.setBoxDiscount(s,a[s]);this.updater.digest(),this.wrapper=o("#"+this.id+"_duration")},report2Array:function(e){for(var t=[],r=this.updater.get(),a=r.rowNum,o=r.multiple,s=e.split(";"),l=0,i=s.length;l<i;l++)for(var n=s[l].split(","),d=0,u=n.length;d<u;d++)if("0"!=n[d]){var g=n[d].match(/(\d{2}):(\d{2})-(\d{2}):(\d{2}):(\d+)/),c=parseInt(g[1])*o+a*l;"30"==g[2]&&c++;var h=parseInt(g[3])*o+a*l;"30"==g[4]&&h++;for(var p=parseInt(g[5]),f=c;f<=h-1;f++)t[f]=p}return t},setBoxDiscount:function(e,t){t=parseInt(t)||0;var r=this.discountColorMap[t],a=this.updater.get("boxZones");a[e].bg=r,a[e].discount=t,this.updater.set({boxZones:a})},"select<mousedown>":function(e){e.preventDefault();var t=this,r=(t.updater,t.updater.get()),a=r.hoverInfo,s=r.settingInfo,l=r.maskInfo,i=r.boxWidth,n=r.multiple,d=r.headerHeight;a.show=!1,s.show=!1;var u=t.wrapper,g=u.offset().left,c=u.offset().top,h=e.pageX-g,p=e.pageY-c;o(document.body).off("mousemove.duration").on("mousemove.duration",function(e){e.preventDefault();var r=e.pageX-g,o=e.pageY-c,f=Math.min(r,u.outerWidth()),m=Math.min(o,u.outerHeight()),_=Math.max(i*n,Math.min(h,f)),b=Math.max(d,Math.min(p,m));l.left=_,l.top=b+1,l.width=Math.max(h,f)-_,l.height=Math.max(p,m)-b,l.show=!0,t.updater.digest({hoverInfo:a,settingInfo:s,maskInfo:l})}),o(document.body).off("mouseup.duration").on("mouseup.duration",function(e){l.show&&(e.preventDefault(),o(document.body).off("mousemove.duration"),t.selectEnd(),o(document.body).off("mouseup.duration"))})},selectEnd:function(e){for(var t=this.updater.get(),r=t.maskInfo,a=t.headerHeight,o=t.boxHeight,s=t.boxWidth,l=t.multiple,i=t.columnNum,n=t.rowNum,d=parseInt((r.top-a)/o),u=parseInt((r.height+r.top-a)/o),g=parseInt((r.left-s*l)/s),c=parseInt((r.width+r.left-s*l)/s),h=Math.max(0,d),p=Math.min(i-1,u),f=Math.max(0,g),m=Math.min(n-1,c),_=[],b=h;b<=p;b++)for(var v=f;v<=m;v++)_.push(b*n+v);r.selectedZones=_,r.startRow=h,r.endRow=p,r.startColumn=f,r.endColumn=m,r.left=s*l+f*s,r.top=a+h*o+1,r.width=(m-f+1)*s,r.height=(p-h+1)*o,r.show=!0,this.showSetting()},"clickOutside<click>":function(e){var t=+e.params.index,r=this.updater.get("maskInfo");!r.show||r.show&&r.selectedZones.indexOf(t)>-1||(e.preventDefault(),o(document.body).off("mousemove.duration"),o(document.body).off("mouseup.duration"),o(document.body).off("click.duration"),this["cancelSetting<click>"]())},"changeSettingType<change>":function(e){var t=this.updater,r=t.get("settingInfo");r.type=e.params.type,t.digest({settingInfo:r})},"submitSetting<click>":function(){var e=this.updater.get(),t=e.settingInfo,r=e.maskInfo,a=0,o=!0;switch(+t.type){case 1:o=this.isValid(),a=this.fromKeys(e,"settingInfo").settingInfo.discount;break;case 2:a=100;break;case 3:a=0}if(o){t.show=!1,t.type=1,r.show=!1;for(var s=0;s<r.selectedZones.length;s++)this.setBoxDiscount(r.selectedZones[s],a);this.updater.digest({settingInfo:t,maskInfo:r})}},"cancelSetting<click>":function(){var e=this.updater.get(),t=e.settingInfo,r=e.maskInfo;r.show=!1,t.show=!1,t.type=1,this.updater.digest({settingInfo:t,maskInfo:r})},showSetting:function(){var e,t=this.updater.get(),r=t.settingInfo,a=t.maskInfo,o=t.boxZones,s=a.startRow+1,l=a.endRow+1;e=s!=l?this.formatweek(s)+" - "+this.formatweek(l):this.formatweek(s),r.week=e,r.time=this.getDuration(a.startColumn,a.endColumn+1,"%s - %s");for(var i,n=a.selectedZones,d=!0,u=0;u<n.length;u++){var g=o[n[u]].discount;if(!g||i&&g!=i){d=!1;break}i=g}r.discount=d?i:"";var c=this.wrapper.outerWidth(),h=this.wrapper.outerHeight(),p=a.left+a.width/2;p+260>c&&(p-=260);var f=a.top+a.height/2;f+238>h+100&&(f-=238),r.left=p,r.top=f,r.show=!0,this.updater.digest({boxZones:o,settingInfo:r,maskInfo:a})},"showTip<mouseover>":function(e){if(!a.default.inside(e.relatedTarget,e.eventTarget)){var t=this;clearTimeout(t.hoverTimeout),clearTimeout(t.hideTimeout);var r=t.updater,o=r.get(),s=o.maskInfo,l=o.settingInfo,i=o.boxWidth,n=o.boxHeight,d=o.headerHeight,u=o.rowNum,g=o.hoverInfo,c=o.boxZones;s.show||l.show||(t.hoverTimeout=setTimeout(function(){var a=parseInt(e.params.index),o=i+(a%u+1)*i,s=d+(parseInt(a/u)+1)*n,l=t.formatweek(parseInt(a/u)+1),h=t.getDuration(a,a+1,"%s - %s"),p=c[a].discount;g.left=o,g.top=s,g.week=l,g.time=h,g.discount=p,g.show=!0,r.digest({hoverInfo:g})},200))}},"hideTip<mouseout>":function(e){if(!a.default.inside(e.relatedTarget,e.eventTarget)){var t=this;clearTimeout(t.hoverTimeout),clearTimeout(t.hideTimeout);var r=t.updater.get(),o=r.maskInfo,s=r.settingInfo,l=r.hoverInfo;o.show||s.show||(t.hideTimeout=setTimeout(function(){l.show=!1,t.updater.digest({hoverInfo:l})},200))}},"reset<click>":function(e){for(var t=this.updater.get("boxLength"),r=0;r<t;r++)this.setBoxDiscount(r,100);this.updater.digest()},"clear<click>":function(e){for(var t=this.updater.get("boxLength"),r=0;r<t;r++)this.setBoxDiscount(r,0);this.updater.digest()},array2Report:function(e){for(var t=this,r=t.updater.get(),a=r.columnNum,o=r.rowNum,s=(r.multiple,[]),l=0;l<a;l++){s[l]=0;for(var i=[],n=0;n<o;n++){var d=e[l*o+n];if(d){var u=i[i.length-1];u&&u.discount==d&&u.end==n?u.end=n+1:i.push({start:n,end:n+1,discount:d})}}var g=i.map(function(e){return t.getDuration(e.start,e.end)+":"+e.discount});g&&g.length>0&&(s[l]=g.join(","))}return s.join(";")},val:function(){var e=this.updater.get("boxZones").map(function(e){return e.discount});return this.array2Report(e)},submit:function(){var e=this.val();return e==n?{ok:!1}:{ok:!0,val:e}},update:function(e){for(var t=this.updater.get(),r=(e=t.timeDiscount,t.boxLength),a=this.report2Array(e),o=0;o<r;o++)this.setBoxDiscount(o,a[o])},formatweek:function(e){return"星期"+["日","一","二","三","四","五","六"][e%7]},getDuration:function(e,t,r){var a=this.updater.get("rowNum"),o=this.getTimeFromNum(e),s="",l=o+"-"+(s=t%a==0?"24:00":this.getTimeFromNum(t));return r&&(l=r.replace("%s",o).replace("%s",s)),l},getTimeFromNum:function(e){var t=this.updater.get(),r=t.rowNum,a=t.multiple,o=Math.floor(e%r/a);return 1==(o+"").length&&(o="0"+o),o+":"+(e%r%a==1?"30":"00")},getBoxzone:function(e){for(var t=[],r=0;r<e;r++)t.push({index:r,bg:"#ffffff",discount:0});return t},getColorMap:function(e){for(var t={"[0,1)":"#ffffff","[30,40)":"rgba(97,199,242,0.05)","[40,50)":"rgba(97,199,242,0.1)","[50,60)":"rgba(97,199,242,0.15)","[60,70)":"rgba(97,199,242,0.2)","[70,80)":"rgba(97,199,242,0.25)","[80,90)":"rgba(97,199,242,0.3)","[90,100)":"rgba(97,199,242,0.35)","[100,101)":"rgba(97,199,242,0.4)","[101,110)":"rgba(77,166,255,0.15)","[110,120)":"rgba(77,166,255,0.2)","[120,130)":"rgba(77,166,255,0.25)","[130,140)":"rgba(77,166,255,0.3)","[140,150)":"rgba(77,166,255,0.35)","[150,160)":"rgba(77,166,255,0.4)","[160,170)":"rgba(77,166,255,0.45)","[170,180)":"rgba(77,166,255,0.5)","[180,190)":"rgba(77,166,255,0.55)","[190,200)":"rgba(77,166,255,0.6)","[200,210)":"rgba(134,115,230,0.3)","[210,220)":"rgba(134,115,230,0.35)","[220,230)":"rgba(134,115,230,0.4)","[230,240)":"rgba(134,115,230,0.45)","[240,250)":"rgba(134,115,230,0.5)","[250,251)":"rgba(134,115,230,0.55)"},r={},a=0;a<=250;a++)for(var o in r[a]="#ffffff",t){var s=o.substring(1,o.length-1).split(","),l=s[0],i=s[1];if(a>=l&&a<i){r[a]=t[o];break}}return r}})});