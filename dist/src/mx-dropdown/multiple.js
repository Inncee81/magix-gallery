define("mx-dropdown/multiple",["magix","$","../mx-util/monitor","../mx-medusa/util","mx-checkbox/index"],(e,t,a)=>{e("mx-checkbox/index");var l=e("magix"),i=e("$"),s=e("../mx-util/monitor"),r=e("../mx-medusa/util");l.applyStyle("_zs_galleryH","._zs_galleryea{min-width:600px}._zs_galleryea ._zs_galleryeb{float:left;width:25%}._zs_galleryea ._zs_galleryec{margin-bottom:10px}._zs_galleryed{padding-top:10px;padding-left:18px;padding-right:18px;line-height:16px}._zs_galleryed ._zs_galleryee{float:left;padding-right:20px;color:#999}._zs_galleryed ._zs_galleryee:hover{color:var(--color-brand)}._zs_galleryed._zs_galleryef{padding-left:12px;padding-right:12px}._zs_galleryeg ._zs_galleryeh{height:auto}._zs_galleryei img{display:none}"),a.exports=l.View.extend({tmpl:function(e,t,a,l,i,s,r,c){if(a||(a=e),!i){var n={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},u=/[&<>"'`]/g,_=function(e){return"&"+n[e]+";"};i=function(e){return""+(null==e?"":e)},l=function(e){return i(e).replace(u,_)}}if(!s){var o={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},d=function(e){return o[e]},p=/[!')(*]/g;s=function(e){return encodeURIComponent(i(e)).replace(p,d)}}if(!c){var m=/[\\'"]/g;c=function(e){return i(e).replace(m,"\\$&")}}var g="",h=e.viewId,x=e.expand,v=e.selectedText,f=e.placementClass,b=e.over,y=e.menuStyles,k=e.rList,z=e.searchbox,w=e.text,j=e.keyword,T=e.max,E=e.imme,C=e.needAll,O=e.hasGroups,A=e.spm,I=e.allHide,M=e.height,L=e.groups,P=e.errMsg;if(g+='<div id="toggle_'+l(h)+'" class="mx-trigger ',x&&(g+=" mx-trigger-open "),g+='"><span mxa="_zs_gallerybm:_" class="mx-trigger-label">'+i(v)+'</span><span mxs="_zs_gallerybm:_" class="mc-iconfont mx-trigger-arrow">&#xe692;</span></div><div mxv id="menu_'+l(h)+'" class="mx-output '+l(f)+" ",x&&(g+=" mx-output-open "),g+=" ",b&&(g+=" _zs_galleryea "),g+='" ',y&&(g+=' style="'+l(y)+'" '),g+=">",k){if(g+=" ",z&&(g+='<div mxv mxa="_zs_gallerybm:a" class="mx-output-search"><div mxv class="search-box" style="',g+=b?" width: 200px; ":" width: 100%; ",g+='"><i mxs="_zs_gallerybm:a" class="mc-iconfont search-icon">&#xe651;</i><input class="input search-input" placeholder="'+l(w.search)+'" mx-keyup="'+t+'__g()" mx-paste="'+t+'__g()" mx-change="'+t+'__m()" mx-focusin="'+t+'__m()" mx-focusout="'+t+'__m()" value="'+l(j)+'"/></div>',T>0&&b&&(g+='<span mxa="_zs_gallerybm:b" class="ml10"><span mxs="_zs_gallerybm:b" class="color-9">已选：</span><span mxa="_zs_gallerybm:c" class="font-tahoma bold">'+l(E.length)+" / "+l(T)+"</span></span>"),g+="</div>"),g+=" ",(!C||T>0&&!b)&&(g+='<div class="_zs_galleryed ',O&&(g+=" _zs_galleryef "),g+=' clearfix">',C||(g+='<a class="_zs_galleryee" href="javascript:;" mx-click="'+t+'__bX({checked:true})" data-spm-click="'+l(A)+'a">'+l(w.select)+'</a><a class="_zs_galleryee" href="javascript:;" mx-click="'+t+'__bX({checked:false})" data-spm-click="'+l(A)+'ua">'+l(w.unselect)+"</a>"),g+=" ",T>0&&!b&&(g+="<span ",C||(g+=' class="fr" '),g+='><span mxs="_zs_gallerybm:b" class="color-9">已选：</span><span mxa="_zs_gallerybm:d" class="font-tahoma bold">'+l(E.length)+" / "+l(T)+"</span></span>"),g+="</div>"),g+=" ",I)g+='<div mxa="_zs_gallerybm:h" class="text-center color-9 pt20 pb20">'+l(w.empty)+"</div>";else{g+='<div mxv class="mx-output-list" id="list_'+l(h)+'" style="max-height:'+l(M)+'px;">';for(var K=0,R=L.length;K<R;K++){var S=L[K];g+=" ",S.text&&!S.hide&&(g+=" ",S.all?g+='<div mxa="_zs_gallerybm:e" class="clearfix"><div title="'+l(S.text)+'" class="mx-output-item _zs_galleryeb"><label mxa="_zs_gallerybm:f" class="mx-output-link"><span mx-focusout="'+t+'__m()" mx-change="'+t+"__cj({groupIndex:'"+l(c(K))+'\'})" data-spm-click="'+l(A)+'" mx-view="mx-checkbox/index?disabled='+s(T>0&&E.length>=T)+"&indeterminate="+s(2==S.type)+"&checked="+s(3==S.type)+'"></span>'+i(S.text)+"</label></div></div>":g+='<div class="mx-output-header" title="'+l(S.text)+'">'+i(S.text)+"</div>",g+=" "),g+='<div mxv mxa="_zs_gallerybm:g" class="clearfix _zs_galleryec">';for(var H=0,Q=S.list,V=Q.length;H<V;H++){var W=Q[H];g+=" ",W.hide||(g+='<div mxv class="mx-output-item _zs_galleryeb" title="'+l(W.text)+'"><label mxv for="'+l(h)+"_"+l(W.value)+'" class="mx-output-link"><input type="checkbox" class="checkbox" ',!W.checked&&T>0&&E.length>=T&&(g+=' disabled="true" '),g+=" ",W.checked&&(g+=' checked="true" '),g+=' id="'+l(h)+"_"+l(W.value)+'" mx-focusout="'+t+'__m()" mx-change="'+t+"__ck({groupIndex:'"+l(c(K))+"',value:'"+l(c(W.value))+'\'})" data-spm-click="'+l(A)+'"/>'+i(W.text)+"</label></div>"),g+=" "}g+="</div>"}g+="</div>"}g+='<div mxa="_zs_gallerybm:i" class="mx-output-footer"><div><a mxa="_zs_gallerybm:j" href="javascript:;" class="btn btn-small btn-brand mr10" mx-click="'+t+'__aM({enter:true})">'+l(w.submit)+'</a><a mxa="_zs_gallerybm:k" href="javascript:;" class="btn btn-small" mx-click="'+t+'__n()">'+l(w.cancel)+"</a></div>",P&&(g+='<div mxa="_zs_gallerybm:l" class="color-red mt10"><i mxs="_zs_gallerybm:c" class="mc-iconfont displacement-2">&#xe6ad;</i>'+i(P)+"</div>"),g+="</div>"}return g+="</div>"},init:function(e){var t=this;s.__h(),t.on("destroy",function(){s.__i(t),s.__j()}),t.updater.set({viewId:t.id});var a=i("#"+t.id);t.__a=a,t.__k=e.disabled+""=="true"||i("#"+t.id)[0].hasAttribute("mx-disabled");var c=e.placement||"bottom";t.__ch="mx-output-"+c,t.__bP=e.triggerType||"click";var n=e.emptyText||r.choose,u=e.name||"",_=e.needAll+""=="false",o=e.searchbox+""=="true",d=e.textKey||"text",p=e.valueKey||"value",m=!1,g=[];if(e.list){try{list=JSON.parse(e.list)}catch(t){list=e.list||[]}"object"==typeof list[0]?list=list.map(function(e){return{text:e[d],value:e[p]}}):list=list.map(function(e){return{text:e,value:e}}),g=[{list:list}]}else{var h=t.__a.children();if("true"==i(h[0]).attr("group"))m=!0,h.each(function(e,t){if("true"==(t=i(t)).attr("group"))g.push({all:"true"==t.attr("all"),text:t.text(),value:l.guid(),list:[]});else{var a=g.length;g[a-1].list.push({text:t.text(),value:t.attr("value")})}});else{var x=[];h.each(function(e,t){t=i(t),x.push({text:t.text(),value:t.attr("value")})}),g=[{list:x}]}}var v,f=0,b={};e.selected?i.isArray(e.selected)?(t.__bK="array",v=e.selected.map(function(e){return""+e})):v=(e.selected+"").split(","):v=[],g.forEach(function(e){var t=[];e.list.forEach(function(e){f++,e.checked=v.indexOf(e.value+"")>-1,b[e.value]=e,e.checked&&t.push(e.value)}),e.type=t.length>0?t.length==e.list.length?3:2:1});var y=+e.min||0,k=+e.max||0;k>0&&y>k&&(y=k),t.updater.set({submitChecker:e.submitChecker,hasGroups:m,viewId:t.id,expand:!1,emptyText:n,name:u,needAll:_,searchbox:o,map:b,selected:v,imme:v,min:y,max:k,continuous:e.continuous+""=="true",over:f>20,groups:g,height:e.height||400,spm:t.__a.attr("data-spm-click")||"",placementClass:t.__ch,text:{search:r["dropdown.search"],select:r["select.all"],unselect:r["unselect.all"],submit:r["dialog.submit"],cancel:r["dialog.cancel"],empty:r["empty.text"]}})},render:function(){var e=this,t=e.updater.get("selected");e.updater.digest({selectedText:e.__ci(t)}),e.__bR();var a=e.__bP,l=i("#toggle_"+e.id),s=i("#menu_"+e.id);switch(a){case"click":l.on("click",function(){e.updater.get("expand")?e.__n():e.__k||e.__o()});break;case"hover":l.hover(function(){clearTimeout(e.__bO),e.__o()},function(){e.__bQ()}),s.hover(function(){clearTimeout(e.__bO)},function(){e.__bQ()})}},__l:function(e){return l.inside(e,this.id)},__bQ:function(){var e=this;clearTimeout(e.__bO),e.__bO=setTimeout(e.wrapAsync(function(){e.__n()}),250)},__bR:function(){var e=this.updater.get("selected");"array"==this.__bK?this.__a.val(e):this.__a.val(e.join(","))},__n:function(){var e=this,t=e.updater.get();if(t.expand){e.updater.digest({expand:!1}),e.__a.trigger("focusout"),s.__i(e);var a=t.selected,l=t.groups;l.forEach(function(e){var t=[];e.list.forEach(function(e){e.checked=a.indexOf(e.value+"")>-1,e.checked&&t.push(e.value)}),e.type=t.length>0?t.length==e.list.length?3:2:1}),e.updater.digest({groups:l,selected:a,imme:a,selectedText:e.__ci(a)}),e.__bR()}},__o:function(){var e=this,t=e.updater.get();if(!t.expand){var a={expand:!0};t.rList||(a.rList=!0);var l=i("#menu_"+e.id),r=i(window).width(),c=e.__a.offset(),n=l.outerWidth(),u=void 0;c.left+n>r&&(u=Math.min(c.left+n-r,c.left)),u>0&&(a.menuStyles="left:"+(0-u)+"px"),e.updater.digest(a),e.__a.trigger("focusin"),s.__q(e)}},__ci:function(e){var t=this.updater.get(),a=t.emptyText;if(0==e.length)return a;for(var l=t.map,i=[],s=0,c=e;s<c.length;s++){var n=l[c[s]]||{};i.push(n.text)}var u=t.name;return i.length==Object.keys(l).length?u?r["dropdown.all.custom"]+u:r["dropdown.all.default"]:i.join(",")},__bV:function(e,t){var a,l=this.updater.get().groups;if(e){a=!0;var i=(e+"").toLocaleLowerCase();l.forEach(function(e){var t=!0;e.list.forEach(function(e){var a=(e.text+"").toLocaleLowerCase();e.hide=a.indexOf(i)<0,t=t&&e.hide}),e.hide=t,a=a&&t})}else a=!1,l.forEach(function(e){e.hide=!1,e.list.forEach(function(e){e.hide=!1})});t({groups:l,allHide:a})},"__g<keyup,paste>":function(e){var t=this;clearTimeout(t.__bZ);var a=i.trim(e.eventTarget.value);t.updater.set({keyword:a}),t.__bZ=setTimeout(t.wrapAsync(function(){a!=t.__bW&&t.__bV(t.__bW=a,function(e){t.updater.digest(e)})}),250)},"__ck<change>":function(e){e.stopPropagation();var t=e.params.value,a=e.params.groupIndex,l=e.target.checked;this.__cj(a,t,l)},"__bX<click>":function(e){var t=e.params.checked;this.__cj("all","all",t)},"__cj<change>":function(e){e.stopPropagation();var t=e.params.groupIndex,a=e.target.checked;this.__cj(t,"all",a)},__cj:function(e,t,a){var l=this,i=l.updater.get().groups,s=(i=l.updater.get("groups"),l.updater.get("max")),r=l.updater.get("imme"),c=0;s>0&&(c=s-r.length);var n=[];i.forEach(function(l,i){var r=[];l.list.forEach(function(l){"all"!==e&&e!=i||"all"!=t&&t!=l.value||(a?s>0?c>0&&!l.checked&&(l.checked=!0,c-=1):l.checked=!0:l.checked=!1),l.checked&&r.push(l.value)}),l.type=r.length>0?r.length==l.list.length?3:2:1,n=n.concat(r)}),l.updater.digest({groups:i,imme:n})},"__m<change,focusin,focusout>":function(e){e.stopPropagation()},"__aM<click>":function(e){var t=this,a=t.updater.get(),l=a.groups,s=[],r=[],c=0;l.forEach(function(e){e.list.forEach(function(e){if(c+=1,e.checked){s.push(e.value+"");var t=r.length;0==t?r.push(c):r[t-1]+1==c?r[t-1]=c:r.push(c)}})});var n=function(){var e=t.updater.get("min");if(e>0&&s.length<e)t.updater.digest({errMsg:"请至少选择"+e+"个"});else{if(t.updater.get("continuous")&&s.length>0){var l=t.updater.get("name")||"数据";if(r.length>1)return void t.updater.digest({errMsg:"请选择连续的"+l})}t.updater.set({errMsg:"",selected:s}),t.__n();var c=a.map,n=s.map(function(e){return c[e].text});t.__a.trigger({type:"change",texts:n,values:s,selected:i("#"+t.id).val()})}};a.submitChecker?a.submitChecker(s).then(function(e){e?t.updater.digest({errMsg:e}):n()}):n()},"__n<click>":function(e){this.__n()}})});