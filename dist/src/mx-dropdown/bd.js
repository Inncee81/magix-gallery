define("mx-dropdown/bd",["magix","$","../mx-util/view","../mx-util/monitor","../mx-medusa/util"],(e,t,i)=>{"use strict";t.__esModule=!0;var n=e("magix"),a=e("$"),_=e("../mx-util/view"),r=e("../mx-util/monitor"),u=e("../mx-medusa/util");t.default=_.extend({tmpl:function(e,t,i,n,a,_,r,u){if(i||(i=e),!a){var o={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},d=/[&<>"'`]/g,l=function(e){return"&"+o[e]+";"};a=function(e){return""+(null==e?"":e)},n=function(e){return a(e).replace(d,l)}}if(!_){var s={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},c=function(e){return s[e]},p=/[!')(*]/g;_=function(e){return encodeURIComponent(a(e)).replace(p,c)}}if(!u){var m=/[\\'"]/g;u=function(e){return a(e).replace(m,"\\$&")}}var f="",b=e.viewId,x=e.expand,h=e.selectedText;return f+='<div id="toggle_'+n(b)+'" class="mx-trigger ',x&&(f+=" mx-trigger-open "),f+='"><span mxa="_zs_gallerya&:_" class="mx-trigger-label}">'+n(h)+'</span><span mxs="_zs_gallerya&:_" class="mc-iconfont mx-trigger-arrow">&#xe692;</span></div>'},init:function(e){var t=this;r.__k();var i=a("#"+t.id);t.__a=i;var _=e.selected;a.isArray(_)?t.__bN="array":_=_?(_+"").split(","):[];var o,d=e.textKey||"text",l=e.valueKey||"value",s=e.list||[],c=e.parents||[],p=e.parentKey||"pValue";if("object"==typeof s[0])if(s=s.map(function(e){return n.default.mix(e,{text:e[d],value:e[l],pValue:e[p]}),e}),0==c.length)o=!1,c=[{text:"组",value:"all",list:s}];else{o=!0;var m={};s.forEach(function(e){var t=e.pValue;m[t]=m[t]||[],m[t].push(e)});for(var f=0;f<c.length;f++){var b=c[f],x=b.value;b.list=m[x]||[],0==b.list.length&&b.splice(f--,1)}}else o=!1,c=[{text:"组",value:"all",list:s=s.map(function(e){return{text:e,value:e}})}];var h=e.multiple+""=="true",v=n.default.toMap(s,l),g=[];if(_.forEach(function(e){var t=v[_];a.isEmptyObject(t)||g.push(t)}),!h&&0==g.length){g=[s[0]];for(f=0;f<s.length;f++)if(!s[f].disabled){g=[s[f]];break}}switch(t.__n=e.disabled+""=="true"||a("#"+t.id)[0].hasAttribute("mx-disabled"),t.__bO=!1,t.updater.set({searchbox:e.searchbox+""=="true",multiple:h,emptyText:e.emptyText||u.choose,hasGroups:o,parents:c,selectedItems:g,expand:!1,height:e.height||250}),t.on("destroy",function(){t.__a.off("mouseenter mouseleave"),t.__bP&&clearTimeout(t.__bP),t.__bQ&&clearTimeout(t.__bQ),a("#dd_bd_"+t.id).remove(),r.__l(t),r.__m()}),t.__bR=e.triggerType||"click",t.__bR){case"click":i.on("click",function(){t.__bP=setTimeout(t.wrapAsync(function(){t.updater.get("expand")?t.__q():t.__n||t.__r()}),100)});break;case"hover":i.hover(function(){clearTimeout(t.__bQ),t.__bP=setTimeout(t.wrapAsync(function(){t.__n||t.__r()}),100)},function(){t.__bS()})}},render:function(){this.updater.digest({}),this.__bT()},__bT:function(e){var t,i=this,n=i.updater.get(),a=n.selectedItems,_=n.emptyText,r=[],u=[];a.forEach(function(e){r.push(e.text),u.push(e.value)}),i.updater.digest({selectedText:r.join(",")||_}),t="array"==i.__bN?u:u.join(","),i.__a.val(t),e&&i.__a.trigger({type:"change",selected:t,values:u,texts:r,value:u.join(","),text:r.join(",")})},__bW:function(){var e=this,t=a("#toggle_"+e.id).outerWidth(),i=e.id,n='<div class="mx-output mx-output-bottom" id="dd_bd_'+i+'"\n                style="min-width: '+t+"px; max-width: "+2*t+'px;"></div>';a(document.body).append(n);var _=e.owner.mountVframe("dd_bd_"+i,"");_.on("created",function(){var t=e.__bU();"hover"==e.__bR&&t.hover(function(){clearTimeout(e.__bQ)},function(){e.__bS()})}),e.__bV=_},__o:function(e){return n.default.inside(e,this.id)||n.default.inside(e,"dd_bd_"+this.id)},__r:function(){var e=this;clearTimeout(e.__bP),e.__bO||(e.__bO=!0,e.__bW());var t=e.updater.get();t.expand||(e.__bV.mountView("mx-dropdown/content",{data:t,submit:function(t){e.__q(),e.updater.set(t),e.__bT(!0)},cancel:function(){e.__q()}}),e.updater.digest({expand:!0}),e.__bU().addClass("mx-output-open"),r.__t(e))},__bS:function(){var e=this;clearTimeout(e.__bP),clearTimeout(e.__bQ),e.__bQ=setTimeout(e.wrapAsync(function(){e.__q()}),200),r.__l(e)},__q:function(){var e=this;(clearTimeout(e.__bQ),e.updater.get("expand"))&&(e.updater.digest({expand:!1}),a("#dd_bd_"+e.id).removeClass("mx-output-open"),r.__l(e))},__bU:function(){var e=this.__a,t=a("#dd_bd_"+this.id),i=e.outerWidth(),n=e.outerHeight(),_=e.offset(),r=t.outerWidth(),u=(t.outerHeight(),_.top+n),o=_.left-(r-i)/2;return t.css({left:o,top:u}),t},"$win<scroll>":function(e){this.updater.get("expand")&&this.__bU()},"$doc<dialogScolll>":function(e){this.updater.get("expand")&&this.__bU()}})});