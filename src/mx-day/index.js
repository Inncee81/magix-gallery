define("mx-day/index",["magix","$","mx-dropdown/index","./month"],(e,a,t)=>{e("mx-dropdown/index"),e("./month");var _=e("magix"),n=e("$");_.applyStyle("_k","._bR{padding:0;height:38.4px}._bS{border:none}._bT{border-right:1px solid #e6e6e6}");var i=function(e,a){var t=a[e];if(!t){t=[];for(var _=12;_--;)t[_]="";a[e]=t}return t},r=[{key:"MON",day:"一"},{key:"TUE",day:"二"},{key:"WED",day:"三"},{key:"THU",day:"四"},{key:"FRI",day:"五"},{key:"SAT",day:"六"},{key:"SUN",day:"日"}];t.exports=_.View.extend({tmpl:function(e,a){a=a||"";var t="",_={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},n=/[&<>"'`]/g,i=function(e){return null==e?"":""+e},r=function(e){return"&"+_[e]+";"},s=function(e){return i(e).replace(n,r)},d={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},o=function(e){return d[e]},c=/[!')(*]/g,h=function(e){return encodeURIComponent(i(e)).replace(c,o)},l=/[\\'"]/g;t+='<table mxa="_4:_" class="_W"><thead><tr><th mxs="_4:_" class="_bR _a_" width="120">周期设置</th><th mxa="_4:a" class="_bR _Z" colspan="31">';for(var y=0;y<e.weeks.length;y++)t+='<label mxa="_4:b" class="_h _t"><input mx-change="'+a+"__aV({key:'"+s((m=e.weeks[y].key,i(m).replace(l,"\\$&")))+'\'})" id="'+s(e.viewId)+"_"+s(e.weeks[y].key)+'" type="checkbox" class="_as"/>每周'+s(e.weeks[y].day)+"</label>";var m;t+='</th></tr><tr><th mxa="_4:c" class="_bR _a_"><div mx-change="'+a+'__aT()" style="width:100px" class="_g _s" mx-view="mx-dropdown/index?list=',t+=function(a,t,_){for(_=e[""];--_;)if(e[t=""+_]===a)return t;return e[t=""+e[""]++]=a,t}(e.years),t+="&selected="+i(h(e.selectedYear))+'"></div></th><th mxa="_4:d" colspan="31" class="_bR"><table mxa="_4:e" class="_W _X"><tbody><tr>';for(var u=1;u<32;u++)t+='<td class="_bR _a_ _bS',u<30&&(t+=" _bT"),t+='">'+s(("0"+u).slice(-2))+"</td>";t+="</tr></tbody></table></th></tr></thead><tbody>";for(var v=0;v<12;v++)t+='<tr><td class="_bR _ad _a_" mx-click="'+a+"__aY({m:"+i(v)+'})">'+s(("0"+(v+1)).slice(-2))+'</td><td class="_bR" colspan="31" id="months_'+s(v)+"_"+s(e.viewId)+'" mx-change="'+a+"__aX({m:"+i(v)+'})" mx-sync="'+a+"__aX({m:"+i(v)+'})" mx-view="mx-day/month?year='+i(h(e.selectedYear))+"&month="+i(h(v))+"&selected="+i(h(e.days[v]))+'"></td></tr>';return t+="</tbody></table>"},init:function(e){this.assign(e);var a=n("#"+this.id);this.__k=a},assign:function(e){return e.years||(e.years=[(new Date).getFullYear()]),this.__aO=e.years,this.__aP=e.selectedYear||e.years[0],this.__aQ=function(e){e=e||{};for(var a in e){var t=e[a];(t=((t=t||"")+"").split(",")).length>12&&(t=t.slice(0,12));for(var _=0;_<12;_++)t[_]||(t[_]="");e[a]=t}return e}(e.selectedDays),!0},render:function(){var e=this.__aP,a=i(e,this.__aQ);this.updater.digest({viewId:this.id,weeks:r,years:this.__aO,selectedYear:e,days:a})},__aS:function(){for(var e={},a=r.length;a--;)e[r[a].key]=1;this.__k.find('[mx-view*="mx-day/month"]').each(function(a,t){for(var _=t.vframe.invoke("__aR"),n=_.length;n--;)delete e[_[n]]});for(a=r.length;a--;){var t=r[a].key;n("#"+this.id+"_"+t).prop("checked",!!e[t])}},"__aT<change>":function(e){e.stopPropagation();var a=i(e.value,this.__aQ);this.updater.digest({days:a,selectedYear:this.__aP=e.value})},__x:function(){var e=this.__aQ;this.__k.val(e).trigger({type:"change",days:e})},"__aV<change>":function(e){e.stopPropagation();this.__k.find('[mx-view*="mx-day/month"]').each(function(a,t){var _=t.vframe;_&&_.invoke("__aU",[e.params.key,e.eventTarget.checked])}),this.__x()},"__aX<change,sync>":function(e){e.stopPropagation();var a=this;i(a.__aP,a.__aQ)[e.params.m]=e.days,e.ignoreSync||(clearTimeout(a.__aW),a.__aW=setTimeout(function(){a.__aS()},20)),"change"==e.type&&a.__x()},"__aY<click>":function(e){var a=e.params.m,t=n("#months_"+a+"_"+this.id),_=i(this.__aP,this.__aQ)[a];_=new Array(_.length+1).join(_.indexOf("0")>-1?"1":0),t.invokeView("__s",[_]),this.__x()}})});