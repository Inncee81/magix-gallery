define("mx-hour/week",["magix","$","../mx-monitor/index","./index"],(e,t,a)=>{var i=e("magix"),_=e("$"),d=e("../mx-monitor/index");i.applyStyle("_w","._ds{padding:0;height:38.4px;text-align:center}._dt{text-align:left;padding-left:10px}._du{border:none}._dv{border-right:1px solid #e6e6e6}._dw{visibility:hidden}._dx:hover ._dw{visibility:visible}._dy{position:absolute;display:none;background-color:#fff;border:1px solid #e6e6e6;border-radius:4px;padding:10px;margin-top:10px;z-index:10}._dz{margin-bottom:10px;width:300px;border-bottom:1px solid #e6e6e6}._dA{margin:0 25px 10px 0}._dB{visibility:visible}");var s=e("./index"),n="111111111111111111111111",c="000000000000000000000000",r=function(e){var t=0;for(e=(e=(e+"").split(",")).slice(t,7);t<7;)e[t]=s.improve(e[t]),t++;return e};a.exports=i.View.extend({tmpl:{html:'<div mx-guid="g0" class="_dy" id="dlg_<%=$$.viewId%>"><div mx-guid="g1" class="_dz">2</div><div><button type="button" class="_an _ao" mx-click="__cG()">确认</button><button type="button" mx-click="__cF()" class="_an _s">取消</button></div></div><table class="_W"><thead><tr><th class="_ds" width="100">快捷设置</th><th colspan="2" class="_ds _dt"><label class="_t"><input mx-guid="g2" class="_at" type="radio" mx-change="__cD({type:0})" name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>> 全日程投放</label><label class="_v"><input mx-guid="g3" class="_at" type="radio" mx-change="__cD({type:1})" name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>> 工作日（周一至周五）投放</label><label class="_v"><input mx-guid="g4" class="_at" type="radio" mx-change="__cD({type:2})" name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>> 休息日（周六、周日）投放</label></th></tr><tr><th class="_ds">时间</th><th class="_ds"><table class="_W"><tbody><tr><%for(var a=0;a<24;a++){%><td class="_ds _du<%if(a<23){%> _dv<%}%>"><%=(\'0\'+a).slice(-2)%></td><%}%></tr></tbody></table></th><th width="80" class="_ds">操作</th></tr></thead><tbody mx-guid="g6">4</tbody></table>',subs:[{keys:["viewId"],path:'div[mx-guid="g0"]',attr:'id="dlg_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{keys:["days","currentClone"],path:'div[mx-guid="g1"]',tmpl:'<%for(var _=0;_<$$.days.length;_++){%><label class="_dA<%if(_==$$.currentClone){%> _am<%}%>"><input class="_h" type="checkbox" value="<%=_%>" <%if(_==$$.currentClone){%> disabled<%}%>>周<%=$$.days.charAt(_)%></label><%}%>',s:"2"},{keys:["viewId","allDays"],path:'input[mx-guid="g2"]',attr:'name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekdays"],path:'input[mx-guid="g3"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekends"],path:'input[mx-guid="g4"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["days","viewId"],path:'tbody[mx-guid="g6"]',tmpl:'<%for(var b=0;b<$$.days.length;b++){%><tr class="_dx"><td class="_ds _ad" mx-click="__ax({day:<%=b%>})">周<%=$$.days.charAt(b)%></td><td class="_ds"><table class="_W"><tbody id="hours_<%=$$.viewId%>_<%=b%>" mx-view="mx-hour/index?border=no" mx-change="__cx({day:<%=b%>})"></tbody></table></td><td class="_ds"><div class="_dw"><a mx-click="__cE({day:<%=b%>})" href="#">复制到</a></div></td></tr><%}%>',s:"4"}]},init:function(e){var t=this;t.__ay=r(e.days||[c,c,c,c,c,c,c]),d.__d(),t.__h=_("#"+t.id),t.on("destroy",function(){d.__f(t),d.__g()})},render:function(){this.updater.digest({viewId:this.id,days:"一二三四五六日"}),this.val(this.__ay)},__i:function(e){var t=this,a=i.inside(e,"dlg_"+t.id);if(!a&&t.__cA){var _=t.__cA.parent();a=i.inside(e,_[0])}return a},__cB:function(){var e=this.__ay.slice(0,5).join(""),t=this.__ay.slice(-2).join(""),a=e.indexOf("1")>-1,i=t.indexOf("1")>-1,_=-1==e.indexOf("0"),d=-1==t.indexOf("0"),s=_&&d;this.updater.digest({allDays:s,weekdays:!i&&_,weekends:d&&!a})},__cC:function(){for(var e=this,t=e.__ay,a=0,_=void 0,d=void 0;a<t.length;a++)_=t[a],(d=i.Vframe.get("hours_"+e.id+"_"+a))&&d.invoke("val",[_])},val:function(e){var t=this;return e&&(t.__ay=r(e),t.__cC(),t.__cB()),t.__ay},__e:function(){var e=this;if(!e.__j){e.__j=!0,d.__k(e);var t=e.__cA,a=_("#dlg_"+e.id);a.show();var i=t.offset(),s=i.left+t.outerWidth()-a.outerWidth(),n=i.top+t.outerHeight()+10;a.offset({left:s,top:n}),t.parent().addClass("_dB")}},__a:function(){var e=this;if(e.__j){e.__j=!1,d.__f(e),_("#dlg_"+e.id).hide();var t=e.__cA;t&&t.parent().removeClass("_dB")}},__u:function(){var e=this.__ay;this.__h.val(e).trigger({type:"change",days:e})},"__cD<change>":function(e){var t=this;switch(e.stopPropagation(),e.params.type){case 0:t.__ay=[n,n,n,n,n,n,n];break;case 1:t.__ay=[n,n,n,n,n,c,c];break;case 2:t.__ay=[c,c,c,c,c,n,n]}t.__cB(),t.__cC(),t.__u()},"__cx<change>":function(e){e.stopPropagation();var t=this;t.__ay[e.params.day]=e.range,clearTimeout(t.__cs),t.__cs=setTimeout(t.wrapAsync(function(){t.__cB()}),100),t.__u()},"__ax<click>":function(e){var t=e.params.day,a=this,_=i.Vframe.get("hours_"+a.id+"_"+t);if(_){_.invoke("val").indexOf("0")>-1?_.invoke("val",[a.__ay[t]=n]):_.invoke("val",[a.__ay[t]=c]),a.__cB(),a.__u()}},"__cE<click>":function(e){e.preventDefault();var t=_(e.eventTarget);this.__cA=t,this.__e(),this.updater.digest({currentClone:e.params.day})},"__cF<click>":function(){this.__a()},"__cG<click>":function(){var e=this,t=e.updater.get("currentClone"),a=e.__ay[t];_("#dlg_"+e.id+" input:checked").each(function(t,i){e.__ay[i.value]=a}),e.__a(),e.__cC(),e.__cB()}})});