define("mx-taginput/index",["magix","$","./suggest"],(t,i,e)=>{t("./suggest");var s=t("magix");s.applyStyle("_L","._fk{height:auto;min-height:32px;padding:1px 7px;position:relative;border:1px solid #e6e6e6;border-radius:4px;width:340px;line-height:1}._fk:hover{border-color:#ccc}._fl{cursor:not-allowed;background-color:#fbfbfb}._fl:hover{border-color:#e6e6e6}._fm{height:auto;cursor:text}._fn{position:absolute;left:9px;top:8px;color:#999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}._fo{position:relative;display:inline-block;margin:1px;cursor:pointer;background-color:#eee;border-radius:4px}._fp{width:1px;visibility:hidden}._fq{float:left;border-right:1px solid #fff;max-width:200px;overflow:hidden}._fr,._fq{height:24px;line-height:24px;padding:0 4px}._fr{width:20px;font-weight:bolder;text-align:center;color:#999;display:inline-block}._fs{border:none;outline:none;height:24px;line-height:24px;padding:0;width:20px;position:relative;z-index:1;background:transparent}._fl ._fm,._fl ._fr,._fl ._fq,._fl ._fs{cursor:not-allowed}");var _=t("$");e.exports=s.View.extend({tmpl:function(t,i){var e="",s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},_=/[&<>"'`]/g,o=function(t){return null==t?"":""+t},n=function(t){return"&"+s[t]+";"},a=function(t){return o(t).replace(_,n)},l=function(i,e,s){for(s=t[""];--s;)if(t[e=""+s]===i)return e;return t[e=""+t[""]++]=i,e},r={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},d=function(t){return r[t]},h=/[!')(*]/g,g=function(t){return encodeURIComponent(o(t)).replace(h,d)};if(e+='<div class="_fm _aj" mx-click="'+(i=i||"")+'__gn()" id="ipt_'+a(t.viewId)+'">',!t.items.length&&t.placeholder&&(e+='<div mxa="_~:_" class="_fn">'+a(t.placeholder)+"</div>"),t.items.length)for(var u=0;u<t.items.length;u++){var p=t.items[u];e+='<div mxa="_~:a" class="_fo" mx-contextmenu="'+i+'__G()"><div mxa="_~:b" class="_fq _al">'+a(t.textKey?p[t.textKey]:p)+'</div><div class="_fr" mx-click="'+i+"__gl({idx:"+o(u)+'})">x</div></div>'}else e+='<div mxa="_~:c" class="_fo _fp" mx-click="'+i+'stop()"><div class="_fr" mx-click="'+i+"__gl({idx:"+o(u)+'})">x</div></div>';return e+='<input mx-keydown="'+i+'__gm()" mx-keyup="'+i+'__gm()" mx-input="'+i+'__gm()" mx-paste="'+i+'__gm()" mx-pick="'+i+'__n()" mx-change="'+i+'__au()" mx-focusin="'+i+'__au()" mx-focusout="'+i+'__au()" mx-showlist="'+i+'__go()" mx-hidelist="'+i+'__go()" ',t.disabled&&(e+=' disabled="disabled" '),e+=' class="_fs" autocomplete="off"/>',t.disabled||(e+='<div mx-view="mx-taginput/suggest?list=',e+=l(t.list),e+="&textKey=",e+=l(t.textKey),e+="&valueKey=",e+=l(t.valueKey),e+="&relateIds=ipt_"+o(g(t.viewId))+"&offsetLeft=-11&width="+o(g(t.width))+"&scrollTop=",e+=l(t.scrollTop),e+='" class="_af _ah"></div>'),e+="</div>"},init:function(t){this.__eS=t.list||[],this.__k=_("#"+this.id),this.updater.set({disabled:t.disabled,placeholder:t.placeholder||"",textKey:t.textKey,valueKey:t.valueKey}),this.__gf(t.selected)},__gg:function(){for(var t=this.updater,i=t.get("sMap"),e=t.get("valueKey"),s=this.__eS,_=[],o=0,n=void 0;o<s.length;o++)n=s[o],i[e?n[e]:n]||_.push(n);return _},render:function(){var t=_("#"+this.id),i=t.outerWidth();0===i&&(i=340),this.updater.digest({width:i,list:this.__gg(),viewId:this.id}),t.addClass("_fk"),this.__h=t,this.__gh();this.updater.get().disabled&&t.addClass("_fl")},__gh:function(){var t=this.__h;this.__gi=t.find("input"),this.__gi.width(20);var i=_("#ipt_"+this.id).width()-this.__gi.position().left;this.__gi.width(i>=20?i:20)},__gf:function(t){t=((t=t||"")+"").split(",");for(var i=[],e={},_=this.updater.get("valueKey"),o=this.__eS,n=s.toMap(t),a=0,l=void 0,r=void 0;a<o.length;a++)l=o[a],r=_?l[_]:l,s.has(n,r)&&(e[r]=1,i.push(l));this.updater.set({sMap:e,items:i}),this.__k.val(t.join(","))},val:function(t){return t&&(this.__gf(t),this.updater.digest({list:this.__gg()}),this.__gh(),this.__h.removeClass("_ar"),this.__x()),this.updater.get("items")},__x:function(){for(var t=this.updater,i=[],e=t.get("items"),s=t.get("valueKey"),o=0,n=void 0;o<e.length;o++)n=e[o],i.push(s?n[s]:n);_("#"+this.id).val(i.join(",")).trigger({type:"change",ids:i,items:e})},__gk:function(){var t=this;clearTimeout(t.__gj),t.__eB=!0,t.__gi.focus(),t.__gj=setTimeout(t.wrapAsync(function(){delete t.__eB}),20)},"__gm<keydown,input,paste,keyup>":function(t){t.stopPropagation();var i=t.eventTarget.value;if(this.__cC!==i){this.__cC=i;var e=this.__h.find("._fn");i?e.hide():e.show()}if(!i&&"keydown"==t.type&&8==t.keyCode){var s=this.updater.get("items").length-1;s>-1&&(this["__gl<click>"]({params:{idx:s}}),this.__gk())}},"__n<pick>":function(t){t.stopPropagation();var i=this.updater,e=i.get("items"),s=i.get("sMap"),_=t.item,o=i.get("valueKey"),n=o?_[o]:_;s[n]||(s[n]=1,e.push(_),i.digest({items:e,scrollTop:t.scrollTop,list:this.__gg()}),this.__gh(),this.__gk(),this.__x())},"__gn<click>":function(){this.__k.hasClass("_fl")||this.__gi.focus()},"__gl<click>":function(t){if(!this.__k.hasClass("_fl")){var i=this.updater,e=i.get("items"),s=i.get("sMap"),_=i.get("valueKey"),o=e[t.params.idx];delete s[_?o[_]:o],e.splice(t.params.idx,1),i.digest({items:e,list:this.__gg()}),this.__gh(),this.__x(),this.__gk()}},"__G<contextmenu>":function(t){t.preventDefault()},"__au<change,focusin,focusout>":function(t){t.stopPropagation();var i=this.__h;"focusin"==t.type&&i.addClass("_ar")},"__go<showlist,hidelist>":function(t){if(!this.__eB&&(_("#"+this.id).trigger({type:"showlist"==t.type?"focusin":"focusout"}),"hidelist"==t.type)){this.__h.removeClass("_ar")}}})});