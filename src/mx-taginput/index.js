define("mx-taginput/index",["magix","$","./suggest"],(t,e,i)=>{t("./suggest");var s=t("magix");s.applyStyle("_L","._fk{height:auto;min-height:32px;padding:1px 7px;position:relative;border:1px solid #e6e6e6;border-radius:4px;width:340px;line-height:1}._fk:hover{border-color:#ccc}._fl{cursor:not-allowed;background-color:#fbfbfb}._fl:hover{border-color:#e6e6e6}._fm{height:auto;cursor:text}._fn{position:absolute;left:9px;top:8px;color:#999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}._fo{position:relative;display:inline-block;margin:1px;cursor:pointer;background-color:#eee;border-radius:4px}._fp{width:1px;visibility:hidden}._fq{float:left;border-right:1px solid #fff;max-width:200px;overflow:hidden}._fr,._fq{height:24px;line-height:24px;padding:0 4px}._fr{width:20px;font-weight:bolder;text-align:center;color:#999;display:inline-block}._fs{border:none;outline:none;height:24px;line-height:24px;padding:0;width:20px;position:relative;z-index:1;background:transparent}._fl ._fm,._fl ._fr,._fl ._fq,._fl ._fs{cursor:not-allowed}");var _=t("$");i.exports=s.View.extend({tmpl:function(t,e){var i="",s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},_=/[&<>"'`]/g,o=function(t){return null==t?"":""+t},n=function(t){return"&"+s[t]+";"},l=function(t){return o(t).replace(_,n)},a=function(i,s,_){for(_=e[t];--_;)if(e[s=t+_]===i)return s;return e[s=t+e[t]++]=i,s},r={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},d=function(t){return r[t]},h=/[!')(*]/g,f=function(t){return encodeURIComponent(o(t)).replace(h,d)};if(i+='<div class="_fm _aj" mx-click="__gm()" id="ipt_'+l(e.viewId)+'">',!e.items.length&&e.placeholder&&(i+='<div class="_fn">'+l(e.placeholder)+"</div>"),e.items.length)for(var g=0;g<e.items.length;g++){var p=e.items[g];i+='<div class="_fo" mx-contextmenu="prevent()"><div class="_fq _al">'+l(e.textKey?p[e.textKey]:p)+'</div><div class="_fr" mx-click="__gk({idx:'+o(g)+'})">x</div></div>'}else i+='<div class="_fo _fp" mx-click="stop()"><div class="_fr" mx-click="__gk({idx:'+o(g)+'})">x</div></div>';return i+='<input mx-keydown="__gl()" mx-keyup="__gl()" mx-input="__gl()" mx-paste="__gl()" mx-pick="__m()" mx-change="__at()" mx-focusin="__at()" mx-focusout="__at()" mx-showlist="__gn()" mx-hidelist="__gn()" ',e.disabled&&(i+=' disabled="disabled" '),i+=' class="_fs" autocomplete="off">',e.disabled||(i+='<div mx-view="mx-taginput/suggest?list=',i+=a(e.list),i+="&textKey=",i+=a(e.textKey),i+="&valueKey=",i+=a(e.valueKey),i+="&relateIds=ipt_"+o(f(e.viewId))+"&offsetLeft=-11&width="+o(f(e.width))+"&scrollTop=",i+=a(e.scrollTop),i+='" class="_af _ah"></div>'),i+="</div>"},init:function(t){this.__eR=t.list||[],this.__j=_("#"+this.id),this.updater.set({disabled:t.disabled,placeholder:t.placeholder||"",textKey:t.textKey,valueKey:t.valueKey}),this.__ge(t.selected)},__gf:function(){for(var t=this.updater,e=t.get("sMap"),i=t.get("valueKey"),s=this.__eR,_=[],o=0,n=void 0;o<s.length;o++)n=s[o],e[i?n[i]:n]||_.push(n);return _},render:function(){var t=_("#"+this.id),e=t.outerWidth();0===e&&(e=340),this.updater.digest({width:e,list:this.__gf(),viewId:this.id}),t.addClass("_fk"),this.__f=t,this.__gg();this.updater.get().disabled&&t.addClass("_fl")},__gg:function(){var t=this.__f;this.__gh=t.find("input"),this.__gh.width(20);var e=_("#ipt_"+this.id).width()-this.__gh.position().left;this.__gh.width(e>=20?e:20)},__ge:function(t){t=((t=t||"")+"").split(",");for(var e=[],i={},_=this.updater.get("valueKey"),o=this.__eR,n=s.toMap(t),l=0,a=void 0,r=void 0;l<o.length;l++)a=o[l],r=_?a[_]:a,s.has(n,r)&&(i[r]=1,e.push(a));this.updater.set({sMap:i,items:e}),this.__j.val(t.join(","))},val:function(t){return t&&(this.__ge(t),this.updater.digest({list:this.__gf()}),this.__gg(),this.__f.removeClass("_ar"),this.__w()),this.updater.get("items")},__w:function(){for(var t=this.updater,e=[],i=t.get("items"),s=t.get("valueKey"),o=0,n=void 0;o<i.length;o++)n=i[o],e.push(s?n[s]:n);_("#"+this.id).val(e.join(",")).trigger({type:"change",ids:e,items:i})},__gj:function(){var t=this;clearTimeout(t.__gi),t.__eA=!0,t.__gh.focus(),t.__gi=setTimeout(t.wrapAsync(function(){delete t.__eA}),20)},"__gl<keydown,input,paste,keyup>":function(t){t.stopPropagation();var e=t.eventTarget.value;if(this.__cB!==e){this.__cB=e;var i=this.__f.find("._fn");e?i.hide():i.show()}if(!e&&"keydown"==t.type&&8==t.keyCode){var s=this.updater.get("items").length-1;s>-1&&(this["__gk<click>"]({params:{idx:s}}),this.__gj())}},"__m<pick>":function(t){t.stopPropagation();var e=this.updater,i=e.get("items"),s=e.get("sMap"),_=t.item,o=e.get("valueKey"),n=o?_[o]:_;s[n]||(s[n]=1,i.push(_),e.digest({items:i,scrollTop:t.scrollTop,list:this.__gf()}),this.__gg(),this.__gj(),this.__w())},"__gm<click>":function(){this.__j.hasClass("_fl")||this.__gh.focus()},"__gk<click>":function(t){if(!this.__j.hasClass("_fl")){var e=this.updater,i=e.get("items"),s=e.get("sMap"),_=e.get("valueKey"),o=i[t.params.idx];delete s[_?o[_]:o],i.splice(t.params.idx,1),e.digest({items:i,list:this.__gf()}),this.__gg(),this.__w(),this.__gj()}},"__F<contextmenu>":function(t){t.preventDefault()},"__at<change,focusin,focusout>":function(t){t.stopPropagation();var e=this.__f;"focusin"==t.type&&e.addClass("_ar")},"__gn<showlist,hidelist>":function(t){if(!this.__eA&&(_("#"+this.id).trigger({type:"showlist"==t.type?"focusin":"focusout"}),"hidelist"==t.type)){this.__f.removeClass("_ar")}}})});