define("mx-calendar/range",["magix","$","./index","./datepicker"],(t,e,i)=>{t("./datepicker");var a=t("magix"),s=t("$"),d=t("./index"),n=d.parse,r=d.format;a.applyStyle("_i","._br{border:1px solid #e6e6e6;padding:10px 0;border-radius:4px;background-color:#fff;width:265px;position:relative;z-index:10}._bs{padding:0 10px}._bt{height:24px;line-height:24px;border-radius:4px;margin:0 10px 10px 0;width:70px;float:left;text-align:center;display:inline-block;cursor:pointer}._bt:hover{background:#e6e6e6}._bu,._bu:hover{color:#fff;background:#f96447}._bv{padding:0 10px;margin-bottom:15px}._bw{background-color:#f0f0f0;border:0;height:24px;width:117px;text-align:center;display:inline-block;color:#333;border-radius:4px;padding:6px 9px;cursor:text}._bx{border-top:1px solid #e6e6e6;margin-left:10px;padding-top:10px;width:92%}._by{width:330px}._by ._bw{width:150px}");var _=function(t,e){e||(e=new Date);var i=new Date(e.getTime()+864e5*t);return i=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate(),new Date(i)},o=function(t){return(t=new Date(t)).setHours(23),t.setMinutes(59),t.setSeconds(59),t},c=_(0),h=_(-1),p=function(t){var e=_(-7),i=t-e.getDay();return{start:_(i,e),end:o(_(i+6,e))}},l=p(0),u=p(1),g=function(){var t=new Date(c.getFullYear(),c.getMonth()-1,1),e=t.getFullYear(),i=t.getMonth(),a=32-new Date(e,i,32).getDate();return{start:t,end:o(new Date(e,i,a))}}();g.text="上月",l.text="上周（周日至周六）",u.text="上周（周一至周日）";for(var x={today:{text:"今天",start:c,end:o(c)},yesterday:{text:"昨天",start:h,end:o(h)},preMonth:g,preWeekSun:l,preWeekMon:u,passedThisMonth:{text:"本月",start:_(1-c.getDate()),end:o(h)},lastestThisMonth:{text:"本月",start:_(1-c.getDate()),end:o(c)}},v=[2,6,13,14,29,89],m=0,f=void 0,b=void 0;m<v.length;m++)x["passed"+(b=(f=v[m])+1)]={text:"过去"+b+"天",start:_(-b),end:o(h)},x["lastest"+b]={text:"最近"+b+"天",start:_(-f),end:o(c)};var k=["preMonth","preWeekMon","preWeekSun","passedThisMonth","lastestThisMonth"],y=a.View.extend({tmpl:{html:'<div class="_br<%if($$.showTime){%> _by<%}%> _aj" mx-contextmenu="__E()"><%if($$.quickDates.length){%><div class="_bs"><div class="_n">快捷日期</div><div class="_ai"><%for(var _=0;_<$$.quickDates.length;_++){var a=$$.quickDates[_],b=$$.quickDatesMap[a]%><span class="_bt _al<%if($$.dates.quickDateKey==a){%> _bu<%}%>" mx-click="__o({quick:true,key:\'<%=$eq(a)%>\'})" title="<%=b?b.text:a%>"><%=b?b.text:a%></span><%}%></div></div><%}%><div class="_bv"><div class="_n">日期范围</div><div class="_ai"><input class="_bw" readonly="readonly" data-hidden="<%=$$.dates.startStr%>" value="<%=$$.dates.startStr%>" mx-click="__Q({first:true})" id="start_<%=$$.id%>" mx-change="__P()"><div mx-view="mx-calendar/datepicker" class="_af _ah"></div>-<input readonly="readonly" class="_bw" data-hidden="<%=$$.dates.endStr%>" value="<%=$$.dates.endStr%>" mx-click="__Q()" id="end_<%=$$.id%>" mx-change="__P()"><div mx-view="mx-calendar/datepicker" class="_af _ah"></div></div></div><div class="_bx _ai"><button mx-click="__o()" type="button" class="_an _ao">确定</button><button mx-click="__R()" type="button" class="_an _s">取消</button></div></div>'},init:function(t){this.__F=t.min,this.__G=t.max,this.__H=t.dates,this.__I=t.quickDates||[],this.__J=t.placement,this.__K=t.align,this.__L=t.timeType,this.__M=t.dateType,this.__N=t.formatter},__j:function(t){var e=a.inside(t,this.id);if(!e)for(var i=this.owner.children(),s=i.length-1;s>=0;s--){var d=a.Vframe.get(i[s]);if(d&&(e=d.invoke("inside",[t])),e)break}return e},render:function(){this.updater.digest({id:this.id,showTime:this.__L,quickDatesMap:x,quickDates:this.__I,dates:this.__H}),this.__i=s("#"+this.id)},__O:function(){this.updater.digest({dates:this.__H})},"__P<change>":function(t){t.stopPropagation(),s(t.eventTarget).data("hidden",t.date+(t.time?" "+t.time:""));var e=s("#start_"+this.id).data("hidden"),i=s("#end_"+this.id).data("hidden"),a=this.updater.get("dates"),d=n(e,a.formatter);n(i,a.formatter).getTime()<d.getTime()&&(i=e,s("#end_"+this.id).data("hidden",i)),a=y.getDescription(e,i,this.__I,this.__N),this.updater.digest({dates:a})},"__Q<click>":function(t){var e=t.eventTarget,i=t.params,a={max:this.__G,min:this.__F,timeType:this.__L,dateType:this.__M,selected:e.value,placement:this.__J,align:this.__K};i.first||(a.min=(d=s("#start_"+this.id).data("hidden"),(d=new Date(d)).setHours(0),d.setMinutes(0),d.setSeconds(0),d));var d;e.vframe?e.vframe.invoke("update",[a]):this.owner.mountVframe(e.id,"mx-calendar/datepicker",a).invoke("__f")},"__o<click>":function(t){var e,i,a,d,n=t.params,_=this.updater,o=_.get("dates");if(n.quick){o.quickDateKey=n.key;var c=x[n.key];e=c.start,i=c.end,a=r(e,o.formatter),d=r(i,o.formatter),s("#start_"+this.id).data("hidden",a),s("#end_"+this.id).data("hidden",d),o.startStr=a,o.endStr=d,o.start=e,o.end=i,o.quickDateText=c.text,_.digest({dates:o})}else a=s("#start_"+this.id).data("hidden"),d=s("#end_"+this.id).data("hidden"),o=y.getDescription(a,d,this.__I,this.__N),_.digest({dates:o});this.__i.trigger({type:"change",dates:this.__H=o})},"__R<click>":function(){this.__i.trigger("cancel"),this.__O()},"__E<contextmenu>":function(t){t.preventDefault()}},{getSupportQuickDates:function(){return x},getDescription:function(t,e,i,s){var d,_={start:t=n(t),end:e=n(e),startStr:r(t,s),endStr:r(e,s),formatter:s},o=c.getTime(),p=h.getTime(),l=t.getTime(),u=e.getTime();if(l==u)o==u?d="today":p==u&&(d="yesterday");else{var g=(u-l)/864e5+1;p==u?x[d="passed"+g]||(d=0):o==u&&(x[d="lastest"+g]||(d=0))}if(!d)for(var v=k.length-1;v>-1;v--){var m=k[v],f=x[m];if(u==f.end.getTime()&&l==f.start.getTime()){d=m;break}}return d&&i&&(a.toMap(i)[d]||(d=0)),d&&(_.quickDateText=x[d].text,_.quickDateKey=d),_}});i.exports=y});