define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],(t,i,e)=>{var _=t("magix"),a=t("../mx-dragdrop/index"),h=t("../mx-runner/index"),n=t("$");_.applyStyle("_m","._cd{left:-1000px;top:0;background:#5665eb;position:absolute;opacity:.3;border:1px solid #4d4fa8}");var d=_.guid("area_"),o=n(window),r=n(document),s=function(){var t=n("#"+d);t.length||(t=n('<div id="'+d+'" class="_cd" />').appendTo("body"))},g=function(t,i,e,_){n("#"+d).css({left:t,top:i,width:e,height:_})},c=function(){n("#"+d).css({left:-1e5})},f=function(t,i){var e=t.width/2,_=t.height/2,a=i.width/2,h=i.height/2,n=t.x+e,d=t.y+_,o=i.x+a,r=i.y+h;return Math.abs(o-n)<=e+a&&Math.abs(r-d)<=_+h};e.exports=_.View.extend({init:function(t){var i=this,e=n("#"+i.id);e.on("mousedown",function(t){t.preventDefault(),i.__aR(t)}),e.on("click",function(t){if(!i.__aS){var _=i.__aT(t.target);_&&e.trigger({type:"change",action:"add",mode:"click",node:_})}delete i.__aS}),i.on("destroy",function(){e.off("mousedown click")}),i.__aU=t.selector,i.__h=e},__aT:function(t){for(var i=null,e=this.__h[0];e!=t;){if(t.parentNode==e){i=t;break}t=t.parentNode}return i&&this.__aU&&(n.find.matchesSelector(i,this.__aU)||(i=null)),i},__aV:function(){for(var t=[],i=0,e=0,_=this.__aU?this.__h.find(this.__aU):this.__h.children();e<_.length;e++){var a=_[e],h=n(a),d=h.offset();t.push({id:i++,c:a,x:d.left,y:d.top,width:h.width(),height:h.height()})}return t},__b_:function(t){var i={x:t.pageX,y:t.pageY},e=this.__aW;i.x<e.x?i.x=e.x:i.x>e.x+e.width&&(i.x=e.x+e.width),i.y<e.y?i.y=e.y:i.y>e.y+e.height&&(i.y=e.y+e.height);var _=this.__aX,a=Math.min(i.x,_.x),h=Math.min(i.y,_.y),n=Math.abs(i.x-_.x),d=Math.abs(i.y-_.y);g(a,h,n,d);for(var o=this.__aY,r={x:a,y:h,width:n,height:d},s=this.__aZ,c=0,l=o;c<l.length;c++){var b=l[c];f(r,b)?1!==s[b.id]&&(s[b.id]=1,this.__h.trigger({type:"change",action:"add",mode:"drag",node:b.c})):1===s[b.id]&&(delete s[b.id],this.__h.trigger({type:"change",action:"remove",mode:"drag",node:b.c}))}},__aR:function(t){if(1===t.which){var i=this;i.__aX={x:t.pageX,y:t.pageY};var e=i.__h,_=e.offset();i.__aW={x:_.left,y:_.top,width:e.width(),height:e.height()},i.__aZ={},s(),e.trigger("dragbegin"),a.begin(t.target,function(t){i.__ba(t)},function(t){i.__bb(t)})}},__ba:function(t){if(!this.__aS){var i=this.__aX;(Math.abs(t.pageX-i.x)>5||Math.abs(t.pageY-i.y)>5)&&(this.__aS=!0)}this.__aS&&(this.__aY||(this.__aY=this.__aV()),this.__bc=t,this.__bd(),this.__b_(t))},__bb:function(){this.__be(),c(),delete this.__bc,delete this.__aX,delete this.__aW,delete this.__aY,delete this.__aZ,this.__h.trigger("dragfinish")},__bd:function(){var t=this;t.__bf||(t.__bf=function(){var i=0,e=0,_=t.__bc,a=o.scrollTop(),h=o.height(),n=r.height(),d=r.width(),s=o.width(),g=o.scrollLeft();_.pageX-g<20&&g>0?i=-Math.min(7,g):g+s-_.pageX<20&&g+s<d&&(i=Math.min(7,d-s-g)),_.pageY-a<20&&a>0?e=-Math.min(7,a):a+h-_.pageY<20&&a+h<n&&(e=Math.min(7,n-h-a)),(i||e)&&(_.pageX+=i,_.pageY+=e,t.__b_(_),window.scrollBy(i,e))},h.__bg(30,t.__bf))},__be:function(){this.__bf&&(h.__bh(this.__bf),delete this.__bf)}})});