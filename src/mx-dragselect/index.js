define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],(t,i,e)=>{var _=t("magix"),h=t("../mx-dragdrop/index"),n=t("../mx-runner/index"),a=t("$");_.applyStyle("_o","._cs{left:-1000px;top:0;background:#5665eb;position:absolute;opacity:.3;border:1px solid #4d4fa8}");var r=_.guid("area_"),d=a(window),o=a(document),s=function(){var t=a("#"+r);t.length||(t=a('<div id="'+r+'" class="_cs" />').appendTo("body"))},b=function(t,i,e,_){a("#"+r).css({left:t,top:i,width:e,height:_})},g=function(){a("#"+r).css({left:-1e5})},c=function(t,i){var e=t.width/2,_=t.height/2,h=i.width/2,n=i.height/2,a=t.x+e,r=t.y+_,d=i.x+h,o=i.y+n;return Math.abs(d-a)<=e+h&&Math.abs(o-r)<=_+n};e.exports=_.View.extend({init:function(t){var i=this,e=a("#"+i.id);e.on("mousedown",function(t){t.preventDefault(),i.__bo(t)}),e.on("click",function(t){if(!i.__bp){var _=i.__bq(t.target);_&&e.trigger({type:"change",action:"add",mode:"click",node:_})}delete i.__bp}),i.on("destroy",function(){e.off("mousedown click"),h.end()}),i.__br=t.selector,i.__i=e},__bq:function(t){for(var i=null,e=this.__i[0];e!=t;){if(t.parentNode==e){i=t;break}t=t.parentNode}return i&&this.__br&&(a.find.matchesSelector(i,this.__br)||(i=null)),i},__bs:function(){for(var t=[],i=0,e=0,_=this.__br?this.__i.find(this.__br):this.__i.children();e<_.length;e++){var h=_[e],n=a(h),r=n.offset();t.push({id:i++,c:h,x:r.left,y:r.top,width:n.width(),height:n.height()})}return t},__bx:function(t){var i={x:t.pageX,y:t.pageY},e=this.__bt;i.x<e.x?i.x=e.x:i.x>e.x+e.width&&(i.x=e.x+e.width),i.y<e.y?i.y=e.y:i.y>e.y+e.height&&(i.y=e.y+e.height);var _=this.__bu,h=Math.min(i.x,_.x),n=Math.min(i.y,_.y),a=Math.abs(i.x-_.x),r=Math.abs(i.y-_.y);b(h,n,a,r);for(var d=this.__bv,o={x:h,y:n,width:a,height:r},s=this.__bw,g=0,f=d;g<f.length;g++){var p=f[g];c(o,p)?1!==s[p.id]&&(s[p.id]=1,this.__i.trigger({type:"change",action:"add",mode:"drag",node:p.c})):1===s[p.id]&&(delete s[p.id],this.__i.trigger({type:"change",action:"remove",mode:"drag",node:p.c}))}},__bo:function(t){if(1===t.which){var i=this;i.__bu={x:t.pageX,y:t.pageY};var e=i.__i,_=e.offset();i.__bt={x:_.left,y:_.top,width:e.width(),height:e.height()},i.__bw={},s(),e.trigger("dragbegin"),h.begin(t.target,function(t){i.__by(t)},function(t){i.__bz(t)})}},__by:function(t){if(!this.__bp){var i=this.__bu;(Math.abs(t.pageX-i.x)>5||Math.abs(t.pageY-i.y)>5)&&(this.__bp=!0)}this.__bp&&(this.__bv||(this.__bv=this.__bs()),this.__bA=t,this.__bB(),this.__bx(t))},__bz:function(){this.__bC(),g(),delete this.__bA,delete this.__bu,delete this.__bt,delete this.__bv,delete this.__bw,this.__i.trigger("dragfinish")},__bB:function(){var t=this;t.__bD||(t.__bD=function(){var i=0,e=0,_=t.__bA,h=d.scrollTop(),n=d.height(),a=o.height(),r=o.width(),s=d.width(),b=d.scrollLeft();_.pageX-b<20&&b>0?i=-Math.min(7,b):b+s-_.pageX<20&&b+s<r&&(i=Math.min(7,r-s-b)),_.pageY-h<20&&h>0?e=-Math.min(7,h):h+n-_.pageY<20&&h+n<a&&(e=Math.min(7,a-n-h)),(i||e)&&(_.pageX+=i,_.pageY+=e,t.__bx(_),window.scrollBy(i,e))},n.__ag(30,t.__bD))},__bC:function(){this.__bD&&(n.__ai(this.__bD),delete this.__bD)}})});