define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],(t,i,e)=>{var _=t("magix"),h=t("../mx-dragdrop/index"),n=t("../mx-runner/index"),a=t("$");_.applyStyle("_n","._cm{left:-1000px;top:0;background:#5665eb;position:absolute;opacity:.3;border:1px solid #4d4fa8}");var r=_.guid("area_"),d=a(window),o=a(document),s=function(){var t=a("#"+r);t.length||(t=a('<div id="'+r+'" class="_cm" />').appendTo("body"))},b=function(t,i,e,_){a("#"+r).css({left:t,top:i,width:e,height:_})},g=function(){a("#"+r).css({left:-1e5})},c=function(t,i){var e=t.width/2,_=t.height/2,h=i.width/2,n=i.height/2,a=t.x+e,r=t.y+_,d=i.x+h,o=i.y+n;return Math.abs(d-a)<=e+h&&Math.abs(o-r)<=_+n};e.exports=_.View.extend({mixins:[h],init:function(t){var i=this,e=a("#"+i.id);e.on("mousedown",function(t){t.preventDefault(),i.__bq(t)}),e.on("click",function(t){if(!i.__br){var _=i.__bs(t.target);_&&e.trigger({type:"change",action:"add",mode:"click",node:_})}delete i.__br}),i.on("destroy",function(){e.off("mousedown click")}),i.__bt=t.selector,i.__k=e},__bs:function(t){for(var i=null,e=this.__k[0];e!=t;){if(t.parentNode==e){i=t;break}t=t.parentNode}return i&&this.__bt&&(a.find.matchesSelector(i,this.__bt)||(i=null)),i},__bu:function(){for(var t=[],i=0,e=0,_=this.__bt?this.__k.find(this.__bt):this.__k.children();e<_.length;e++){var h=_[e],n=a(h),r=n.offset();t.push({id:i++,c:h,x:r.left,y:r.top,width:n.width(),height:n.height()})}return t},__bz:function(t){var i={x:t.pageX,y:t.pageY},e=this.__bv;i.x<e.x?i.x=e.x:i.x>e.x+e.width&&(i.x=e.x+e.width),i.y<e.y?i.y=e.y:i.y>e.y+e.height&&(i.y=e.y+e.height);var _=this.__bw,h=Math.min(i.x,_.x),n=Math.min(i.y,_.y),a=Math.abs(i.x-_.x),r=Math.abs(i.y-_.y);b(h,n,a,r);for(var d=this.__bx,o={x:h,y:n,width:a,height:r},s=this.__by,g=0,f=d;g<f.length;g++){var x=f[g];c(o,x)?1!==s[x.id]&&(s[x.id]=1,this.__k.trigger({type:"change",action:"add",mode:"drag",node:x.c})):1===s[x.id]&&(delete s[x.id],this.__k.trigger({type:"change",action:"remove",mode:"drag",node:x.c}))}},__bq:function(t){if(1===t.which){var i=this;i.__bw={x:t.pageX,y:t.pageY};var e=i.__k,_=e.offset();i.__bv={x:_.left,y:_.top,width:e.width(),height:e.height()},i.__by={},s(),e.trigger("dragbegin"),i.dragdrop(t.target,function(t){i.__bA(t)},function(t){i.__bB(t)})}},__bA:function(t){if(!this.__br){var i=this.__bw;(Math.abs(t.pageX-i.x)>5||Math.abs(t.pageY-i.y)>5)&&(this.__br=!0)}this.__br&&(this.__bx||(this.__bx=this.__bu()),this.__bC=t,this.__bD(),this.__bz(t))},__bB:function(){this.__bE(),g(),delete this.__bC,delete this.__bw,delete this.__bv,delete this.__bx,delete this.__by,this.__k.trigger("dragfinish")},__bD:function(){var t=this;t.__bF||(t.__bF=function(){var i=0,e=0,_=t.__bC,h=d.scrollTop(),n=d.height(),a=o.height(),r=o.width(),s=d.width(),b=d.scrollLeft();_.pageX-b<20&&b>0?i=-Math.min(7,b):b+s-_.pageX<20&&b+s<r&&(i=Math.min(7,r-s-b)),_.pageY-h<20&&h>0?e=-Math.min(7,h):h+n-_.pageY<20&&h+n<a&&(e=Math.min(7,a-n-h)),(i||e)&&(_.pageX+=i,_.pageY+=e,t.__bz(_),window.scrollBy(i,e))},n.__ai(30,t.__bF))},__bE:function(){this.__bF&&(n.__ak(this.__bF),delete this.__bF)}})});