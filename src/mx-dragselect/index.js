define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],(t,i,e)=>{var _=t("magix"),h=t("../mx-dragdrop/index"),n=t("../mx-runner/index"),a=t("$");_.applyStyle("_n","._cm{left:-1000px;top:0;background:#5665eb;position:absolute;opacity:.3;border:1px solid #4d4fa8}");var d=_.guid("area_"),r=a(window),o=a(document),s=function(){var t=a("#"+d);t.length||(t=a('<div id="'+d+'" class="_cm" />').appendTo("body"))},b=function(t,i,e,_){a("#"+d).css({left:t,top:i,width:e,height:_})},g=function(){a("#"+d).css({left:-1e5})},c=function(t,i){var e=t.width/2,_=t.height/2,h=i.width/2,n=i.height/2,a=t.x+e,d=t.y+_,r=i.x+h,o=i.y+n;return Math.abs(r-a)<=e+h&&Math.abs(o-d)<=_+n};e.exports=_.View.extend({mixins:[h],init:function(t){var i=this,e=a("#"+i.id);e.on("mousedown",function(t){t.preventDefault(),i.__bp(t)}),e.on("click",function(t){if(!i.__bq){var _=i.__br(t.target);_&&e.trigger({type:"change",action:"add",mode:"click",node:_})}delete i.__bq}),i.on("destroy",function(){e.off("mousedown click")}),i.__bs=t.selector,i.__j=e},__br:function(t){for(var i=null,e=this.__j[0];e!=t;){if(t.parentNode==e){i=t;break}t=t.parentNode}return i&&this.__bs&&(a.find.matchesSelector(i,this.__bs)||(i=null)),i},__bt:function(){for(var t=[],i=0,e=0,_=this.__bs?this.__j.find(this.__bs):this.__j.children();e<_.length;e++){var h=_[e],n=a(h),d=n.offset();t.push({id:i++,c:h,x:d.left,y:d.top,width:n.width(),height:n.height()})}return t},__by:function(t){var i={x:t.pageX,y:t.pageY},e=this.__bu;i.x<e.x?i.x=e.x:i.x>e.x+e.width&&(i.x=e.x+e.width),i.y<e.y?i.y=e.y:i.y>e.y+e.height&&(i.y=e.y+e.height);var _=this.__bv,h=Math.min(i.x,_.x),n=Math.min(i.y,_.y),a=Math.abs(i.x-_.x),d=Math.abs(i.y-_.y);b(h,n,a,d);for(var r=this.__bw,o={x:h,y:n,width:a,height:d},s=this.__bx,g=0,f=r;g<f.length;g++){var x=f[g];c(o,x)?1!==s[x.id]&&(s[x.id]=1,this.__j.trigger({type:"change",action:"add",mode:"drag",node:x.c})):1===s[x.id]&&(delete s[x.id],this.__j.trigger({type:"change",action:"remove",mode:"drag",node:x.c}))}},__bp:function(t){if(1===t.which){var i=this;i.__bv={x:t.pageX,y:t.pageY};var e=i.__j,_=e.offset();i.__bu={x:_.left,y:_.top,width:e.width(),height:e.height()},i.__bx={},s(),e.trigger("dragbegin"),i.dragdrop(t.target,function(t){i.__bz(t)},function(t){i.__bA(t)})}},__bz:function(t){if(!this.__bq){var i=this.__bv;(Math.abs(t.pageX-i.x)>5||Math.abs(t.pageY-i.y)>5)&&(this.__bq=!0)}this.__bq&&(this.__bw||(this.__bw=this.__bt()),this.__bB=t,this.__bC(),this.__by(t))},__bA:function(){this.__bD(),g(),delete this.__bB,delete this.__bv,delete this.__bu,delete this.__bw,delete this.__bx,this.__j.trigger("dragfinish")},__bC:function(){var t=this;t.__bE||(t.__bE=function(){var i=0,e=0,_=t.__bB,h=r.scrollTop(),n=r.height(),a=o.height(),d=o.width(),s=r.width(),b=r.scrollLeft();_.pageX-b<20&&b>0?i=-Math.min(7,b):b+s-_.pageX<20&&b+s<d&&(i=Math.min(7,d-s-b)),_.pageY-h<20&&h>0?e=-Math.min(7,h):h+n-_.pageY<20&&h+n<a&&(e=Math.min(7,a-n-h)),(i||e)&&(_.pageX+=i,_.pageY+=e,t.__by(_),window.scrollBy(i,e))},n.__ah(30,t.__bE))},__bD:function(){this.__bE&&(n.__aj(this.__bE),delete this.__bE)}})});