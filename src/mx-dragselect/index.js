define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],(t,i,e)=>{var _=t("magix"),h=t("../mx-dragdrop/index"),n=t("../mx-runner/index"),a=t("$");_.applyStyle("_n","._cm{left:-1000px;top:0;background:#5665eb;position:absolute;opacity:.3;border:1px solid #4d4fa8}");var o=_.guid("area_"),d=a(window),r=a(document),s=function(){var t=a("#"+o);t.length||(t=a('<div id="'+o+'" class="_cm" />').appendTo("body"))},b=function(t,i,e,_){a("#"+o).css({left:t,top:i,width:e,height:_})},g=function(){a("#"+o).css({left:-1e5})},c=function(t,i){var e=t.width/2,_=t.height/2,h=i.width/2,n=i.height/2,a=t.x+e,o=t.y+_,d=i.x+h,r=i.y+n;return Math.abs(d-a)<=e+h&&Math.abs(r-o)<=_+n};e.exports=_.View.extend({init:function(t){var i=this,e=a("#"+i.id);e.on("mousedown",function(t){t.preventDefault(),i.__bi(t)}),e.on("click",function(t){if(!i.__bj){var _=i.__bk(t.target);_&&e.trigger({type:"change",action:"add",mode:"click",node:_})}delete i.__bj}),i.on("destroy",function(){e.off("mousedown click")}),i.__bl=t.selector,i.__h=e},__bk:function(t){for(var i=null,e=this.__h[0];e!=t;){if(t.parentNode==e){i=t;break}t=t.parentNode}return i&&this.__bl&&(a.find.matchesSelector(i,this.__bl)||(i=null)),i},__bm:function(){for(var t=[],i=0,e=0,_=this.__bl?this.__h.find(this.__bl):this.__h.children();e<_.length;e++){var h=_[e],n=a(h),o=n.offset();t.push({id:i++,c:h,x:o.left,y:o.top,width:n.width(),height:n.height()})}return t},__br:function(t){var i={x:t.pageX,y:t.pageY},e=this.__bn;i.x<e.x?i.x=e.x:i.x>e.x+e.width&&(i.x=e.x+e.width),i.y<e.y?i.y=e.y:i.y>e.y+e.height&&(i.y=e.y+e.height);var _=this.__bo,h=Math.min(i.x,_.x),n=Math.min(i.y,_.y),a=Math.abs(i.x-_.x),o=Math.abs(i.y-_.y);b(h,n,a,o);for(var d=this.__bp,r={x:h,y:n,width:a,height:o},s=this.__bq,g=0,f=d;g<f.length;g++){var l=f[g];c(r,l)?1!==s[l.id]&&(s[l.id]=1,this.__h.trigger({type:"change",action:"add",mode:"drag",node:l.c})):1===s[l.id]&&(delete s[l.id],this.__h.trigger({type:"change",action:"remove",mode:"drag",node:l.c}))}},__bi:function(t){if(1===t.which){var i=this;i.__bo={x:t.pageX,y:t.pageY};var e=i.__h,_=e.offset();i.__bn={x:_.left,y:_.top,width:e.width(),height:e.height()},i.__bq={},s(),e.trigger("dragbegin"),h.begin(t.target,function(t){i.__bs(t)},function(t){i.__bt(t)})}},__bs:function(t){if(!this.__bj){var i=this.__bo;(Math.abs(t.pageX-i.x)>5||Math.abs(t.pageY-i.y)>5)&&(this.__bj=!0)}this.__bj&&(this.__bp||(this.__bp=this.__bm()),this.__bu=t,this.__bv(),this.__br(t))},__bt:function(){this.__bw(),g(),delete this.__bu,delete this.__bo,delete this.__bn,delete this.__bp,delete this.__bq,this.__h.trigger("dragfinish")},__bv:function(){var t=this;t.__bx||(t.__bx=function(){var i=0,e=0,_=t.__bu,h=d.scrollTop(),n=d.height(),a=r.height(),o=r.width(),s=d.width(),b=d.scrollLeft();_.pageX-b<20&&b>0?i=-Math.min(7,b):b+s-_.pageX<20&&b+s<o&&(i=Math.min(7,o-s-b)),_.pageY-h<20&&h>0?e=-Math.min(7,h):h+n-_.pageY<20&&h+n<a&&(e=Math.min(7,a-n-h)),(i||e)&&(_.pageX+=i,_.pageY+=e,t.__br(_),window.scrollBy(i,e))},n.__ad(30,t.__bx))},__bw:function(){this.__bx&&(n.__af(this.__bx),delete this.__bx)}})});