define("mx-tree/index",["magix","mx-tree/util","../mx-medusa/util","./branch"],(e,n,t)=>{e("./branch");var r=e("magix"),i=r.Vframe,a=e("mx-tree/util"),l=e("../mx-medusa/util");r.applyStyle("_zs_gallery_mx-tree_index_",":root {\n  --mx-tree-oper-size: calc(var(--font-size) + 2px);\n}\n._zs_gallery_mx-tree_index_-name {\n  position: relative;\n  height: 32px;\n  line-height: 20px;\n  padding-bottom: 12px;\n  background-color: #fff;\n  overflow: hidden;\n  transition: height 0.2s;\n}\n._zs_gallery_mx-tree_index_-name ._zs_gallery_mx-tree_index_-icon {\n  float: left;\n  width: var(--mx-tree-oper-size);\n  height: var(--mx-tree-oper-size);\n  margin-right: 5px;\n  line-height: var(--mx-tree-oper-size);\n  font-size: var(--mx-tree-oper-size);\n  color: #ccc;\n  transition: color var(--duration);\n  -moz-user-select: none;\n   -ms-user-select: none;\n       user-select: none;\n  -webkit-user-select: none;\n}\n._zs_gallery_mx-tree_index_-name ._zs_gallery_mx-tree_index_-oper {\n  cursor: pointer;\n}\n._zs_gallery_mx-tree_index_-name ._zs_gallery_mx-tree_index_-oper:hover {\n  color: #666;\n}\n._zs_gallery_mx-tree_index_-close ._zs_gallery_mx-tree_index_-name {\n  height: 0;\n  padding-bottom: 0;\n}\n._zs_gallery_mx-tree_index_-li {\n  position: relative;\n}\n._zs_gallery_mx-tree_index_-indent {\n  padding-left: calc(var(--mx-tree-oper-size) + 5px);\n}\n._zs_gallery_mx-tree_index_-line {\n  position: relative;\n}\n._zs_gallery_mx-tree_index_-line ._zs_gallery_mx-tree_index_-li {\n  position: relative;\n}\n._zs_gallery_mx-tree_index_-line ._zs_gallery_mx-tree_index_-li:after {\n  content: '';\n  position: absolute;\n  top: 22px;\n  left: calc(var(--mx-tree-oper-size) / 2);\n  bottom: 2px;\n  width: 1px;\n  background-color: var(--color-border);\n}\n._zs_gallery_mx-tree_index_-line ._zs_gallery_mx-tree_index_-li:last-child:after {\n  content: none;\n}\n"),t.exports=r.View.extend({tmpl:function(e,n,t,r,i,a,l,o){if(t||(t=e),!i){var s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},_=/[&<>"'`]/g,d=function(e){return"&"+s[e]+";"};i=function(e){return""+(null==e?"":e)},r=function(e){return i(e).replace(_,d)}}if(!a){var c={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},u=function(e){return c[e]},x=/[!')(*]/g;a=function(e){return encodeURIComponent(i(e)).replace(x,u)}}if(!o){var m=/[\\'"]/g;o=function(e){return i(e).replace(m,"\\$&")}}l||(l=function(e,n,t,r){for(r=e[g];--r;)if(e[t=g+r]===n)return t;return e[t=g+e[g]++]=n,t});var p,h,v,g="",f="",y=e.hasLine,z=e.viewId,b=e.readOnly,w=e.needExpand,K=e.textKey,V=e.valueKey,E=e.closeMap,O=e.list;try{f+='<div mxv="readOnly,needExpand,closeMap,list" class="',v=1,h="if hasLine",p="<%if (hasLine) {%>",y&&(f+=" _zs_gallery_mx-tree_index_-line ",v=1,h="/if",p="<%}%>"),f+='" id="tree_',v=2,h="=viewId",f+=(p="<%=viewId%>",r(z)+'" mx-change="'+n+'@{change}()" mx-view="mx-tree/branch?readOnly='),v=3,h="@readOnly",f+=(p="<%@readOnly%>",l(t,b)+"&needExpand="),v=4,h="@needExpand",f+=(p="<%@needExpand%>",l(t,w)+"&textKey="),v=5,h="=textKey",f+=(p="<%!$eu(textKey)%>",a(K)+"&valueKey="),v=6,h="=valueKey",f+=(p="<%!$eu(valueKey)%>",a(V)+"&closeMap="),v=7,h="@closeMap",f+=(p="<%@closeMap%>",l(t,E)+"&list="),v=9,h="@list",f+=(p="<%@list%>",l(t,O)+'"></div>')}catch(e){var I="render view error:"+(e.message||e);throw h&&(I+="\r\n\tsrc art:{{"+h+"}}\r\n\tat line:"+v),I+="\r\n\t"+(h?"translate to:":"expr:"),I+=p+"\r\n\tat file:mx-tree/index.html"}return f},init:function(e){var n=this;n["@{close.map}"]={},n["@{bottom.values}"]=[],n["@{owner.node}"]=$("#"+n.id),n.updater.snapshot(),n.assign(e)},assign:function(e){var n,t=this,i=t.updater.altered(),o=e.readOnly+""=="true",s=e.hasLine+""=="true",_=e.valueKey||"value",d=e.textKey||"text",c=e.parentKey||"pValue",u=e.needAll+""=="true",x=e.needExpand+""=="true",m=a.listToTree(e.list,_,c);if(u){var p={};p[_]=t.id+"_all",p[d]=l["select.all"],p.isAll=!0,p.children=m.list,n=[p]}else n=m.list;var h=e.close+""=="true",v={},g=function(e){e.forEach(function(e){v[e[_]]=h,e.children&&e.children.length>0&&g(e.children)})};g(n),t["@{close.map}"]=r.mix(v,t["@{close.map}"]);var f=function(e){e.forEach(function(e){e.close=t["@{close.map}"][e[_]],e.children&&e.children.length>0&&f(e.children)})};return f(n),t["@{bottom.values}"]=t["@{bottom.values}"].map(function(e){return e+""}),(e.bottomValues||[]).forEach(function(e){e+="",t["@{bottom.values}"].indexOf(e)<0&&t["@{bottom.values}"].push(e)}),t.updater.set({viewId:t.id,valueKey:_,textKey:d,list:n,readOnly:o,hasLine:s,needExpand:x,closeMap:t["@{close.map}"],bottomValues:t["@{bottom.values}"]}),t["@{owner.node}"].val(t["@{bottom.values}"]),i||(i=t.updater.altered()),!!i&&(t.updater.snapshot(),!0)},render:function(){this.updater.digest();var e=this.updater.get("bottomValues");e.length>0&&this.setBottomValues(e)},"@{change}<change>":function(e){e.stopPropagation();var n=this.getBottomValues();this["@{owner.node}"].val(this["@{bottom.values}"]=n).trigger($.Event("change",{bottomValues:n}))},setBottomValues:function(e){this.loop(function(n){n.invoke("setValues",[e])})},getBottomValues:function(){var e=[];return this.loop(function(n){var t=n.invoke("getValues");e=e.concat(t)}),e},getBottomItems:function(){var e=[];return this.loop(function(n){var t=n.invoke("getItems");e=e.concat(t)}),e},loop:function(e){var n=this.owner.children(),t=function(n){for(var r=0,a=n;r<a.length;r++){var l=a[r],o=i.get(l);e(o);var s=o.children();s&&s.length>0&&t(s)}};t(n)}})});