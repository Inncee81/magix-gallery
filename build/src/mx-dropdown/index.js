define("mx-dropdown/index",["magix","$","../mx-util/monitor","../mx-medusa/util"],(e,t,a)=>{var i=e("magix"),_=e("$"),r=e("../mx-util/monitor"),c=e("../mx-medusa/util");a.exports=i.View.extend({tmpl:function(e,t,a,i,_,r,c,s){if(a||(a=e),!_){var n={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},o=/[&<>"'`]/g,l=function(e){return"&"+n[e]+";"};_=function(e){return""+(null==e?"":e)},i=function(e){return _(e).replace(o,l)}}if(!r){var u={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},p=function(e){return u[e]},d=/[!')(*]/g;r=function(e){return encodeURIComponent(_(e)).replace(d,p)}}if(!s){var m=/[\\'"]/g;s=function(e){return _(e).replace(m,"\\$&")}}c||(c=function(e,t,a,i){for(i=e[v];--i;)if(e[a=v+i]===t)return a;return e[a=v+e[v]++]=t,a});var v="",x="",f=e.viewId,g=e.expand,h=e.small,b=e.name,y=e.selectedText,k=e.placementClass,T=e.rList,w=e.searchbox,z=e.text,L=e.keyword,Y=e.list,K=e.height,M=e.textKey,O=e.valueKey,A=e.selected,C=e.spm;if(x+='<div id="toggle_'+i(f)+'" class="mx-trigger ',g&&(x+=" mx-trigger-open "),x+=" ",h&&(x+=" mx-trigger-small "),x+='"><span mxa="_zs_gallerya.:_" class="mx-trigger-label">',b&&(x+='<span mxa="_zs_gallerya.:a" class="color-9">'+i(b)+"ï¼š</span>"),x+=" "+i(y)+'</span><span mxs="_zs_gallerya.:_" class="mc-iconfont mx-trigger-arrow">&#xe692;</span></div><div mxv id="menu_'+i(f)+'" class="mx-output '+i(k)+" ",g&&(x+=" mx-output-open "),x+='">',T){if(x+=" ",w&&(x+='<div mxv mxa="_zs_gallerya.:b" class="mx-output-search"><div mxv mxa="_zs_gallerya.:c" class="search-box" style="width: 100%;"><i mxs="_zs_gallerya.:a" class="mc-iconfont search-icon">&#xe651;</i><input class="input search-input" placeholder="'+i(z.search)+'" mx-keyup="'+t+'__g()" mx-paste="'+t+'__g()" mx-change="'+t+'__m()" mx-focusin="'+t+'__m()" mx-focusout="'+t+'__m()" value="'+i(L)+'"/></div></div>'),x+=" ",Y.length){x+='<ul class="mx-output-list" id="list_'+i(f)+'" style="max-height:'+i(K)+'px;">';z=void 0;var Z=void 0;x+=" ";for(var I=0,N=Y;I<N.length;I++){var P=N[I];if(x+=" ",z=P[M],Z=P[O],x+=" ",P&&P.group)x+='<li class="mx-output-header" title="'+i(P[M])+'">'+i(P[M])+"</li>";else{x+='<li class="mx-output-item" title="'+i(P.tip?P.tip:z)+'">';var $=Z+""==A+"";x+='<span class="mx-output-link ',$&&(x+=" mx-output-link-active "),x+='" data-active="'+i($)+'" mx-click="'+t+"__ac({item:'"+c(a,P)+"'})\" ",C&&(x+=' data-spm-click="'+i(C)+'" '),x+=">"+i(z)+"</span></li>"}x+=" "}x+="</ul>"}else x+='<div mxa="_zs_gallerya.:d" class="text-center color-9 pt20 pb20">'+i(z.empty)+"</div>";x+=" "}return x+="</div>"},init:function(e){var t=this;r.__h(),t.on("destroy",function(){r.__i(t),r.__j()}),t.___=_("#"+t.id),t.__k=e.disabled+""=="true"||_("#"+t.id)[0].hasAttribute("mx-disabled"),t.__bY=!1;var a="mx-output-"+(e.placement||"bottom");t.__bN=e.triggerType||"click";var s=t.__bZ=e.selected,n=t.__c_=e.textKey||"text",o=t.__ca=e.valueKey||"value",l=t.__cb=e.emptyText||"",u=[];if(e.list){try{u=JSON.parse(e.list)}catch(t){u=e.list}"object"==typeof u[0]||(u=u.map(function(e){var t={};return t[n]=e,t[o]=e,t}))}else{var p;t.___.children().each(function(e,t){t=_(t),p="true"==t.attr("group"),u.push({group:p,text:t.text(),value:p?i.guid():t.attr("value")})}),n=t.__c_="text",o=t.__ca="value"}t.__cc=u;var d=i.toMap(u,o);if(l&&!d[""]){var m={};m[n]=l,m[o]="",u.unshift(m),d[""]=m}if(!s||!d[s]){for(var v={},x=0;x<u.length;x++)if(!u[x].group){v=u[x];break}s=d[s]||v,n&&o&&(s=s[o])}t.updater.set({viewId:t.id,textKey:t.__c_,valueKey:t.__ca,selected:t.__bZ=s,searchbox:e.searchbox+""=="true",selectedText:t.__cd=d[s][n],keyword:t.__ce=e.keyword||"",expand:t.__bY,small:e.small+""=="true",height:e.height||250,spm:t.___.attr("data-spm-click")||"",name:e.name||"",placementClass:a,text:{search:c["dropdown.search"],empty:c["empty.text"]}}),t.___.val(s)},render:function(){var e,t=this,a=t.updater.get("searchbox"),i=function(){t.updater.digest({list:e});var a=t.__bN,i=_("#toggle_"+t.id);switch(a){case"click":i.on("click",function(){t.__bY?t.__n():t.__k||t.__o()});break;case"hover":i.hover(function(){clearTimeout(t.__bM),t.__k||t.__o()},function(){t.__bO()}),_("#menu_"+t.id).hover(function(){clearTimeout(t.__bM)},function(){t.__bO()})}};a?t.__bT(t.__ce,function(t){e=t,i()}):(e=t.__cc,i())},__l:function(e){return i.inside(e,this.id)},__bO:function(){var e=this;clearTimeout(e.__bM),e.__bM=setTimeout(e.wrapAsync(function(){e.__n()}),250)},__n:function(){var e=this;e.__bY&&(e.updater.digest({expand:e.__bY=!1}),e.___.trigger("focusout"),r.__i(e))},__o:function(){var e=this;if(!e.__bY){var t={expand:e.__bY=!0};e.updater.get("rList")||(t.rList=!0),e.updater.digest(t),e.___.trigger("focusin");var a=_("#list_"+e.id),i=a.find('[data-active="true"]').position(),c=a.height(),s=a.prop("scrollTop");if(i&&(i.top<0||i.top>c)){var n=i.top-c+s+c/2;a.prop("scrollTop",n)}r.__q(e)}},__bT:function(e,t){var a=this;clearTimeout(a.__cf);var i=a.__cc,_=[],r=0,c=i.length,s=a.__c_,n=a.__ca;if(e){var o=function(){if(r<c){for(var l=Math.min(r+400,c),u=r,p=void 0,d=void 0,m=void 0;u<l;u++){d=p=i[u],m=p,s&&n&&(d=p[s],m=p[n]);var v=(e+"").toLocaleLowerCase();((d+"").toLocaleLowerCase().indexOf(v)>=0||(m+"").indexOf(e)>=0)&&_.push(p)}r=l,a.__cf=setTimeout(a.wrapAsync(o),20)}else t(_)};o()}else t(i)},"__g<keyup,paste>":function(e){var t=this;e.stopPropagation(),clearTimeout(t.__bX);var a=_.trim(e.eventTarget.value);t.updater.set({keyword:a}),t.__bX=setTimeout(t.wrapAsync(function(){a!=t.__ce&&t.__bT(t.__ce=a,function(e){t.updater.digest({list:e})})}),300)},"__ac<click>":function(e){var t=this,a=e.params.item,i=t.updater,r=t.__ca,c=t.__c_,s=t.__bZ,n=t.__ce,o=a[r],l=a[c];if(s!==o){i.set({selected:t.__bZ=o});var u=_.Event("change",{item:a,keyword:n,keys:{text:c,value:r},value:a[r],text:a[c],selected:a[r]});u.isDefaultPrevented()?i.set({selected:s}):i.digest({selected:o,selectedText:l}),t.___.val(r?a[r]:a).trigger(u)}t.__n()},"__m<change,focusin,focusout>":function(e){e.stopPropagation()}})});