define("mx-uploader/index",["magix","$","../mx-util/runner"],(e,t,r)=>{var n=e("magix"),i=e("$"),a=e("../mx-util/runner");n.applyStyle("_zs_galleryaI",'[mx-view*="mx-uploader/index"]{position:relative;overflow:hidden}._zs_gallerykF{left:0;top:0;bottom:0;right:0;width:100%;height:100%;opacity:0;cursor:pointer;font-size:100px;filter:alpha(opacity=0)}._zs_gallerykG,._zs_gallerykF{position:absolute}._zs_gallerykG{left:-999999px}');var o=function(e,t,r,n,i,a,o,l){if(r||(r=e),!i){var d={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},p=/[&<>"'`]/g,s=function(e){return"&"+d[e]+";"};i=function(e){return""+(null==e?"":e)},n=function(e){return i(e).replace(p,s)}}if(!a){var u={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},f=function(e){return u[e]},c=/[!')(*]/g;a=function(e){return encodeURIComponent(i(e)).replace(c,f)}}if(!l){var m=/[\\'"]/g;l=function(e){return i(e).replace(m,"\\$&")}}var _="",g=e.nodeId,v=e.disabled,h=e.name;return _+='<input id="'+n(g)+'" class="_zs_gallerykF" ',v&&(_+=' disabled="true" '),_+=' type="file" name="'+n(h)+'" mx-change="'+t+'__fo()"/>'},l=n.Base.extend({destroy:function(){this.__fl=1}}),d=l.extend({__fm:function(e,t,r,o){var l=e.form,d=this,p=n.guid("up");l||(i("body").append('<div id="'+p+'_temp" class="_zs_gallerykG"><form target="'+p+'"></form></div>'),(l=i("#"+p+"_temp").find("form")).append(e),l=l[0]);var s=0,u=2e3;if(e.files){u=0;for(var f=0;f<e.files.length;f++)u+=e.files[f].size;(u/=1e3)<2e3&&(u=2e3)}var c=1e3/u,m=function(){d.__fl?a.__bH(m):s<1&&(o(s),s+=c+20*Math.random()*c)};a.__bF(100,m),i('<iframe name="'+p+'" id="'+p+'" style="display:none;"></iframe>').insertAfter(l).on("load",function(e){if(a.__bH(m),!d.__fl){o(1);var t=e.target,n=i(t.contentWindow.document.body);n.find("script").remove();var l=i.trim(n.text());i(t).remove(),i("#"+p+"_temp").remove();try{r(null,new Function("return "+l)())}catch(e){r(e)}}}).on("error",function(e){a.__bH(m),d.__fl||(i("#"+p+"_temp").remove(),r(e))}),l.target=p,l.action=t.get("action"),l.method="POST",l.enctype="multipart/form-data",l.submit()}}),p=l.extend({__fm:function(e,t,r,n){for(var i=new FormData,a=this,o=e.files,l=0;l<o.length;l++)i.append(t.get("name"),o[l]);var d=new XMLHttpRequest;d.open("post",t.get("action"),!0),d.onload=function(){if(!a.__fl)try{r(null,new Function("return "+d.responseText)())}catch(e){r(e)}},d.onerror=function(e){a.__fl||(e.message="network error",r(e))},d.upload.onprogress=function(e){e.lengthComputable?n(e.loaded/e.total):n(0)},d.send(i)}});r.exports=n.View.extend({init:function(e){var t;t="xhr"==this.updater.get("type")&&window.FormData?p:d,this.capture("__fn",new t),this.updater.snapshot(),this.assign(e)},assign:function(e){var t=this,r=t.updater.altered(),n=e.disabled+""=="true"||i("#"+t.id)[0].hasAttribute("mx-disabled");return t.updater.set({name:e.name||"file",action:e.action||"",multiple:e.multiple+""=="true",accept:e.accept,disabled:n}),r||(r=t.updater.altered()),!!r&&(t.updater.snapshot(),!0)},render:function(){var e=this,t="file_"+e.id,r=i("#"+t);r.length&&r.remove();var n=e.updater.get(),a=i.isFunction(o)?o({disabled:n.disabled,name:n.name,nodeId:t},e.id):o;e.wrapEvent&&(a=e.wrapEvent(a)),i("#"+e.id).append(a),r=i("#"+t),n.multiple&&r.attr("multiple","multiple"),n.accept&&r.prop("accept",n.accept)},"__fo<change>":function(e){var t=this,r=i("#"+t.id),n=e.eventTarget.files,a=i.Event("start",{files:n});(r.trigger(a),a.isDefaultPrevented())?t.render():(t.capture("__fn").__fm(e.target,t.updater,function(e,t){e?r.trigger({type:"error",error:e}):r.trigger({type:"success",files:n,response:t})},function(e){r.trigger({type:"progress",percent:e})}),t.render())}})});