define("mx-indics/dialog",["magix","mx-popover/index","mx-dragsort/index"],(e,l,i)=>{e("mx-popover/index"),e("mx-dragsort/index");var a=e("magix");a.applyStyle("_zs_galleryaa",'._zs_galleryhZ{box-shadow:0 1px 1px 0 rgba(0,0,0,.08);border:1px solid #f5f5f6}[mx-view*="mx-indics/index"]{display:inline-block;vertical-align:middle}._zs_galleryi_{position:relative;height:100%}._zs_galleryi_ ._zs_galleryia{width:100%;height:60px;padding:0 24px;background-color:#fff;line-height:60px;border-bottom:1px solid #e6e6e6}._zs_galleryi_ ._zs_galleryic{position:absolute;top:60px;left:0;bottom:0;right:0;overflow-y:auto}._zs_galleryi_ ._zs_galleryic ._zs_galleryid{position:relative;padding:16px 24px}._zs_galleryi_ ._zs_galleryic ._zs_galleryid:nth-of-type(2n){background-color:#fafafa}._zs_galleryi_ ._zs_galleryic ._zs_galleryie{position:absolute;top:16px;left:24px;width:96px;padding:8px 0;color:#999}._zs_galleryi_ ._zs_galleryic ._zs_galleryif{float:left;padding:8px 0}._zs_galleryi_ ._zs_galleryic ._zs_galleryif ._zs_galleryig{position:relative;top:1px;left:1px;font-size:14px;color:#ccc}._zs_galleryi_._zs_galleryih ._zs_galleryid{padding-left:128px}._zs_galleryi_._zs_galleryii{padding-right:240px}._zs_galleryi_._zs_galleryii ._zs_galleryic{right:240px;border-right:1px solid #e6e6e6}._zs_galleryi_._zs_galleryii ._zs_galleryij{position:absolute;top:0;right:0;width:240px;height:98px}._zs_galleryi_._zs_galleryii ._zs_galleryij ._zs_galleryik{height:60px;line-height:60px;font-size:16px;padding-left:24px;border-bottom:1px solid #e6e6e6}._zs_galleryi_._zs_galleryii ._zs_galleryij ._zs_galleryil{height:38px;padding:0 24px;line-height:38px;text-align:right;background-color:#fafafa}._zs_galleryi_._zs_galleryii ._zs_galleryim{position:absolute;top:98px;right:0;bottom:0;width:240px;padding:0 24px 16px;overflow-y:scroll;background-color:#fafafa}._zs_galleryi_._zs_galleryii ._zs_galleryim ._zs_galleryin{height:30px;margin-bottom:5px;padding:0 15px;line-height:28px;background:#fff;border:1px solid #e6e6e6;border-radius:4px;cursor:move}._zs_galleryi_._zs_galleryii ._zs_galleryim ._zs_galleryin:last-child{margin-bottom:0}._zs_galleryio{position:relative;color:#333}._zs_galleryio:hover{color:#333;border-color:#ccc}._zs_galleryio:focus{border-color:#ccc}._zs_galleryip{margin-right:10px}._zs_galleryip ._zs_galleryiq{position:relative;top:2px}._zs_galleryir{padding-right:20px}._zs_galleryir ._zs_galleryis{position:absolute;top:0;right:0;width:20px;height:32px;line-height:32px;text-align:center;font-size:18px}'),i.exports=a.View.extend({tmpl:function(e,l,i,a,r,t,s,_){if(i||(i=e),!r){var g={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},o=/[&<>"'`]/g,c=function(e){return"&"+g[e]+";"};r=function(e){return""+(null==e?"":e)},a=function(e){return r(e).replace(o,c)}}if(!t){var n={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},d=function(e){return n[e]},p=/[!')(*]/g;t=function(e){return encodeURIComponent(r(e)).replace(p,d)}}if(!_){var x=/[\\'"]/g;_=function(e){return r(e).replace(x,"\\$&")}}var f="",h=e.sortable,y=e.hasParent,v=e.limit,z=e.selectedItems,u=e.groups,m=e.width;f+='<div mxv class="_zs_galleryi_ ',h&&(f+="_zs_galleryii"),f+=" ",y&&(f+="_zs_galleryih"),f+='"><div mxa="_zs_gallerycj:_" class="_zs_galleryia"><div mxa="_zs_gallerycj:a" class="left"><span mxs="_zs_gallerycj:_" class="fontsize-16">选择数据字段</span>',v>0&&(f+='<span mxa="_zs_gallerycj:b" class="color-9 font-tahoma bold ml10">'+a(z.length)+" / "+a(v)+"</span>"),f+=" ",h||(f+='<a mxs="_zs_gallerycj:a" href="javascript:;" class="link-brand fr" mx-click="'+l+'clear()"><i class="mc-iconfont displacement-2">&#xe72e;</i>清空</a>'),f+='</div></div><div mxv mxa="_zs_gallerycj:c" class="_zs_galleryic">';for(var b=0,k=u.length;b<k;b++){var w=u[b];f+='<div mxv mxa="_zs_gallerycj:d" class="_zs_galleryid clearfix">',w.text&&(f+='<div mxa="_zs_gallerycj:e" class="_zs_galleryie">'+a(w.text)+"</div>"),f+='<div mxv mxa="_zs_gallerycj:f" class="clearfix">';for(var j=0,I=w.fields,E=I.length;j<E;j++){var P=I[j];f+='<div mxv class="_zs_galleryif" style="width: '+a(m)+';"><label mxv ',v>0&&z.length>=v&&!P.checked&&(f+=' class="cursor-not-allow" '),f+='><input type="checkbox" name="field" value="'+a(P.value)+'" class="checkbox" ',P.checked&&(f+=' checked="true" '),f+=" ",v>0&&z.length>=v&&!P.checked&&(f+=' disabled="true" '),f+=' mx-change="'+l+"toggle({value:'"+a(_(P.value))+"',text:'"+a(_(P.text))+"'})\"/>"+a(P.text)+"</label>",P.tip&&(f+='<i class="mc-iconfont _zs_galleryig" mx-view="mx-popover/index?width=240&content='+t(P.tip)+'">&#xe7aa;</i>'),f+="</div>"}f+="</div></div>"}if(f+="</div>",h){f+='<div mxs="_zs_gallerycj:b" class="_zs_galleryij"><div class="_zs_galleryik">自定义字段</div><div class="_zs_galleryil"><span class="color-9 mr10">可拖动排序</span><a href="javascript:;" class="link-brand" mx-click="'+l+'clear()"><i class="mc-iconfont displacement-2">&#xe72e;</i>清空</a></div></div><div mxa="_zs_gallerycj:g" class="_zs_galleryim" mx-view="mx-dragsort/index" mx-dragfinish="'+l+'drag()">';for(var $=0,M=z.length;$<M;$++){var V=z[$];f+='<div class="_zs_galleryin" data-value="'+a(V.value)+'" data-text="'+a(V.text)+'">'+a(V.text)+"</div>"}f+="</div>"}return f+="</div>"},init:function(e){var l=e.selected||[],i=e.fields||[],a=e.parents||[];selectedItems=[],l.forEach(function(e){for(var l=0;l<i.length;l++){var a=i[l];if(a.value==e){a.checked=!0,selectedItems.push({value:a.value,text:a.text});break}}});var r,t=e.lineNumber,s=[];if(a.length>0)s=a.map(function(e){var l=[];return i.forEach(function(i){i.pValue==e.value&&l.push(i)}),{text:e.text,fields:l}}),r=!0;else{for(var _=Math.ceil(i.length/t),g=0;g<_;g++){var o={fields:i.slice(g*t,(g+1)*t)};s.push(o)}r=!1}this.updater.set({width:Math.floor(100/t)+"%",hasParent:r,sortable:e.sortable,fields:i,groups:s,selectedItems:selectedItems,limit:e.limit}),this.viewOptions=e},render:function(){this.updater.digest({})},"toggle<change>":function(e){for(var l=e.target.checked,i=e.params.value,a=e.params.text,r=this.updater,t=r.get("fields"),s=0;s<t.length;s++)if(t[s].value==i){t[s].checked=l;break}var _=r.get("selectedItems"),g=r.get("sortable");if(l)g?_.push({value:i,text:a}):_=t.filter(function(e){return e.checked});else for(s=0;s<_.length;s++)if(_[s].value==i){_.splice(s,1);break}r.digest({fields:t,selectedItems:_})},"drag<dragfinish>":function(e){for(var l=[],i=$("#"+this.id+" ._zs_galleryin"),a=0,r=i.length;a<r;a++){var t=$(i[a]);l.push({value:t.data("value"),text:t.data("text")})}this.updater.digest({selectedItems:l})},"clear<click>":function(){var e=this.updater,l=e.get("fields");l.forEach(function(e){e.checked=!1}),e.digest({fields:l,selectedItems:[]})},check:function(){event.preventDefault();var e=this.updater.get("selectedItems").map(function(e){return e.value});return new Promise(function(l){l({ok:e.length>0,msg:"请至少选择一个指标",data:{selected:e}})})}})});