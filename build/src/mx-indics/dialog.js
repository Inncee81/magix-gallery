define("mx-indics/dialog",["magix","mx-popover/index","mx-dragsort/index"],(e,l,a)=>{e("mx-popover/index"),e("mx-dragsort/index");var r=e("magix");r.applyStyle("_zs_gallerya_",'._zs_gallerygN{position:relative;height:100%}._zs_gallerygN ._zs_gallerygO{width:100%;height:60px;padding:0 24px;background-color:#fff;line-height:60px;border-bottom:1px solid var(--color-border)}._zs_gallerygN ._zs_gallerygP{position:absolute;top:60px;left:0;bottom:0;right:0;overflow-y:auto}._zs_gallerygN ._zs_gallerygP ._zs_gallerygQ{position:relative;padding:16px 24px}._zs_gallerygN ._zs_gallerygP ._zs_gallerygQ:nth-of-type(2n){background-color:var(--color-bg)}._zs_gallerygN ._zs_gallerygP ._zs_gallerygR{position:absolute;top:16px;left:24px;width:90px;padding:8px 0;color:#999}._zs_gallerygN ._zs_gallerygP ._zs_gallerygS{float:left;padding:8px 0;white-space:nowrap}._zs_gallerygN ._zs_gallerygP ._zs_gallerygS ._zs_gallerygT{position:relative;top:1px;left:1px;font-size:14px;color:#ccc}._zs_gallerygN._zs_gallerygU ._zs_gallerygQ{padding-left:122px}._zs_gallerygN._zs_gallerygV{padding-right:240px}._zs_gallerygN._zs_gallerygV ._zs_gallerygP{right:240px;border-right:1px solid var(--color-border)}._zs_gallerygN._zs_gallerygV ._zs_gallerygW{position:absolute;top:0;right:0;width:240px;height:98px}._zs_gallerygN._zs_gallerygV ._zs_gallerygW ._zs_gallerygX{height:60px;line-height:60px;font-size:16px;padding-left:24px;border-bottom:1px solid var(--color-border)}._zs_gallerygN._zs_gallerygV ._zs_gallerygW ._zs_gallerygY{height:38px;padding:0 24px;line-height:38px;text-align:right;background-color:var(--color-bg)}._zs_gallerygN._zs_gallerygV ._zs_gallerygZ{position:absolute;top:98px;right:0;bottom:0;width:240px;padding:0 24px 16px;overflow-y:scroll;background-color:var(--color-bg)}._zs_gallerygN._zs_gallerygV ._zs_gallerygZ ._zs_galleryh_{height:30px;margin-bottom:5px;padding:0 15px;line-height:28px;background:#fff;border:1px solid var(--color-border);border-radius:var(--border-radius);cursor:move}._zs_gallerygN._zs_gallerygV ._zs_gallerygZ ._zs_galleryh_:last-child{margin-bottom:0}._zs_galleryha{display:inline-block;width:40px;padding-right:10px;margin-right:10px;text-align:center}._zs_galleryha ._zs_galleryhb{position:relative;top:2px;font-size:18px}._zs_galleryhc{display:inline-block;width:auto}[mx-view*="mx-indics/index"]{display:inline-block;vertical-align:middle}[mx-view*="mx-indics/index"]:hover ._zs_galleryha,[mx-view*="mx-indics/index"]:hover ._zs_galleryhc{border-color:var(--border-highlight-hover);color:#333}[mx-view*="mx-indics/index"]:hover ._zs_galleryhc ._zs_galleryhd{color:var(--border-highlight-hover)}'),a.exports=r.View.extend({tmpl:function(e,l,a,r,t,s,i,g){if(a||(a=e),!t){var o={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},_=/[&<>"'`]/g,n=function(e){return"&"+o[e]+";"};t=function(e){return""+(null==e?"":e)},r=function(e){return t(e).replace(_,n)}}if(!s){var d={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},c=function(e){return d[e]},p=/[!')(*]/g;s=function(e){return encodeURIComponent(t(e)).replace(p,c)}}if(!g){var x=/[\\'"]/g;g=function(e){return t(e).replace(x,"\\$&")}}var v="",h=e.sortable,y=e.hasParent,z=e.limit,f=e.selectedItems,u=e.groups,m=e.width;v+='<div mxv class="_zs_gallerygN ',h&&(v+="_zs_gallerygV"),v+=" ",y&&(v+="_zs_gallerygU"),v+='"><div mxa="_zs_gallerycv:_" class="_zs_gallerygO"><span mxs="_zs_gallerycv:_" class="fontsize-16">选择数据字段</span>',z>0&&(v+='<span mxa="_zs_gallerycv:a" class="color-9 font-tahoma bold ml10">'+r(f.length)+" / "+r(z)+"</span>"),v+=" ",h||(v+='<a mxs="_zs_gallerycv:a" href="javascript:;" class="link-brand fr" mx-click="'+l+'clear()"><i class="mc-iconfont displacement-2">&#xe72e;</i>清空</a>'),v+='</div><div mxv mxa="_zs_gallerycv:b" class="_zs_gallerygP">';for(var b=0,k=u.length;b<k;b++){var w=u[b];v+='<div mxv mxa="_zs_gallerycv:c" class="_zs_gallerygQ clearfix">',w.text&&(v+='<div mxa="_zs_gallerycv:d" class="_zs_gallerygR">'+r(w.text)+"</div>"),v+='<div mxv mxa="_zs_gallerycv:e" class="clearfix">';for(var N=0,I=w.fields,P=I.length;N<P;N++){var V=I[N];v+='<div mxv class="_zs_gallerygS" style="width: '+r(m)+';"><label mxv ',z>0&&f.length>=z&&!V.checked&&(v+=' class="cursor-not-allow" '),v+='><input type="checkbox" name="field" value="'+r(V.value)+'" class="checkbox" ',V.checked&&(v+=' checked="true" '),v+=" ",z>0&&f.length>=z&&!V.checked&&(v+=' disabled="true" '),v+=' mx-change="'+l+"toggle({value:'"+r(g(V.value))+"',text:'"+r(g(V.text))+"'})\"/>"+r(V.text)+"</label>",V.tip&&(v+='<i class="mc-iconfont _zs_gallerygT" mx-view="mx-popover/index?width=240&content='+s(V.tip)+'">&#xe7aa;</i>'),v+="</div>"}v+="</div></div>"}if(v+="</div>",h){v+='<div mxs="_zs_gallerycv:b" class="_zs_gallerygW"><div class="_zs_gallerygX">自定义字段</div><div class="_zs_gallerygY"><span class="color-9 mr10">可拖动排序</span><a href="javascript:;" class="link-brand" mx-click="'+l+'clear()"><i class="mc-iconfont displacement-2">&#xe72e;</i>清空</a></div></div><div mxa="_zs_gallerycv:f" class="_zs_gallerygZ" mx-view="mx-dragsort/index" mx-dragfinish="'+l+'drag()">';for(var Q=0,S=f.length;Q<S;Q++){var W=f[Q];v+='<div class="_zs_galleryh_" data-value="'+r(W.value)+'" data-text="'+r(W.text)+'">'+r(W.text)+"</div>"}v+="</div>"}return v+="</div>"},init:function(e){var l=e.selected||[],a=e.fields||[],r=e.parents||[];selectedItems=[],l.forEach(function(e){for(var l=0;l<a.length;l++){var r=a[l];if(r.value==e){r.checked=!0,selectedItems.push({value:r.value,text:r.text});break}}});var t,s=e.lineNumber,i=[];if(r.length>0)i=r.map(function(e){var l=[];return a.forEach(function(a){a.pValue==e.value&&l.push(a)}),{text:e.text,fields:l}}),t=!0;else{for(var g=Math.ceil(a.length/s),o=0;o<g;o++){var _={fields:a.slice(o*s,(o+1)*s)};i.push(_)}t=!1}this.updater.set({width:Math.floor(100/s)+"%",hasParent:t,sortable:e.sortable,fields:a,groups:i,selectedItems:selectedItems,limit:e.limit}),this.viewOptions=e},render:function(){this.updater.digest({})},"toggle<change>":function(e){for(var l=e.target.checked,a=e.params.value,r=e.params.text,t=this.updater,s=t.get("fields"),i=0;i<s.length;i++)if(s[i].value==a){s[i].checked=l;break}var g=t.get("selectedItems"),o=t.get("sortable");if(l)o?g.push({value:a,text:r}):g=s.filter(function(e){return e.checked});else for(i=0;i<g.length;i++)if(g[i].value==a){g.splice(i,1);break}t.digest({fields:s,selectedItems:g})},"drag<dragfinish>":function(e){for(var l=[],a=$("#"+this.id+" ._zs_galleryh_"),r=0,t=a.length;r<t;r++){var s=$(a[r]);l.push({value:s.data("value"),text:s.data("text")})}this.updater.digest({selectedItems:l})},"clear<click>":function(){var e=this.updater,l=e.get("fields");l.forEach(function(e){e.checked=!1}),e.digest({fields:l,selectedItems:[]})},check:function(){event.preventDefault();var e=this.updater.get("selectedItems").map(function(e){return e.value});return new Promise(function(l){l({ok:e.length>0,msg:"请至少选择一个指标",data:{selected:e}})})}})});