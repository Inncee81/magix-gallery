define("mx-preview/index",["magix","$"],(e,i,r)=>{var t,a=e("magix"),l=e("$");a.applyStyle("_zs_galleryat",'._zs_gallerykU{box-shadow:0 1px 1px 0 rgba(0,0,0,.08);border:1px solid #f5f5f6}[mx-view*="mx-preview/index"]{display:inline-block}._zs_gallerykV{color:#ccc;font-size:30px}._zs_gallerykW{display:table;text-align:center}._zs_gallerykW ._zs_gallerykX{display:table-cell;vertical-align:middle}._zs_gallerykW ._zs_gallerykX ._zs_gallerykY,._zs_gallerykW ._zs_gallerykX ._zs_gallerykZ{max-width:100%;max-height:100%}._zs_gallerykW ._zs_gallerykX ._zs_galleryl_{white-space:nowrap;word-wrap:normal;overflow:hidden;text-overflow:ellipsis}._zs_gallerykW ._zs_gallerykX ._zs_galleryla{font-size:20px;color:#999}._zs_gallerykW ._zs_gallerykX ._zs_gallerylb{-webkit-transform-origin:left top;transform-origin:left top}._zs_gallerylc{display:none;position:absolute;z-index:99999;border-collapse:separate;background-color:#fff;padding:10px;box-shadow:0 1px 1px 0 rgba(0,0,0,.08);border:1px solid #f5f5f6}._zs_gallerylc ._zs_galleryld{display:block;width:100%;height:100%;overflow:hidden}'),r.exports=a.View.extend({tmpl:function(e,i,r,t,a,l,s,n){if(r||(r=e),!a){var o={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},d=/[&<>"'`]/g,c=function(e){return"&"+o[e]+";"};a=function(e){return""+(null==e?"":e)},t=function(e){return a(e).replace(d,c)}}if(!l){var h={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},g=function(e){return h[e]},_=/[!')(*]/g;l=function(e){return encodeURIComponent(a(e)).replace(_,g)}}if(!n){var f=/[\\'"]/g;n=function(e){return a(e).replace(f,"\\$&")}}var m="",p=e.maxWidth,v=e.maxHeight,u=e.preview,y=e.viewId;return m+='<div class="_zs_gallerykW" style="width: '+t(p)+"px; height: "+t(v)+'px;" ',u&&(m+=' mx-mouseover="'+i+'preview()" mx-mouseout="'+i+'hide()" '),m+='><div class="_zs_gallerykX" style="height: '+t(v)+'px;" id="'+t(y)+'_inner"><i mxs="_zs_galleryc\\:_" class="mc-iconfont _zs_gallerykV">&#xe615;</i></div></div>'},init:function(e){var i=this;i.extra=e,i.on("destroy",function(){clearTimeout(i.timer),l("#pic_preview_"+i.id).remove()})},render:function(){var e,i=this,r=i.extra,t=+r.format||5,a={image:[2,11],flash:[3,9],taotu:[23],video:[4],text:[5],iframe:[10]};for(var l in a)a[l].indexOf(t)>-1&&(e=l);var s=r.url,n=r.xiaotuUrl,o=r.datuUrl;if("taotu"==e&&(s=r.xiaotuUrl),i.updater.digest({viewId:i.id,preview:r.preview+""!="false",type:e,url:s,xiaotuUrl:n,datuUrl:o,clickUrl:r.clickUrl,width:+r.width,height:+r.height,maxWidth:+r.maxWidth||100,maxHeight:+r.maxHeight||100}),window.IntersectionObserver){var d=new IntersectionObserver(function(e){e.forEach(function(e){var r=e.target;e.isIntersecting&&(i.thumbnail(),d.unobserve(r))})},{rootMargin:"10px 0px"});d.observe(document.querySelector("#"+i.id))}else i.thumbnail()},thumbnail:function(){var e=this.updater.get(),i=e.type,r=e.url,t=e.maxWidth,a=e.maxHeight,s="";switch(i){case"image":case"taotu":s='<img class="_zs_gallerykY" src="'+r+'"/>';break;case"flash":s="flash已下线";case"video":s='<video src="'+r+'" class="_zs_gallerykZ"></video>';break;case"text":(s=l('<div class="_zs_galleryl_" style="max-width: '+t+'px;"></div>'))[0].innerText=r;break;case"iframe":var n=e.width,o=e.height,d=Math.min(t/n,a/o);s='<div style="width: '+n*d+"px; height: "+o*d+'px; overflow: hidden">\n                                <iframe src="'+r+'" class="_zs_gallerylb"\n                                    style="transform:scale('+d+')"\n                                    width="'+n+'" \n                                    height="'+o+'" \n                                    frameborder="0"\n                                    scrolling="no" \n                                    marginheight="0" \n                                    marginwidth="0" \n                                    border="0"></iframe>\n                            </div>'}var c=e.clickUrl;c&&(s=l(s).wrap('<a href="'+c+'" target="_blank" rel="noopener noreferrer"></a>')),l("#"+this.id+"_inner").html(s)},"preview<mouseover>":function(e){a.inside(e.relatedTarget,e.eventTarget)||this.show()},show:function(){var e=this,i=l("#"+e.id+" ._zs_gallerykW"),r=i.offset(),a=r.left+i.outerWidth()+10,s=r.top;t&&t!=e&&t.immediatelyHide(),t=e,clearTimeout(e.timer);var n=e.updater.get(),o=n.type,d=n.url;if(d&&o&&"flash"!=o){var c=function(i,r){var t=l(window),c=t.width(),h=t.height(),g=t.scrollTop(),_=c-a;if(_<i&&(r*=_/i,i=_),r>h&&(i=i*h/r,r=h),g+h<s+r){var f=Math.min(s+r-g-h,s-g);s-=f}var m="";switch(o){case"image":m=l('<img src="'+d+'" class="_zs_galleryld"/>');break;case"taotu":m=l('<div class="clearfix">\n                        <img src="'+d+'" class="fl"/>    \n                        <img src="'+n.datuUrl+'" class="fr"/>\n                    </div>');break;case"video":m=l('<video src="'+d+'" class="_zs_galleryld"\n                        controls="controls" autoplay="autoplay"></video>');break;case"text":(m=l('<div class="_zs_galleryld"></div>'))[0].innerText=d;break;case"iframe":var p=n.width,v=n.height;m=l('<div class="_zs_galleryld">\n                        <iframe src="'+d+'"\n                            style="transform: scale('+(i-20)/p+'); transform-origin: left top;"\n                            width="'+p+'" \n                            height="'+v+'"\n                            frameborder="0" \n                            scrolling="no" \n                            marginheight="0" \n                            marginwidth="0" \n                            border="0"></iframe>\n                    </div>')}var u=n.clickUrl;u&&m.wrap('<a href="'+u+'" target="_blank" rel="noopener noreferrer"></a>');var y=l("#pic_preview_"+e.id);y.length||(y=l('<div id="pic_preview_'+e.id+'" class="_zs_gallerylc"></div>').appendTo("body")),y.empty().append(m),y.css({width:i,height:r||"auto",left:a,top:s,display:"block"})};if("taotu"==o)(h=new Image).onload=function(){var e=n.width+10+this.width+20,i=Math.max(n.height,this.height)+20;c(e,i)},h.src=n.datuUrl;else if(n.width&&n.height)c(n.width+20,n.height+20);else if("text"==o)c(600,0);else if("image"==o){var h;(h=new Image).onload=function(){c(this.width+20,this.height+20)},h.src=d}}},"hide<mouseout>":function(e){a.inside(e.relatedTarget,e.eventTarget)||this.hide()},hide:function(){var e=this;e.delayHide();var i=l("#pic_preview_"+e.id);i.off("mouseover.preview").on("mouseover.preview",function(){clearTimeout(e.timer),i.off("mouseout.preview").on("mouseout.preview",function(i){e.delayHide()})})},immediatelyHide:function(){clearTimeout(this.timer),l("#pic_preview_"+this.id).empty().css({display:"none"})},delayHide:function(){var e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){l("#pic_preview_"+e.id).empty().css({display:"none"})},300)}})});