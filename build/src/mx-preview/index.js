define("mx-preview/index",["magix","$"],(e,i,t)=>{var r,a=e("magix"),l=e("$");a.applyStyle("_zs_galleryat",'[mx-view*="mx-preview/index"]{display:inline-block;vertical-align:middle}._zs_galleryiY{color:#ccc;font-size:30px}._zs_galleryiZ{display:table;text-align:center}._zs_galleryiZ ._zs_galleryj_{display:table-cell;vertical-align:middle}._zs_galleryiZ ._zs_galleryj_ ._zs_galleryja,._zs_galleryiZ ._zs_galleryj_ ._zs_galleryjb{max-width:100%;max-height:100%}._zs_galleryiZ ._zs_galleryj_ ._zs_galleryjc{word-break:break-all;overflow:hidden;text-overflow:ellipsis}._zs_galleryiZ ._zs_galleryj_ ._zs_galleryjd{-webkit-transform-origin:left top;transform-origin:left top}._zs_galleryje{display:none;position:absolute;z-index:99999;border-collapse:separate;background-color:#fff;padding:10px}._zs_galleryje ._zs_galleryjf{display:block;width:100%;height:100%;overflow:hidden}'),t.exports=a.View.extend({tmpl:function(e,i,t,r,a,l,s,n){if(t||(t=e),!a){var o={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},d=/[&<>"'`]/g,c=function(e){return"&"+o[e]+";"};a=function(e){return""+(null==e?"":e)},r=function(e){return a(e).replace(d,c)}}if(!l){var h={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},g=function(e){return h[e]},p=/[!')(*]/g;l=function(e){return encodeURIComponent(a(e)).replace(p,g)}}if(!n){var m=/[\\'"]/g;n=function(e){return a(e).replace(m,"\\$&")}}var f="",u=e.maxWidth,_=e.maxHeight,v=e.preview,w=e.type,y=e.viewId;return f+='<div class="_zs_galleryiZ" style="width: '+r(u)+"px; height: "+r(_)+'px;" ',v&&(f+=' mx-mouseover="'+i+'preview()" mx-mouseout="'+i+'hide()" '),f+='><div class="_zs_galleryj_" style="height: '+r(_)+"px; ","text"!=w&&(f+=" font-size: 0; "),f+='" id="'+r(y)+'_inner"><i mxs="_zs_gallerydK:_" class="mc-iconfont _zs_galleryiY">&#xe615;</i></div></div>'},init:function(e){var i=this;i.updater.snapshot(),i.assign(e),i.on("destroy",function(){clearTimeout(i.timer),l("#pic_preview_"+i.id).remove()})},assign:function(e){var i,t=this.updater.altered(),r=+e.format||5,a={image:[2,11],flash:[3,9],taotu:[23],video:[4],text:[5],iframe:[10]};for(var l in a)a[l].indexOf(r)>-1&&(i=l);var s=e.url,n=e.xiaotuUrl,o=e.datuUrl;return"taotu"==i&&(s=e.xiaotuUrl),this.updater.set({viewId:this.id,placement:e.placement||"right",preview:e.preview+""!="false",type:i,url:s,xiaotuUrl:n,datuUrl:o,clickUrl:e.clickUrl,width:+e.width,height:+e.height,maxWidth:+e.maxWidth||100,maxHeight:+e.maxHeight||100}),t||(t=this.updater.altered()),!!t&&(this.updater.snapshot(),!0)},render:function(){var e=this;if(e.updater.digest({}),window.IntersectionObserver){var i=new IntersectionObserver(function(t){t.forEach(function(t){var r=t.target;(t.isIntersecting||t.intersectionRatio>0)&&(e.thumbnail(),i.unobserve(r))})},{rootMargin:"10px 0px"});i.observe(document.querySelector("#"+e.id)),e.capture("observer",{destroy:function(){i.disconnect()}})}else e.thumbnail()},thumbnail:function(){var e=this.updater.get(),i=e.type,t=e.url,r=e.maxWidth,a=e.maxHeight,s=e.width,n=e.height,o=e.clickUrl,d="";switch(i){case"image":case"taotu":d='<img class="_zs_galleryja" src="'+t+'"/>';break;case"flash":d="flash已下线";case"video":d='<video src="'+t+'" class="_zs_galleryjb"></video>';break;case"text":(d=l('<div class="_zs_galleryjc" style="max-width: '+r+"px; max-height: "+a+'px;"></div>'))[0].innerText=t;break;case"iframe":var c=Math.min(r/s,a/n);d='<div style="width: '+s*c+"px; height: "+n*c+'px; overflow: hidden">\n                                <iframe src="'+t+'" class="_zs_galleryjd"\n                                    sandbox="allow-forms allow-popups allow-pointer-lock allow-same-origin allow-scripts"\n                                    style="transform:scale('+c+')"\n                                    width="'+s+'" \n                                    height="'+n+'" \n                                    frameborder="0"\n                                    scrolling="no" \n                                    marginheight="0" \n                                    marginwidth="0" \n                                    border="0"></iframe>\n                            </div>'}o&&(d=l(d).wrap('<a href="'+o+'" target="_blank" rel="noopener noreferrer"></a>')),l("#"+this.id+"_inner").html(d)},"preview<mouseover>":function(e){a.inside(e.relatedTarget,e.eventTarget)||this.show()},show:function(){var e=this,i=l("#"+e.id+" ._zs_galleryiZ"),t=i.offset(),a=t.left,s=t.top;r&&r!=e&&r.immediatelyHide(),r=e,clearTimeout(e.timer);var n=e.updater.get(),o=n.type,d=n.url;if(d&&o&&"flash"!=o){var c=function(t,r){var c=l(window),h=c.width(),g=c.height(),p=c.scrollTop();s<p&&(s=p);var m=n.placement,f=0;if((f="left"==m?a-10:h-(a+=i.outerWidth()+10))<t&&(r*=f/t,t=f),r>g&&(t=t*g/r,r=g),p+g<s+r){var u=Math.min(s+r-p-g,s-p);s-=u}var _="";switch(o){case"image":_=l('<img src="'+d+'" class="_zs_galleryjf"/>');break;case"taotu":_=l('<div class="clearfix">\n                        <img src="'+d+'" class="fl"/>    \n                        <img src="'+n.datuUrl+'" class="fr"/>\n                    </div>');break;case"video":_=l('<video src="'+d+'" class="_zs_galleryjf"\n                        controls="controls" autoplay="autoplay"></video>');break;case"text":(_=l('<div class="_zs_galleryjf"></div>'))[0].innerText=d;break;case"iframe":var v=n.width,w=n.height;_=l('<div class="_zs_galleryjf">\n                        <iframe src="'+d+'"\n                            sandbox="allow-forms allow-popups allow-pointer-lock allow-same-origin allow-scripts"\n                            style="transform: scale('+(t-20)/v+'); transform-origin: left top;"\n                            width="'+v+'" \n                            height="'+w+'"\n                            frameborder="0" \n                            scrolling="no" \n                            marginheight="0" \n                            marginwidth="0" \n                            border="0"></iframe>\n                    </div>')}var y=n.clickUrl;y&&_.wrap('<a href="'+y+'" target="_blank" rel="noopener noreferrer"></a>');var x=l("#pic_preview_"+e.id);x.length||(x=l('<div id="pic_preview_'+e.id+'" class="_zs_galleryje mx-shadow"></div>').appendTo("body")),x.empty().append(_),x.css({width:t,height:r||"auto",left:"left"==m?a-t-10:a,top:s,display:"block"})};if("taotu"==o)(h=new Image).onload=function(){var e=n.width+10+this.width+20,i=Math.max(n.height,this.height)+20;c(e,i)},h.src=n.datuUrl;else if(n.width&&n.height)c(n.width+20,n.height+20);else if("text"==o)c(600,0);else if("image"==o){var h;(h=new Image).onload=function(){c(this.width+20,this.height+20)},h.src=d}}},"hide<mouseout>":function(e){a.inside(e.relatedTarget,e.eventTarget)||this.hide()},hide:function(){var e=this;e.delayHide();var i=l("#pic_preview_"+e.id);i.off("mouseover.preview").on("mouseover.preview",function(){clearTimeout(e.timer),i.off("mouseout.preview").on("mouseout.preview",function(i){e.delayHide()})})},immediatelyHide:function(){clearTimeout(this.timer),l("#pic_preview_"+this.id).empty().css({display:"none"})},delayHide:function(){var e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){l("#pic_preview_"+e.id).empty().css({display:"none"})},300)}})});