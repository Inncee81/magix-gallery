define("mx-tree/index",["magix","mx-tree/util","../mx-medusa/util","./branch"],(e,t,r)=>{e("./branch");var n=e("magix"),a=n.Vframe,l=e("mx-tree/util"),i=e("../mx-medusa/util");n.applyStyle("_zs_galleryaJ",':root{--mx-tree-oper-size:calc(var(--font-size) + 2px)}._zs_gallerykK{position:relative;height:32px;line-height:20px;padding-bottom:12px;background-color:#fff;overflow:hidden;transition:height .2s}._zs_gallerykK ._zs_gallerykL{float:left;width:var(--mx-tree-oper-size);height:var(--mx-tree-oper-size);margin-right:5px;line-height:var(--mx-tree-oper-size);font-size:var(--mx-tree-oper-size);color:#ccc;transition:color var(--duration);-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none}._zs_gallerykK ._zs_gallerykM{cursor:pointer}._zs_gallerykK ._zs_gallerykM:hover{color:#666}._zs_gallerykN ._zs_gallerykK{height:0;padding-bottom:0}._zs_gallerykO{position:relative}._zs_gallerykP{padding-left:calc(var(--mx-tree-oper-size) + 5px)}._zs_gallerykQ,._zs_gallerykQ ._zs_gallerykO{position:relative}._zs_gallerykQ ._zs_gallerykO:after{content:"";position:absolute;top:22px;left:calc(var(--mx-tree-oper-size)/2);bottom:2px;width:1px;background-color:var(--color-border)}._zs_gallerykQ ._zs_gallerykO:last-child:after{content:none}'),r.exports=n.View.extend({tmpl:function(e,t,r,n,a,l,i,o){if(r||(r=e),!a){var s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},c=/[&<>"'`]/g,u=function(e){return"&"+s[e]+";"};a=function(e){return""+(null==e?"":e)},n=function(e){return a(e).replace(c,u)}}if(!l){var _={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},d=function(e){return _[e]},f=/[!')(*]/g;l=function(e){return encodeURIComponent(a(e)).replace(f,d)}}if(!o){var p=/[\\'"]/g;o=function(e){return a(e).replace(p,"\\$&")}}i||(i=function(e,t,r,n){for(n=e[g];--n;)if(e[r=g+n]===t)return r;return e[r=g+e[g]++]=t,r});var g="",h="",v=e.hasLine,m=e.viewId,x=e.readOnly,y=e.needExpand,k=e.textKey,z=e.valueKey,b=e.closeMap,K=e.list;return h+='<div mxv="readOnly,needExpand,closeMap,list" class="',v&&(h+=" _zs_gallerykQ "),h+='" id="tree_'+n(m)+'" mx-change="'+t+'__ad()" mx-view="mx-tree/branch?readOnly='+i(r,x)+"&needExpand="+i(r,y)+"&textKey="+l(k)+"&valueKey="+l(z)+"&closeMap="+i(r,b)+"&list="+i(r,K)+'"></div>'},init:function(e){var t=this;t.__fj={},t.__fk=[],t.__a=$("#"+t.id),t.updater.snapshot(),t.assign(e)},assign:function(e){var t,r=this,a=r.updater.altered(),o=e.readOnly+""=="true",s=e.hasLine+""=="true",c=e.valueKey||"value",u=e.textKey||"text",_=e.parentKey||"pValue",d=e.needAll+""=="true",f=e.needExpand+""=="true",p=l.listToTree(e.list,c,_);if(d){var g={};g[c]=r.id+"_all",g[u]=i["select.all"],g.isAll=!0,g.children=p.list,t=[g]}else t=p.list;var h=e.close+""=="true",v={},m=function(e){e.forEach(function(e){v[e[c]]=h,e.children&&e.children.length>0&&m(e.children)})};m(t),r.__fj=n.mix(v,r.__fj);var x=function(e){e.forEach(function(e){e.close=r.__fj[e[c]],e.children&&e.children.length>0&&x(e.children)})};return x(t),r.__fk=r.__fk.map(function(e){return e+""}),(e.bottomValues||[]).forEach(function(e){e+="",r.__fk.indexOf(e)<0&&r.__fk.push(e)}),r.updater.set({viewId:r.id,valueKey:c,textKey:u,list:t,readOnly:o,hasLine:s,needExpand:f,closeMap:r.__fj,bottomValues:r.__fk}),r.__a.val(r.__fk),a||(a=r.updater.altered()),!!a&&(r.updater.snapshot(),!0)},render:function(){this.updater.digest();var e=this.updater.get("bottomValues");e.length>0&&this.setBottomValues(e)},"__ad<change>":function(e){e.stopPropagation();var t=this.getBottomValues();this.__a.val(this.__fk=t).trigger($.Event("change",{bottomValues:t}))},setBottomValues:function(e){this.loop(function(t){t.invoke("setValues",[e])})},getBottomValues:function(){var e=[];return this.loop(function(t){var r=t.invoke("getValues");e=e.concat(r)}),e},getBottomItems:function(){var e=[];return this.loop(function(t){var r=t.invoke("getItems");e=e.concat(r)}),e},loop:function(e){var t=this.owner.children(),r=function(t){for(var n=0,l=t;n<l.length;n++){var i=l[n],o=a.get(i);e(o);var s=o.children();s&&s.length>0&&r(s)}};r(t)}})});