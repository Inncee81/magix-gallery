define("mx-tree/index",["magix","mx-tree/util","../mx-medusa/util","./branch"],(e,t,n)=>{e("./branch");var r=e("magix"),l=r.Vframe,a=e("mx-tree/util"),o=e("../mx-medusa/util");r.applyStyle("_zs_galleryaM",'._zs_gallerynl{box-shadow:0 1px 1px 0 rgba(0,0,0,.08);border:1px solid #f5f5f6}._zs_gallerynm{position:relative;height:32px;line-height:20px;padding-bottom:12px;background-color:#fff;overflow:hidden;transition:height .2s}._zs_gallerynm ._zs_gallerynn{float:left;height:20px;margin-right:5px;line-height:20px;color:#ccc;transition:color .25s;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none}._zs_gallerynm ._zs_galleryno{cursor:pointer;font-size:14px}._zs_gallerynm ._zs_galleryno:hover{color:#666}._zs_gallerynp ._zs_gallerynm{height:0;padding-bottom:0}._zs_gallerynq{position:relative}._zs_gallerynr{padding-left:20px}._zs_galleryns,._zs_galleryns ._zs_gallerynq{position:relative}._zs_galleryns ._zs_gallerynq:after{content:"";position:absolute;top:22px;left:7px;bottom:2px;width:1px;background-color:#e6e6e6}._zs_galleryns ._zs_gallerynq:last-child:after{content:none}'),n.exports=r.View.extend({tmpl:function(e,t,n,r,l,a,o,i){if(n||(n=e),!l){var s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},u=/[&<>"'`]/g,c=function(e){return"&"+s[e]+";"};l=function(e){return""+(null==e?"":e)},r=function(e){return l(e).replace(u,c)}}if(!a){var _={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},f=function(e){return _[e]},d=/[!')(*]/g;a=function(e){return encodeURIComponent(l(e)).replace(d,f)}}if(!i){var p=/[\\'"]/g;i=function(e){return l(e).replace(p,"\\$&")}}o||(o=function(e,t,n,r){for(r=e[g];--r;)if(e[n=g+r]===t)return n;return e[n=g+e[g]++]=t,n});var g="",h="",m=e.hasLine,v=e.viewId,x=e.readOnly,y=e.needExpand,z=e.textKey,b=e.valueKey,B=e.closeMap,V=e.list;return h+='<div mxv="readOnly,needExpand,closeMap,list" class="',m&&(h+=" _zs_galleryns "),h+='" id="tree_'+r(v)+'" mx-change="'+t+'__ac()" mx-view="mx-tree/branch?fromTop='+o(n,!0)+"&readOnly="+o(n,x)+"&needExpand="+o(n,y)+"&textKey="+a(z)+"&valueKey="+a(b)+"&closeMap="+o(n,B)+"&list="+o(n,V)+'"></div>'},init:function(e){var t=this;t.__fA={},t.__fB=[],t.__k=$("#"+t.id),t.updater.snapshot(),t.assign(e)},assign:function(e){var t,n=this,l=n.updater.altered(),i=e.readOnly+""=="true",s=e.hasLine+""=="true",u=e.valueKey||"value",c=e.textKey||"text",_=e.parentKey||"pValue",f=e.needAll+""=="true",d=e.needExpand+""=="true",p=a.listToTree(e.list,u,_);if(f){var g={};g[u]=n.id+"_all",g[c]=o["select.all"],g.isAll=!0,g.children=p.list,t=[g]}else t=p.list;var h=e.close+""=="true",m={},v=function(e){e.forEach(function(e){m[e[u]]=h,e.children&&e.children.length>0&&v(e.children)})};v(t),n.__fA=r.mix(m,n.__fA);var x=function(e){e.forEach(function(e){e.close=n.__fA[e[u]],e.children&&e.children.length>0&&x(e.children)})};return x(t),n.__fB=n.__fB.map(function(e){return e+""}),(e.bottomValues||[]).forEach(function(e){e+="",n.__fB.indexOf(e)<0&&n.__fB.push(e)}),n.updater.set({viewId:n.id,valueKey:u,textKey:c,list:t,readOnly:i,hasLine:s,needExpand:d,closeMap:n.__fA,bottomValues:n.__fB}),n.__k.val(n.__fB),l||(l=n.updater.altered()),!!l&&(n.updater.snapshot(),!0)},render:function(){this.updater.digest();var e=this.updater.get("bottomValues");e.length>0&&this.setBottomValues(e)},"__ac<change>":function(e){e.stopPropagation();var t=this.getBottomValues();this.__k.val(this.__fB=t).trigger($.Event("change",{bottomValues:t}))},setBottomValues:function(e){this.loop(function(t){t.invoke("setValues",[e])})},getBottomValues:function(){var e=[];return this.loop(function(t){var n=t.invoke("getValues");e=e.concat(n)}),e},getBottomItems:function(){var e=[];return this.loop(function(t){var n=t.invoke("getItems");e=e.concat(n)}),e},loop:function(e){var t=this.owner.children(),n=function(t){for(var r=0,a=t;r<a.length;r++){var o=a[r],i=l.get(o);e(i);var s=i.children();s&&s.length>0&&n(s)}};n(t)}})});