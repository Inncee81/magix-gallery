define("mx-calendar/range",["magix","$","mx-calendar/util","../mx-medusa/util","mx-switch/index","./datepicker"],(e,a,r)=>{e("mx-switch/index"),e("./datepicker");var l=e("magix"),t=e("$"),s=e("mx-calendar/util"),i=s.dateFormat,_=s.dateParse,c=s.getDefaultDate,g=s.getQuickInfos,n=s.foreverStr,d=e("../mx-medusa/util");l.applyStyle("_zs_gallerys",'._zs_gallerycr{--mx-calendar-range-input-width:100px;position:relative;z-index:1000;min-width:calc(var(--mx-calendar-range-input-width)*2 + 40px);width:100%;padding:10px;border-radius:var(--border-radius);background-color:#fff;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none}._zs_gallerycr ._zs_gallerycs{margin-bottom:5px;color:#999}._zs_gallerycr ._zs_galleryct{position:relative;line-height:var(--input-small-height)}._zs_gallerycr ._zs_galleryct ._zs_gallerycu{float:left;width:50%;min-width:var(--mx-calendar-range-input-width);text-align:center;cursor:text}._zs_gallerycr ._zs_galleryct ._zs_gallerycu ._zs_gallerybI{height:var(--input-small-height);padding:0;line-height:var(--input-small-height);border-radius:var(--border-radius);background-color:var(--color-bg-hover);border:0;color:#333}._zs_gallerycr ._zs_galleryct ._zs_gallerycu ._zs_gallerycv ._zs_gallerybI{color:var(--color-brand)}._zs_gallerycr ._zs_galleryct ._zs_gallerycu ._zs_gallerycw ._zs_gallerybI{color:var(--color-brand-vs)}._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"]{width:100%;min-height:var(--input-small-height)}._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-disabled] ._zs_gallerycv ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-disabled] ._zs_gallerycw ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-disabled]:hover ._zs_gallerycv ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-disabled]:hover ._zs_gallerycw ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-disabled]:hover ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-disabled] ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-view*="disabled=true"] ._zs_gallerycv ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-view*="disabled=true"] ._zs_gallerycw ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-view*="disabled=true"]:hover ._zs_gallerycv ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-view*="disabled=true"]:hover ._zs_gallerycw ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-view*="disabled=true"]:hover ._zs_gallerybI,._zs_gallerycr ._zs_galleryct ._zs_gallerycu [mx-view*="mx-calendar/datepicker"][mx-view*="disabled=true"] ._zs_gallerybI{color:#999}._zs_gallerycr ._zs_galleryct ._zs_gallerycx{padding-right:9px}._zs_gallerycr ._zs_galleryct ._zs_gallerycy{padding-left:9px}._zs_gallerycr ._zs_galleryct ._zs_gallerycz{position:absolute;top:0;left:50%;width:18px;height:var(--input-small-height);margin-left:-9px;text-align:center}._zs_gallerycr ._zs_gallerycA{margin-top:15px}._zs_gallerycr ._zs_gallerycA ._zs_gallerycB{float:left;width:44%;height:var(--input-small-height);margin-right:6%;margin-top:5px;padding:0 10px;line-height:var(--input-small-height);border-radius:var(--border-radius);cursor:pointer;overflow:hidden;white-space:nowrap}._zs_gallerycr ._zs_gallerycA ._zs_gallerycB:hover{background-color:var(--color-bg-hover)}._zs_gallerycr ._zs_gallerycA ._zs_gallerycB._zs_gallerycC,._zs_gallerycr ._zs_gallerycA ._zs_gallerycB._zs_gallerycC:hover{color:var(--color-brand);background-color:var(--color-brand-opacity)}._zs_gallerycr ._zs_gallerycA._zs_gallerycD ._zs_gallerycB{width:32%;margin-right:1%}._zs_gallerycr._zs_gallerycE{--mx-calendar-range-input-width:calc(var(--font-size)*11)}');var y=l.View.extend({tmpl:function(e,a,r,l,t,s,i,_){if(r||(r=e),!t){var c={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},g=/[&<>"'`]/g,n=function(e){return"&"+c[e]+";"};t=function(e){return""+(null==e?"":e)},l=function(e){return t(e).replace(g,n)}}if(!s){var d={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},y=function(e){return d[e]},m=/[!')(*]/g;s=function(e){return encodeURIComponent(t(e)).replace(m,y)}}if(!_){var o=/[\\'"]/g;_=function(e){return t(e).replace(o,"\\$&")}}i||(i=function(e,a,r,l){for(l=e[z];--l;)if(e[r=z+l]===a)return r;return e[r=z+e[z]++]=a,r});var z="",u="",v=e.timeType,x=e.title,p=e.vsEnable,h=e.vs,b=e.min,f=e.endDisabled,k=e.dates,w=e.max,D=e.formatter,T=e.disabledWeeks,S=e.dateType,q=e.startDisabled,I=e.endMinFn,M=e.align,Y=e.vsSingle,A=e.quickInfos,K=e.quickGap,B=e.quickTip,G=e.submitText,W=e.cancelText,C=e.errorMsg;if(u+='<div mxv class="_zs_gallerycr ',v&&(u+=" _zs_gallerycE "),u+='" mx-contextmenu="'+a+'__J()"><div mxv mxa="_zs_gallery;:_" class="_zs_galleryct"><div mxa="_zs_gallery;:a" class="_zs_gallerycs clearfix"><span mxa="_zs_gallery;:b" class="fl">'+l(x)+"：</span>",p&&(u+='<span class="fr" mx-change="'+a+'__L()" mx-view="mx-switch/index?state='+s(h)+'"></span>'),u+='</div><div mxv mxa="_zs_gallery;:c" class="clearfix pr"><div mxv mxa="_zs_gallery;:d" class="_zs_gallerycu _zs_gallerycx"><div mxv="disabledWeeks" ',h&&(u+=' class="_zs_gallerycv" '),u+=' mx-change="'+a+"__K({trigger:'start'})\" mx-view=\"mx-calendar/datepicker?min="+s(b)+"&max="+s(f?k.endStr:w)+"&formatter="+s(D)+"&disabledWeeks="+i(r,T)+"&timeType="+s(v)+"&dateType="+s(S)+"&selected="+s(k.startStr)+"&disabled=",q&&(u+="true"),u+='"></div></div><div mxs="_zs_gallery;:_" class="_zs_gallerycz">-</div><div mxv mxa="_zs_gallery;:e" class="_zs_gallerycu _zs_gallerycy"><div mxv="disabledWeeks" ',h&&(u+=' class="_zs_gallerycw" '),u+=' mx-change="'+a+"__K({trigger:'end'})\" mx-view=\"mx-calendar/datepicker?min="+s(h?b:I(k.startStr,b))+"&max="+s(w)+"&formatter="+s(D)+"&disabledWeeks="+i(r,T)+"&timeType="+s(v)+"&dateType="+s(S)+"&align="+s(M)+"&selected="+s(k.endStr)+"&disabled=",(!h&&Y||f)&&(u+="true"),u+='"></div></div></div></div>',A.length&&!h&&!Y){u+='<div class="_zs_gallerycA ',A.length>K&&(u+="_zs_gallerycD"),u+='"><div mxa="_zs_gallery;:f" class="_zs_gallerycs">'+l(B)+'：</div><div mxa="_zs_gallery;:g" class="clearfix">';for(var E=0,F=A.length;E<F;E++){var P=A[E];u+='<span class="_zs_gallerycB ',k.quickDateKey==P.key&&(u+="_zs_gallerycC"),u+='" mx-click="'+a+"__r({quick:true,quickInfo:'"+i(r,P)+'\'})" title="'+l(P.text)+'">'+l(P.text)+"</span>"}u+="</div></div>"}return u+='</div><div mxa="_zs_gallery;:h" class="mx-output-footer"><button mxa="_zs_gallery;:i" mx-click="'+a+'__r()" type="button" class="btn btn-small btn-brand mr10">'+l(G)+'</button><button mxa="_zs_gallery;:j" mx-click="'+a+'__M()" type="button" class="btn btn-small mr10">'+l(W)+'</button><span mxa="_zs_gallery;:k" class="color-red">'+l(C)+"</span></div>"},init:function(e){var a=t.extend(!0,{},e.configs);a.dates=a.dates||{},a.formatter=a.formatter||"YYYY-MM-dd",a.title=a.title||d["calendar.range.title"];var r=a.dates,l=a.formatter,s=(a.quickDates,r.startStr),i=r.endStr,n=a.min,y=a.max;s||(r.startStr=s=c(n,y,l),r.start=_(s)),r.start||(r.start=_(r.startStr)),i||(r.endStr=i=c(n,y,l),r.end=_(i)),r.end||(r.end=_(r.endStr));var m=g(a.quickDates,s,l);if(!r.quickDateKey)for(var o=0;o<m.length;o++){var z=m[o];if(z.start==s&&z.end==i){r.quickDateKey=z.key,r.quickDateText=z.text;break}}a.quickInfos=m,a.quickGap=a.quickGap||7,a.quickTip=d["calendar.quick"],a.submitText=d["dialog.submit"],a.cancelText=d["dialog.cancel"],a.endMinFn=function(e,a){if(!a)return e;var r=new Date(e),l=new Date(a);return r.getTime()>l.getTime()?e:a},this.updater.set(a)},render:function(){this.updater.digest(),this.__a=t("#"+this.id)},"__K<change>":function(e){e.stopPropagation();var a=this.updater,r=a.get("dates"),l=a.get("vs"),t=a.get("vsSingle"),s=a.get("formatter"),_=a.get("quickDates"),c=a.get("quickInfos"),d=e.params.trigger,y=e.date+(e.time?" "+e.time:"");r[d+"Str"]=y;var m,o=r.startStr,z=r.endStr,u=new Date(i(o,s));z==n?m=n:(m=new Date(i(z,s)),!l&&!t&&m.getTime()<u.getTime()&&(z=i(m=u,s)));c=g(_,o,s);for(var v,x,p=0;p<c.length;p++){var h=c[p];if(h.start==o&&h.end==z){v=h.text,x=h.key;break}}this.updater.digest({quickInfos:c,dates:{start:u,end:m,startStr:o,endStr:z,quickDateText:v,quickDateKey:x}})},"__L<change>":function(e){e.stopPropagation(),this.updater.digest({vs:e.state})},"__r<click>":function(e){var a=this.updater,r=a.get(),t=r.dates,s=r.formatter,_=r.quickDates,c=r.vs,d=r.vsSingle,y=r.minGap,m=r.maxGap,o=e.params;if(o.quick){var z=o.quickInfo,u=new Date(i(z.start,s)),v=void 0;if(z.end==n)v=n;else{v=new Date(i(z.end,s));var x=void 0,p=void 0,h=void 0,b=void 0;r.min&&(h=(x=new Date(i(r.min,s))).getTime()),r.max&&(b=(p=new Date(i(r.max,s))).getTime());var f=u.getTime(),k=v.getTime();h&&f<h?u=x:b&&f>b&&(u=p),b&&k>b?v=p:h&&k<h&&(v=x),v.getTime()<u.getTime()&&(v=u)}for(var w=i(u,s),D=v==n?n:i(v,s),T=g(_,w,s),S=void 0,q=void 0,I=0;I<T.length;I++){var M=T[I];if(M.start==w&&M.end==D){S=M.text,q=M.key;break}}t={start:u,end:v,startStr:w,endStr:D,quickDateText:S,quickDateKey:q}}else{w=t.startStr,D=t.endStr,u=t.start,v=t.end;(D==n&&c||!c&&!d&&D!=n&&v.getTime()<u.getTime())&&(D=w,v=new Date(i(D,s))),l.mix(t,{end:v,endStr:D})}var Y="";if(!c&&!d&&t.endStr!=n){var A=new Date(i(t.startStr,"YYYY/MM/dd")),K=(new Date(i(t.endStr,"YYYY/MM/dd")).getTime()-A.getTime())/864e5+1;y>0&&K<y&&(Y="至少选择"+y+"天"),m>0&&K>m&&(Y="至多选择"+m+"天")}a.digest({dates:t,errorMsg:Y}),Y||this.__a.trigger({type:"change",vs:c,dates:t})},"__M<click>":function(){this.__a.trigger("cancel")},"__J<contextmenu>":function(e){e.preventDefault()}});r.exports=y});