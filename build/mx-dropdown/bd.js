define("mx-dropdown/bd",["magix","$","../mx-util/monitor","../mx-medusa/util"],(e,t,i)=>{var r=e("magix"),n=e("$"),a=e("../mx-util/monitor"),o=e("../mx-medusa/util");i.exports=r.View.extend({tmpl:function(e,t,i,r,n,a,o,d){if(i||(i=e),!n){var s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},l=/[&<>"'`]/g,u=function(e){return"&"+s[e]+";"};n=function(e){return""+(null==e?"":e)},r=function(e){return n(e).replace(l,u)}}if(!a){var c={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},p=function(e){return c[e]},h=/[!')(*]/g;a=function(e){return encodeURIComponent(n(e)).replace(h,p)}}if(!d){var m=/[\\'"]/g;d=function(e){return n(e).replace(m,"\\$&")}}var f,v,x,g="",y=e.viewId,w=e.expand,b=e.selectedText;try{g+='<div id="toggle_',x=1,v="=viewId",g+=(f="<%=viewId%>",r(y)+'" class="mx-trigger '),x=1,v="if expand",f="<%if (expand) {%>",w&&(g+=" mx-trigger-open ",x=1,v="/if",f="<%}%>"),g+='"><span mxa="_zs_gallerybg:_" class="mx-trigger-label}">',x=3,v="=selectedText",g+=(f="<%=selectedText%>",r(b)+'</span><span mxs="_zs_gallerybg:_" class="mc-iconfont mx-trigger-arrow">&#xe692;</span></div>')}catch(e){var _="render view error:"+(e.message||e);throw v&&(_+="\r\n\tsrc art:{{"+v+"}}\r\n\tat line:"+x),_+="\r\n\t"+(v?"translate to:":"expr:"),_+=f+"\r\n\tat file:mx-dropdown/bd.html"}return g},init:function(e){var t=this;a["@{setup}"]();var i=n("#"+t.id);t["@{owner.node}"]=i;var d=e.selected;n.isArray(d)?t["@{bak.type}"]="array":d=d?(d+"").split(","):[];var s,l=e.textKey||"text",u=e.valueKey||"value",c=e.list||[],p=e.parents||[],h=e.parentKey||"pValue";if("object"==typeof c[0])if(c=c.map(function(e){return r.mix(e,{text:e[l],value:e[u],pValue:e[h]}),e}),0==p.length)s=!1,p=[{text:"组",value:"all",list:c}];else{s=!0;var m={};c.forEach(function(e){var t=e.pValue;m[t]=m[t]||[],m[t].push(e)});for(var f=0;f<p.length;f++){var v=p[f],x=v.value;v.list=m[x]||[],0==v.list.length&&v.splice(f--,1)}}else s=!1,p=[{text:"组",value:"all",list:c=c.map(function(e){return{text:e,value:e}})}];var g=e.multiple+""=="true",y=r.toMap(c,u),w=[];if(d.forEach(function(e){var t=y[d];n.isEmptyObject(t)||w.push(t)}),!g&&0==w.length){w=[c[0]];for(f=0;f<c.length;f++)if(!c[f].disabled){w=[c[f]];break}}switch(t["@{ui.disabled}"]=e.disabled+""=="true"||n("#"+t.id)[0].hasAttribute("mx-disabled"),t["@{scroll.wrapper}"]=e.scrollWrapper,t["@{pos.init}"]=!1,t.updater.set({viewId:t.id,searchbox:e.searchbox+""=="true",multiple:g,emptyText:e.emptyText||o.choose,hasGroups:s,parents:p,selectedItems:w,expand:!1,height:e.height||250,spm:t["@{owner.node}"].attr("data-spm-click")||""}),t.on("destroy",function(){t["@{owner.node}"].off("mouseenter mouseleave"),t["@{dealy.show.timer}"]&&clearTimeout(t["@{dealy.show.timer}"]),t["@{dealy.hide.timer}"]&&clearTimeout(t["@{dealy.hide.timer}"]),n("#dd_bd_"+t.id).remove(),a["@{remove}"](t),a["@{teardown}"]()}),t["@{trigger.type}"]=e.triggerType||"click",t["@{trigger.type}"]){case"click":i.on("click",function(){t["@{dealy.show.timer}"]=setTimeout(t.wrapAsync(function(){t.updater.get("expand")?t["@{hide}"]():t["@{ui.disabled}"]||t["@{show}"]()}),t.constants.showDelay)});break;case"hover":i.hover(function(){clearTimeout(t["@{dealy.hide.timer}"]),t["@{dealy.show.timer}"]=setTimeout(t.wrapAsync(function(){t["@{ui.disabled}"]||t["@{show}"]()}),t.constants.showDelay)},function(){t["@{delay.hide}"]()})}t.bindScroll()},render:function(){this.updater.digest({}),this["@{val}"]()},"@{val}":function(e){var t,i=this,r=i.updater.get(),n=r.selectedItems,a=r.emptyText,o=[],d=[];n.forEach(function(e){o.push(e.text),d.push(e.value)}),i.updater.digest({selectedText:o.join(",")||a}),t="array"==i["@{bak.type}"]?d:d.join(","),i["@{owner.node}"].val(t),e&&i["@{owner.node}"].trigger({type:"change",selected:t,values:d,texts:o,value:d.join(","),text:o.join(",")})},"@{init}":function(){var e=this,t=n("#toggle_"+e.id).outerWidth(),i=e.id,r='<div class="mx-output mx-output-bottom" id="dd_bd_'+i+'"\n                style="min-width: '+t+"px; max-width: "+2*t+'px;"></div>';n(document.body).append(r);var a=e.owner.mountVframe("dd_bd_"+i,"");a.on("created",function(){var t=e["@{setPos}"]();"hover"==e["@{trigger.type}"]&&t.hover(function(){clearTimeout(e["@{dealy.hide.timer}"])},function(){e["@{delay.hide}"]()})}),e["@{content.vf}"]=a},"@{inside}":function(e){return r.inside(e,this.id)||r.inside(e,"dd_bd_"+this.id)},"@{show}":function(){var e=this;clearTimeout(e["@{dealy.show.timer}"]),e["@{pos.init}"]||(e["@{pos.init}"]=!0,e["@{init}"]());var t=e.updater.get();t.expand||(e["@{content.vf}"].mountView("mx-dropdown/content",{data:t,submit:function(t){e["@{hide}"](),e.updater.set(t),e["@{val}"](!0)},cancel:function(){e["@{hide}"]()}}),e.updater.digest({expand:!0}),e["@{setPos}"]().addClass("mx-output-open"),a["@{add}"](e))},"@{delay.hide}":function(){var e=this;clearTimeout(e["@{dealy.show.timer}"]),clearTimeout(e["@{dealy.hide.timer}"]),e["@{dealy.hide.timer}"]=setTimeout(e.wrapAsync(function(){e["@{hide}"]()}),e.constants.hideDelay),a["@{remove}"](e)},"@{hide}":function(){var e=this;(clearTimeout(e["@{dealy.hide.timer}"]),e.updater.get("expand"))&&(e.updater.digest({expand:!1}),n("#dd_bd_"+e.id).removeClass("mx-output-open"),a["@{remove}"](e))},bindScroll:function(){var e=this,t=e["@{scroll.wrapper}"];t&&("string"!=typeof t||/^#/.test(t)||/^\./.test(t)?n(t):n("#"+t)).scroll(function(){e.updater.get("expand")&&e["@{setPos}"]()})},"@{setPos}":function(){var e=this["@{owner.node}"],t=n("#dd_bd_"+this.id);if(t&&t.length){var i=e.outerWidth(),r=e.outerHeight(),a=e.offset(),o=t.outerWidth(),d=(t.outerHeight(),a.top+r);return left=a.left-(o-i)/2,t.css({left:left,top:d}),t}},"$win<scroll>":function(e){this.updater.get("expand")&&this["@{setPos}"]()},"$doc<dialogScolll>":function(e){this.updater.get("expand")&&this["@{setPos}"]()},constants:{showDelay:100,hideDelay:200}})});