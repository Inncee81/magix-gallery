define("mx-dragsort/index",["magix","../mx-dragdrop/index","../mx-util/runner","$"],(e,t,o)=>{var n=e("magix"),i=e("../mx-dragdrop/index"),r=e("../mx-util/runner"),a=e("$");n.applyStyle("_zs_gallery_mx-dragsort_index_","._zs_gallery_mx-dragsort_index_-bar {\n  position: absolute;\n  left: -1000px;\n  top: 0;\n  z-index: 10000;\n  background: var(--color-brand);\n}\n._zs_gallery_mx-dragsort_index_-pointer {\n  position: absolute;\n  z-index: 10000;\n  width: 20px;\n  height: 20px;\n  border-radius: var(--border-radius);\n}\n._zs_gallery_mx-dragsort_index_-pointer:after {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  font-size: var(--font-size);\n  line-height: 20px;\n  text-align: center;\n  color: var(--color-brand);\n}\n._zs_gallery_mx-dragsort_index_-ok {\n  background: var(--color-brand-opacity);\n  border: 1px solid var(--color-brand);\n}\n._zs_gallery_mx-dragsort_index_-ok:after {\n  content: 'âœ“';\n}\n");var d=n.guid("dbar_"),l=n.guid("pt_"),s=a(window),h=a(document),c={"@{bar.create}":function(){a("#"+d).length||a('<div class="_zs_gallery_mx-dragsort_index_-bar" id="'+d+'"/>').appendTo("body")},"@{drag.start}":function(e){e.child&&(a(e.child).css({opacity:.4}),this["@{bar.create}"]())},"@{drag.end}":function(e){e&&e.child&&a(e.child).css({opacity:1}),this["@{bar.hide}"](),this["@{pointer.hide}"]()},"@{bar.hide}":function(){a("#"+d).css({left:-1e5})},"@{bar.move}":function(e,t){var o=a("#"+d),n=!1;2&e.anchor&&(2&t?(o.css({height:2,width:e.bound.width,top:e.bound.y-1,left:e.bound.x}),n=!0):8&t&&(o.css({height:2,width:e.bound.width,top:e.bound.y+e.bound.height-1,left:e.bound.x}),n=!0)),!n&&1&e.anchor&&(1&t?o.css({height:e.bound.height,width:2,top:e.bound.y,left:e.bound.x-1}):4&t&&o.css({height:e.bound.height,width:2,top:e.bound.y,left:e.bound.x+e.bound.width-1}))},"@{pos.changed}":function(e){var t=this;e.atPlace&&e.child!=e.hover?(3==e.anchor?e["@{side.changed}"]&&t["@{bar.move}"](e,e.side):e["@{pos.changed}"]&&t["@{bar.move}"](e,e.position),t["@{pointer.change}"](!0)):(t["@{bar.hide}"](),t["@{pointer.change}"]())},"@{pointer.update}":function(e){var t=a("#"+l);t.length||(t=a('<div class="_zs_gallery_mx-dragsort_index_-pointer" id="'+l+'"/>')).appendTo("body");var o=Math.max(0,Math.min(e.pageX+10,h.width()-t.width())),n=Math.max(0,Math.min(e.pageY+18,h.height()-t.height()));t.css({left:o,top:n,display:"block"})},"@{pointer.change}":function(e){var t=a("#"+l);e?t.addClass("_zs_gallery_mx-dragsort_index_-ok"):t.removeClass("_zs_gallery_mx-dragsort_index_-ok")},"@{pointer.hide}":function(){a("#"+l).hide()}};o.exports=n.View.extend({mixins:[i],init:function(e){var t=this,o=a("#"+t.id);o.on("mousedown",e.selector,function(e){e.preventDefault(),t["@{drag.start}"](e)}),t.on("destroy",function(){o.off("mousedown")}),t["@{owner.node}"]=o;var i=[o.get(0)];e.drops&&(i=i.concat(e.drops.split(","))),t["@{zone.ids}"]=i;var r=e.horizonal+""=="true",d=e.vertical+""=="true";r||d||(d=!0);var l=0;r&&(l|=1),d&&(l|=2),t["@{anchor.direction}"]=l;var s=!0;n.has(e,"sort")&&(s=e.sort+""=="true"),t["@{sort.ctrl}"]=s},"@{findZone}":function(e){for(var t=0,o=this["@{zone.ids}"];t<o.length;t++){var i=o[t];if(n.inside(e,i))return n.node(i)}return null},"@{findDirectChild}":function(e,t){var o=null;if(t||(t=this["@{findZone}"](e)),!this["@{sort.ctrl}"]&&this["@{drag.start.node}"])return{child:this["@{drag.start.node}"],zone:t};for(;t!=e;){if(e.parentNode==t){o=e;break}e=e.parentNode}return!t||t.firstChild||o||(o=t),o&&"false"===o.getAttribute("ds-draggable")&&(o=null),{child:o,zone:t}},"@{findPosition}":function(e,t){var o=0,n=0,i=-1,r=-1,a=-1,d=-1,l=!1;if(t.pageX>=e.x&&t.pageX<=e.x+e.width&&t.pageY>=e.y&&t.pageY<=e.y+e.height&&(o|=t.pageX<=e.x+e.width/2?1:4,i=t.pageX-e.x,a=e.x+e.width-t.pageX,o|=t.pageY<=e.y+e.height/2?2:8,r=t.pageY-e.y,d=e.y+e.height-t.pageY,l=!0),l){var s=Math.min(i,r,a,d);s>-1&&(s==i?n=1:s==r?n=2:s==a?n=4:s==d&&(n=8))}var h=this["@{hover.info}"];return h&&h.zone===h.hover&&(o=2,n=1),{position:o,atPlace:l,side:n}},"@{drag.start}":function(e){if(1===e.which){var t=this,o=t["@{findDirectChild}"](e.target);o.child&&(t["@{drag.start.node}"]=o.child,t["@{drag.start.zone}"]=o.zone,t["@{owner.node}"].trigger({type:"dragbegin",dragNode:o.child,dragZone:o.zone}),c["@{drag.start}"](o),t.dragdrop(o.zone,function(e){t["@{drag.move}"](e)},function(e){t["@{drag.end}"](e)}))}},"@{checkPosition}":function(e,t,o){var n=this,i=n["@{findPosition}"](e,t),r=i.side!=n["@{last.side}"],a=i.position!=n["@{last.position}"];(r||a)&&(n["@{last.side}"]=i.side,n["@{last.position}"]=i.position,o["@{side.changed}"]=r,o["@{pos.changed}"]=a,o.side=i.side,o.position=i.position,o.atPlace=i.atPlace,o.anchor=n["@{anchor.direction}"],c["@{pos.changed}"](o))},"@{drag.move}":function(e){var t=i.fromPoint(e.clientX,e.clientY),o=this;if(c["@{pointer.update}"](e),o["@{move.event}"]=e,o["@{has.moved}"]=!0,o["@{start.zone.scroll}"](),o["@{start.win.scroll}"](),o["@{zone.start.scrolling}"]||o["@{win.start.scrolling}"]||!t)return delete o["@{last.hover.node}"],delete o["@{last.side}"],void delete o["@{last.position}"];if(o["@{last.hover.node}"]!=t){if(t.id===d)return;o["@{last.hover.node}"]=t,delete o["@{last.side}"];var r=o["@{findZone}"](t);if(r){r!=o["@{last.zone}"]&&(o["@{last.zone}"]=r,o["@{owner.node}"].trigger({type:"enterzone",zone:r,changePointer:c["@{pointer.change}"]}));var l=o["@{findDirectChild}"](t,r);if(!l.child)return;var s=a(l.child),h=s.offset(),g={x:h.left,y:h.top,width:s.outerWidth(),height:s.outerHeight()};h=(s=a(l.zone)).offset(),o["@{last.zone.bound}"]={x:h.left,y:h.top,scrollX:s.prop("scrollLeft"),scrollY:s.prop("scrollTop"),maxWidth:s.prop("scrollWidth"),maxHeight:s.prop("scrollHeight"),width:s.width(),height:s.height()},o["@{checkPosition}"](o["@{last.hover.node.bound}"]=g,e,o["@{hover.info}"]={child:o["@{drag.start.node}"],bound:g,zone:l.zone,hover:l.child})}else o["@{last.zone}"]&&(o["@{owner.node}"].trigger({type:"leavezone",zone:o["@{last.zone}"],changePointer:c["@{pointer.change}"]}),delete o["@{last.zone}"])}else o["@{last.hover.node.bound}"]&&n.inside(t,o["@{hover.info}"].zone)?o["@{checkPosition}"](o["@{last.hover.node.bound}"],e,o["@{hover.info}"]):(delete o["@{last.side}"],delete o["@{last.position}"],o["@{sort.ctrl}"]&&(c["@{bar.hide}"](),c["@{pointer.change}"]()))},"@{drag.end}":function(){var e=this;e["@{stop.zone.scroll}"](),e["@{stop.win.scroll}"](),c["@{drag.end}"]({child:e["@{drag.start.node}"]});var t=e["@{last.position}"],o=e["@{last.side}"],n=e["@{has.moved}"],i=e["@{hover.info}"],r=e["@{drag.start.node}"];if(n&&(t||o)){var a=i.zone,d=e["@{anchor.direction}"],l=3===d?o:t;if(1&d&&1&l||2&l&&2&d)i.hover==a?a.appendChild(r):a.insertBefore(r,i.hover);else if(8&l&&2&d||4&l&&1&d){for(var s=i.hover.nextSibling;s&&1!=s.nodeType;)s=s.nextSibling;a.insertBefore(r,s),s||(a.scrollTop=a.scrollHeight)}}i&&e["@{owner.node}"].trigger({type:"dragfinish",moved:n,dragNode:r,dragZone:e["@{drag.start.zone}"],dropNode:i.hover,dropZone:i.zone,outZone:!e["@{last.zone}"]}),delete e["@{drag.start.node}"],delete e["@{drag.start.zone}"],delete e["@{last.hover.node}"],delete e["@{hover.info}"],delete e["@{last.hover.node.bound}"],delete e["@{last.position}"],delete e["@{last.side}"],delete e["@{move.event}"],delete e["@{win.start.scrolling}"],delete e["@{last.zone}"],delete e["@{last.zone.bound}"],delete e["@{zone.start.scrolling}"],delete e["@{has.moved}"]},"@{start.zone.scroll}":function(){var e=this;e["@{fn.zone.scroll}"]||(e["@{fn.zone.scroll}"]=function(){var t=e["@{last.zone.bound}"];if(t){var o=e["@{hover.info}"].zone,n=0,i=0,r=e["@{move.event}"];r.pageX>t.x&&r.pageY>t.y&&r.pageX<t.x+t.width&&r.pageY<t.y+t.height?(r.pageX-t.x<20&&t.scrollX>0?n=-Math.min(7,t.scrollX):t.x+t.width-r.pageX<20&&t.scrollX+t.width<t.maxWidth&&(n=Math.min(7,t.maxWidth-t.scrollX-t.width)),r.pageY-t.y<20&&t.scrollY>0?i=-Math.min(7,t.scrollY):t.y+t.height-r.pageY<20&&t.scrollY+t.height<t.maxHeight&&(i=Math.min(7,t.maxHeight-t.scrollY-t.height)),n||i?(e["@{zone.start.scrolling}"]=!0,e["@{prevent.win.scroll}"]=!0,o.scrollTop+=i,o.scrollLeft+=n,t.scrollX+=n,t.scrollY+=i,delete e["@{has.moved}"],c["@{bar.hide}"](),c["@{pointer.change}"]()):(delete e["@{zone.start.scrolling}"],delete e["@{prevent.win.scroll}"])):(delete e["@{zone.start.scrolling}"],delete e["@{prevent.win.scroll}"])}},r["@{task.add}"](30,e["@{fn.zone.scroll}"]))},"@{start.win.scroll}":function(){var e=this;e["@{fn.win.scroll}"]||(e["@{fn.win.scroll}"]=function(){if(!e["@{prevent.win.scroll}"]){var t=0,o=0,n=e["@{move.event}"],i=s.scrollTop(),r=s.height(),a=h.height(),d=h.width(),l=s.width(),g=s.scrollLeft();n.pageX-g<20&&g>0?t=-Math.min(7,g):g+l-n.pageX<20&&g+l<d&&(t=Math.min(7,d-l-g)),n.pageY-i<20&&i>0?o=-Math.min(7,i):i+r-n.pageY<20&&i+r<a&&(o=Math.min(7,a-r-i)),t||o?(e["@{win.start.scrolling}"]=!0,n.pageX+=t,n.pageY+=o,window.scrollBy(t,o),delete e["@{has.moved}"],c["@{bar.hide}"](),c["@{pointer.update}"](n),c["@{pointer.change}"]()):delete e["@{win.start.scrolling}"]}},r["@{task.add}"](30,e["@{fn.win.scroll}"]))},"@{stop.zone.scroll}":function(){this["@{fn.zone.scroll}"]&&(r["@{task.remove}"](this["@{fn.zone.scroll}"]),delete this["@{fn.zone.scroll}"],delete this["@{prevent.win.scroll}"])},"@{stop.win.scroll}":function(){this["@{fn.win.scroll}"]&&(r["@{task.remove}"](this["@{fn.win.scroll}"]),delete this["@{fn.win.scroll}"])}})});