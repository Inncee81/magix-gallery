define("mx-uploader/index",["magix","$","../mx-util/runner"],(e,t,n)=>{var r=e("magix"),i=e("$"),a=e("../mx-util/runner");r.applyStyle("_zs_gallery_mx-uploader_index_",'[mx-view*="mx-uploader/index"] {\n  position: relative;\n  overflow: hidden;\n}\n._zs_gallery_mx-uploader_index_-file {\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  cursor: pointer;\n  font-size: 100px;\n  filter: alpha(opacity=0);\n}\n._zs_gallery_mx-uploader_index_-cnt {\n  position: absolute;\n  left: -999999px;\n}\n');var o=function(e,t,n,r,i,a,o,d){if(n||(n=e),!i){var s={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},l=/[&<>"'`]/g,p=function(e){return"&"+s[e]+";"};i=function(e){return""+(null==e?"":e)},r=function(e){return i(e).replace(l,p)}}if(!a){var u={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},c=function(e){return u[e]},m=/[!')(*]/g;a=function(e){return encodeURIComponent(i(e)).replace(m,c)}}if(!d){var f=/[\\'"]/g;d=function(e){return i(e).replace(f,"\\$&")}}var g,v,x,h="",y=e.nodeId,_=e.disabled,b=e.name;try{h+='<input id="',x=1,v="=nodeId",h+=(g="<%=nodeId%>",r(y)+'" class="_zs_gallery_mx-uploader_index_-file" '),x=2,v="if disabled",g="<%if (disabled) {%>",_&&(h+=' disabled="true" ',x=2,v="/if",g="<%}%>"),h+=' type="file" name="',x=3,v="=name",h+=(g="<%=name%>",r(b)+'" mx-change="'+t+'@{upload}()"/>')}catch(e){var w="render view error:"+(e.message||e);throw v&&(w+="\r\n\tsrc art:{{"+v+"}}\r\n\tat line:"+x),w+="\r\n\t"+(v?"translate to:":"expr:"),w+=g+"\r\n\tat file:mx-uploader/index.html"}return h},d=r.Base.extend({destroy:function(){this["@{destroyed}"]=1}}),s=d.extend({"@{send.request}":function(e,t,n,o){var d=e.form,s=this,l=r.guid("up");d||(i("body").append('<div id="'+l+'_temp" class="_zs_gallery_mx-uploader_index_-cnt"><form target="'+l+'"></form></div>'),(d=i("#"+l+"_temp").find("form")).append(e),d=d[0]);var p=0,u=2e3;if(e.files){u=0;for(var c=0;c<e.files.length;c++)u+=e.files[c].size;(u/=1e3)<2e3&&(u=2e3)}var m=1e3/u,f=function(){s["@{destroyed}"]?a["@{task.remove}"](f):p<1&&(o(p),p+=m+20*Math.random()*m)};a["@{task.add}"](100,f),i('<iframe name="'+l+'" id="'+l+'" style="display:none;"></iframe>').insertAfter(d).on("load",function(e){if(a["@{task.remove}"](f),!s["@{destroyed}"]){o(1);var t=e.target,r=i(t.contentWindow.document.body);r.find("script").remove();var d=i.trim(r.text());i(t).remove(),i("#"+l+"_temp").remove();try{n(null,new Function("return "+d)())}catch(e){n(e)}}}).on("error",function(e){a["@{task.remove}"](f),s["@{destroyed}"]||(i("#"+l+"_temp").remove(),n(e))}),d.target=l,d.action=t.get("action"),d.method="POST",d.enctype="multipart/form-data",d.submit()}}),l=d.extend({"@{send.request}":function(e,t,n,r){for(var i=new FormData,a=this,o=e.files,d=0;d<o.length;d++)i.append(t.get("name"),o[d]);var s=new XMLHttpRequest;s.open("post",t.get("action"),!0),s.onload=function(){if(!a["@{destroyed}"])try{n(null,new Function("return "+s.responseText)())}catch(e){n(e)}},s.onerror=function(e){a["@{destroyed}"]||(e.message="network error",n(e))},s.upload.onprogress=function(e){e.lengthComputable?r(e.loaded/e.total):r(0)},s.send(i)}});n.exports=r.View.extend({init:function(e){this.updater.snapshot(),this.assign(e)},assign:function(e){var t,n=e.disabled+""=="true"||i("#"+this.id)[0].hasAttribute("mx-disabled"),r=e.type;return this.updater.set({name:e.name||"file",action:e.action||"",multiple:e.multiple+""=="true",accept:e.accept,disabled:n,type:r}),t="xhr"==r&&window.FormData?l:s,this.capture("@{transport}",new t),!0},render:function(){var e=this,t="file_"+e.id,n=i("#"+t);n.length&&n.remove();var r=e.updater.get(),a=i.isFunction(o)?o({disabled:r.disabled,name:r.name,nodeId:t},e.id):o;e.wrapEvent&&(a=e.wrapEvent(a)),i("#"+e.id).append(a),n=i("#"+t),r.multiple&&n.attr("multiple","multiple"),r.accept&&n.prop("accept",r.accept)},"@{upload}<change>":function(e){var t=this,n=i("#"+t.id),r=e.eventTarget.files,a=i.Event("start",{files:r});(n.trigger(a),a.isDefaultPrevented())?t.render():(t.capture("@{transport}")["@{send.request}"](e.target,t.updater,function(e,t){e?n.trigger({type:"error",error:e}):n.trigger({type:"success",files:r,response:t})},function(e){n.trigger({type:"progress",percent:e})}),t.render())}})});