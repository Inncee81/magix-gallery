define("mx-preview/index",["magix","$"],(e,i,r)=>{var n,t=e("magix"),a=e("$");t.applyStyle("_zs_gallery_mx-preview_index_",'[mx-view*="mx-preview/index"] {\n  display: inline-block;\n  vertical-align: middle;\n}\n._zs_gallery_mx-preview_index_-holder {\n  color: #ccc;\n  font-size: 30px;\n}\n._zs_gallery_mx-preview_index_-outer {\n  display: table;\n  text-align: center;\n}\n._zs_gallery_mx-preview_index_-outer ._zs_gallery_mx-preview_index_-inner {\n  display: table-cell;\n  vertical-align: middle;\n}\n._zs_gallery_mx-preview_index_-outer ._zs_gallery_mx-preview_index_-inner ._zs_gallery_mx-preview_index_-img,\n._zs_gallery_mx-preview_index_-outer ._zs_gallery_mx-preview_index_-inner ._zs_gallery_mx-preview_index_-video {\n  max-width: 100%;\n  max-height: 100%;\n}\n._zs_gallery_mx-preview_index_-outer ._zs_gallery_mx-preview_index_-inner ._zs_gallery_mx-preview_index_-text {\n  word-break: break-all;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n._zs_gallery_mx-preview_index_-outer ._zs_gallery_mx-preview_index_-inner ._zs_gallery_mx-preview_index_-iframe {\n  transform-origin: left top;\n}\n._zs_gallery_mx-preview_index_-pic-preview {\n  display: none;\n  position: absolute;\n  z-index: 99999;\n  border-collapse: separate;\n  background-color: #fff;\n  padding: 10px;\n}\n._zs_gallery_mx-preview_index_-pic-preview ._zs_gallery_mx-preview_index_-preview-inner {\n  display: block;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n'),r.exports=t.View.extend({tmpl:function(e,i,r,n,t,a,l,s){if(r||(r=e),!t){var o={"&":"amp","<":"lt",">":"gt",'"':"#34","'":"#39","`":"#96"},_=/[&<>"'`]/g,d=function(e){return"&"+o[e]+";"};t=function(e){return""+(null==e?"":e)},n=function(e){return t(e).replace(_,d)}}if(!a){var p={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"},m=function(e){return p[e]},v=/[!')(*]/g;a=function(e){return encodeURIComponent(t(e)).replace(v,m)}}if(!s){var c=/[\\'"]/g;s=function(e){return t(e).replace(c,"\\$&")}}var x,h,w,g="",f=e.maxWidth,u=e.maxHeight,y=e.preview,z=e.type,b=e.viewId;try{g+='<div class="_zs_gallery_mx-preview_index_-outer" style="width: ',w=1,h="=maxWidth",g+=(x="<%=maxWidth%>",n(f)+"px; height: "),w=1,h="=maxHeight",g+=(x="<%=maxHeight%>",n(u)+'px;" '),w=2,h="if preview",x="<%if (preview) {%>",y&&(g+=' mx-mouseover="'+i+'preview()" mx-mouseout="'+i+'hide()" ',w=2,h="/if",x="<%}%>"),g+='><div class="_zs_gallery_mx-preview_index_-inner" style="height: ',w=3,h="=maxHeight",g+=(x="<%=maxHeight%>",n(u)+"px; "),w=3,h="if (type != 'text')",x="<%if (type != 'text') {%>","text"!=z&&(g+=" font-size: 0; ",w=3,h="/if",x="<%}%>"),g+='" id="',w=3,h="=viewId",g+=(x="<%=viewId%>",n(b)+'_inner"><i mxs="_zs_gallerydR:_" class="mc-iconfont _zs_gallery_mx-preview_index_-holder">&#xe615;</i></div></div>')}catch(e){var k="render view error:"+(e.message||e);throw h&&(k+="\r\n\tsrc art:{{"+h+"}}\r\n\tat line:"+w),k+="\r\n\t"+(h?"translate to:":"expr:"),k+=x+"\r\n\tat file:mx-preview/index.html"}return g},init:function(e){var i=this;i.updater.snapshot(),i.assign(e),i.on("destroy",function(){clearTimeout(i.timer),a("#pic_preview_"+i.id).remove()})},assign:function(e){var i,r=this.updater.altered();if(e.format){var n=+e.format||5,t={image:[2,11],flash:[3,9],video:[4],text:[5],iframe:[10]};for(var a in t)t[a].indexOf(n)>-1&&(i=a)}else i=e.type||"text";return this.updater.set({viewId:this.id,placement:e.placement||"right",preview:e.preview+""!="false",type:i,url:e.url,clickUrl:e.clickUrl,width:+e.width,height:+e.height,maxWidth:+e.maxWidth||100,maxHeight:+e.maxHeight||100,previewData:e.previewData||{}}),r||(r=this.updater.altered()),!!r&&(this.updater.snapshot(),!0)},render:function(){var e=this;if(e.updater.digest({}),window.IntersectionObserver){var i=new IntersectionObserver(function(r){r.forEach(function(r){var n=r.target;(r.isIntersecting||r.intersectionRatio>0)&&(e.thumbnail(),i.unobserve(n))})},{rootMargin:"10px 0px"});i.observe(document.querySelector("#"+e.id)),e.capture("observer",{destroy:function(){i.disconnect()}})}else e.thumbnail()},thumbnail:function(){var e=this.updater.get(),i=e.type,r=e.url,n=e.maxWidth,t=e.maxHeight,l=e.width,s=e.height,o=e.clickUrl,_="";switch(i){case"image":_='<img class="_zs_gallery_mx-preview_index_-img" src="'+r+'"/>';break;case"flash":_="flash已下线";case"video":_='<video src="'+r+'" class="_zs_gallery_mx-preview_index_-video"></video>';break;case"text":(_=a('<div class="_zs_gallery_mx-preview_index_-text" style="max-width: '+n+"px; max-height: "+t+'px;"></div>'))[0].innerText=r;break;case"iframe":var d=Math.min(n/l,t/s);_='<div style="width: '+l*d+"px; height: "+s*d+'px; overflow: hidden">\n                                <iframe src="'+r+'" class="_zs_gallery_mx-preview_index_-iframe"\n                                    sandbox="allow-forms allow-popups allow-pointer-lock allow-same-origin allow-scripts"\n                                    style="transform:scale('+d+')"\n                                    width="'+l+'" \n                                    height="'+s+'" \n                                    frameborder="0"\n                                    scrolling="no" \n                                    marginheight="0" \n                                    marginwidth="0" \n                                    border="0"></iframe>\n                            </div>'}o&&(_=a(_).wrap('<a href="'+o+'" target="_blank" rel="noopener noreferrer"></a>')),a("#"+this.id+"_inner").html(_)},"preview<mouseover>":function(e){t.inside(e.relatedTarget,e.eventTarget)||this.show()},show:function(){var e=this,i=a("#"+e.id+" ._zs_gallery_mx-preview_index_-outer"),r=i.offset(),t=r.left,l=r.top;n&&n!=e&&n.immediatelyHide(),n=e,clearTimeout(e.timer);var s=e.updater.get(),o={},_=(o=a.isEmptyObject(s.previewData)?s:s.previewData).type,d=o.url;if(d&&_&&"flash"!=_){var p=function(r,n){o.scale&&(r*=+o.scale,n*=+o.scale);var p=a(window),m=p.width(),v=p.height(),c=p.scrollTop();l<c&&(l=c);var x=s.placement,h=0;if((h="left"==x?t-10:m-(t+=i.outerWidth()+10))<r&&(n*=h/r,r=h),n>v&&(r=r*v/n,n=v),c+v<l+n){var w=Math.min(l+n-c-v,l-c);l-=w}var g="";switch(_){case"image":g=a('<img src="'+d+'" class="_zs_gallery_mx-preview_index_-preview-inner"/>');break;case"video":g=a('<video src="'+d+'" class="_zs_gallery_mx-preview_index_-preview-inner"\n                        controls="controls" autoplay="autoplay"></video>');break;case"text":(g=a('<div class="_zs_gallery_mx-preview_index_-preview-inner"></div>'))[0].innerText=d;break;case"iframe":var f=o.width,u=o.height;g=a('<div class="_zs_gallery_mx-preview_index_-preview-inner">\n                        <iframe src="'+d+'"\n                            sandbox="allow-forms allow-popups allow-pointer-lock allow-same-origin allow-scripts"\n                            style="transform: scale('+(r-20)/f+'); transform-origin: left top;"\n                            width="'+f+'" \n                            height="'+u+'"\n                            frameborder="0" \n                            scrolling="no" \n                            marginheight="0" \n                            marginwidth="0" \n                            border="0"></iframe>\n                    </div>')}var y=s.clickUrl;y&&g.wrap('<a href="'+y+'" target="_blank" rel="noopener noreferrer"></a>');var z=a("#pic_preview_"+e.id);z.length||(z=a('<div id="pic_preview_'+e.id+'" class="_zs_gallery_mx-preview_index_-pic-preview mx-shadow"></div>').appendTo("body")),z.empty().append(g),z.css({width:r,height:n||"auto",left:"left"==x?t-r-10:t,top:l,display:"block"})};if(o.width&&o.height)p(+o.width+20,+o.height+20);else if("text"==_)p(600,0);else if("image"==_){var m=new Image;m.onload=function(){p(this.width+20,this.height+20)},m.src=d}}},"hide<mouseout>":function(e){t.inside(e.relatedTarget,e.eventTarget)||this.hide()},hide:function(){var e=this;e.delayHide();var i=a("#pic_preview_"+e.id);i.off("mouseover.preview").on("mouseover.preview",function(){clearTimeout(e.timer),i.off("mouseout.preview").on("mouseout.preview",function(i){e.delayHide()})})},immediatelyHide:function(){clearTimeout(this.timer),a("#pic_preview_"+this.id).empty().css({display:"none"})},delayHide:function(){var e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){a("#pic_preview_"+e.id).empty().css({display:"none"})},300)}})});